!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ptj={},e.Vue)}(this,(function(e,t){"use strict";var l={props:{location:{default:"body"},relative:{default:!1},cls:String},setup(e){const l=e;let n=t.ref(!1);function o(){n.value=!n.value}let r=t.computed((()=>{if(l.relative){let e=function(e){let t={left:0,top:0,width:e.offsetWidth,height:e.offsetHeight,wrapper:0};for(;!e.classList.contains("ptj-table-wrapper");)t.left+=e.offsetLeft,t.top+=e.offsetTop,e=e.parentNode;return t.wrapper=e.offsetWidth,t}(l.relative);return e.wrapper,e.left,e.width,"position:absolute;top:"+(e.top+e.height)+"px;right:0px;"}return""})),a=t.computed((()=>!l.location)),i=t.computed((()=>"body"==l.location?"ptj-modal-backdrop-full":""));return(l,s)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.createElementVNode("a",{onClick:o,class:"ptj-modal-button"},[t.renderSlot(l.$slots,"button")]),(t.openBlock(),t.createBlock(t.Teleport,{disabled:t.unref(a),to:e.location},[t.withDirectives(t.createElementVNode("div",{class:t.normalizeClass(["ptj-modal-backdrop",t.unref(i)]),style:t.normalizeStyle(t.unref(r))},[t.createElementVNode("div",{class:t.normalizeClass(["ptj-modal",e.cls])},[t.createElementVNode("header",null,[t.createElementVNode("button",{type:"button",class:"btn-close",onClick:o}," x ")]),t.renderSlot(l.$slots,"default",{toggleShow:o})],2)],6),[[t.vShow,t.unref(n)]])],8,["disabled","to"]))],64))}};function n(e,t){void 0===t&&(t={});var l=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===l&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}n("\n.ptj-modal-backdrop-full {\r\n    position : absolute;\r\n    top : 0;\r\n    left : 0;\r\n    height : 100vh;\r\n    width : 100vw;\n}\r\n"),l.__file="presstojam/src/components/ptj-modal.vue";let o,r={};var a={initSettings(e){if(o=e.url,e.custom_headers)for(let t in e.custom_headers)r[t]=e.custom_headers[t]},run(e,t,l,n){const a=new Headers;l&&(a.set("Content-Type","application/json"),n=l);for(let e in r)a.set(e,r[e]);return fetch(o+t,{method:e,mode:"cors",cache:"no-cache",credentials:"include",headers:a,body:n}).then((e=>{if(e.ok)return e.json();throw e}))},get(e,t){if(t){const l=new URLSearchParams;for(let e in t)Array.isArray(t[e])||"object"==typeof t[e]&&null!==t[e]?l.append(e,JSON.stringify(t[e])):l.append(e,t[e]);-1==e.indexOf("?")?e+="?":e+="&",e+=l.toString()}return this.run("GET",e)},getprimary(e,t){return this.get(e,t)},post(e,t){return this.run("POST",e,JSON.stringify(t))},put(e,t){return this.run("PUT",e,JSON.stringify(t))},patch(e,t){return this.run("PATCH",e,null,t)},getAsset(e){const t=new Headers;for(let e in r)t.set(e,r[e]);return fetch(o+e,{method:"GET",mode:"cors",cache:"no-cache",credentials:"include",headers:t}).then((e=>{if(e.ok)return e.blob();throw e}))},delete(e,t){return this.run("DELETE",e,JSON.stringify(t))}};const i=new class{constructor(){this._route="",this._flow="",this._model="",this._state="",this._key=0,this._to="",this._params={},this._base="/",this._default=!1;Object.keys(this).forEach((e=>{"_"==e[0]&&Object.defineProperty(this,e.substring(1),{get:function(){return this[e]},set:function(t){t!=this[e]&&(this[e]=t)}})})),this.action_map={post:"-create",put:"-update",delete:"-delete",login:"-login",logout:"-logout",primary:"-primary",parent:"-parent",get:""}}get id(){return this.model+"-"+this.state+"-"+this.to}reset(){this.route="",this.flow="",this.model="",this.state="",this.key=0,this.to="",this.params={}}convertToURL(){let e=this._base+this.route+"/"+this.flow;this.model!=this.flow&&(e+="/"+this.model),e+=this.action_map[this.state],this.key&&(e+="-"+this.key),this.to&&(e+="-to-"+this.to);let t=new URLSearchParams;for(const e in this.params)if(this.params[e])if("object"==typeof this.params[e]){let l=[];for(let t in this.params[e])l.push(this.params[e][t]);t.append(e,l.join(","))}else t.append(e,this.params[e]);let l=t.toString();return l&&(e+="?"+l),e}initSettings(e){e&&(this._base=e.base),this.convertFromURL()}convertFromURL(){let e=new URL(window.location.href),t=e.pathname.replace(this.base,"");if(t=t.replace(/^\/+|\/+$/g,""),!t)return;let l=t.split("/");l.length>=3?(this.route=l[0],this.flow=l[1],t=l[2]):l.length>=2&&(this.route=l[0],t=l[1]);const n=this;e.searchParams.forEach((function(e,t){n.params[t]=e.indexOf(",")>-1?e.split(","):e})),l=t.split("-to-"),l.length>1&&(this.to=l[1],t=l[0]),l=t.split("-");let o=l[l.length-1];if("first"==o?(this.key=o,l.pop()):isNaN(o)||(this.key=parseInt(o),l.pop()),0==l.length)throw new Error("Can't convert this url string: "+t);this.state="get";for(let e in this.action_map)if(this.action_map[e]=="-"+l[l.length-1]){this.state=e,l.pop();break}this.model=l.join("-"),this.route||(this.route=this.model),this.flow||(this.flow=this.model)}getAll(){return{route:this.route,model:this.model,state:this.state,key:this.key,to:this.to,params:this.params,base:this.base,default:this.default}}apply(e){for(let t in e)this[t]=e[t]}};let s={};window.onpopstate=function(){i.reset(),i.convertFromURL(),g()};const c=t.reactive({component:"",title:"",name:"",route:{children:[],parent:null,perms:[]},slug:[],sort:!1});function d(){return s[i.model]&&s[i.model][i.state]?s[i.model][i.state]:{}}function p(){return c.component="",c.route.children=[],c.route.parent=null,c.route.perms=[],c.route.title="",c.route.name="",c.sort=!1,a.get("/route/"+i.route+"/"+i.flow+"/"+i.model).then((e=>{c.route.children=e.children,c.route.perms=e.perms,c.route.parent=e.parent,c.title=e.title,c.name=e.name,e.sort&&(c.sort=!0),"get"==i.state||"parent"==i.state?c.component="ptj-repo":"primary"==i.state?c.component="ptj-primary":"login"==i.state&&(c.component="ptj-account-handler")})).then((e=>{})).catch((e=>console.log(e)))}function u(){c.slug=[];let e={};if(i.key)return"parent"==i.state?e["--parentid"]=i.key:"primary"==i.state&&(e["--id"]=i.key),a.get("/slug/"+i.route+"/"+i.flow+"/"+i.model,e).then((e=>{c.slug=e;for(let e in c.slug)e=parseInt(e),c.slug[e].route=e>0?{model:c.slug[e].model,state:"parent",key:c.slug[e].id}:{model:c.slug[e].model,state:"get",key:0}}))}function m(){location.href=i.base}function f(){h(),g()}function h(){const e=window.location.protocol+"//"+window.location.host+i.convertToURL(),t=new URL(e);window.history.pushState({name:t.pathname},document.title,t)}function g(){p(),u()}var k={props:{route:Object},setup(e){const l=e;function n(){for(let e in l.route)null!==l.route[e]&&(i[e]=l.route[e]);i.params={},f()}return(l,o)=>(t.openBlock(),t.createElementBlock("a",{class:"ptj-button",key:e.route,onClick:n},[t.renderSlot(l.$slots,"default")]))},__file:"presstojam/src/components/ptj-button.vue"};const v={class:"ptj-multiple-select"},_={class:"ptj-multiple-select-display"},y={class:"ptj-multiple-select-values"},B=["onClick"],b=[(e=>(t.pushScopeId("data-v-51b18f4e"),e=e(),t.popScopeId(),e))((()=>t.createElementVNode("span",{class:"material-icons"},"close",-1)))];var w={props:{field:Object},setup(e){const l=e,n=t.ref("");function o(){l.field.change1=n.value,n.value=""}return(r,a)=>(t.openBlock(),t.createElementBlock("div",v,[t.createElementVNode("div",_,[t.createElementVNode("div",y,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.field.change1,(e=>(t.openBlock(),t.createElementBlock("div",{class:"ptj-multiple-select-val",key:e},[t.createTextVNode(t.toDisplayString(e)+" ",1),t.createElementVNode("a",{class:"ptj-multiple-select-val-remove",onClick:t=>{return n=e,void(l.field.change=l.field.change.filter((function(e){return e!==n})));var n}},b,8,B)])))),128))]),t.withDirectives(t.createElementVNode("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e)},null,512),[[t.vModelText,n.value]]),t.createElementVNode("a",{onClick:o,class:"ptj-multiple-select-add"},"add")])]))}};n("\n.ptj-multiple-select-val[data-v-51b18f4e] {\r\n    display : inline-block;\r\n    border : 1px solid green;\r\n    margin-left : 2px;\r\n    margin-right : 2px;\r\n    padding : 2px;\r\n    background-color : green;\n}\n.ptj-multiple-select-val-remove[data-v-51b18f4e] {\r\n    color : red;\n}\n.ptj-multiple-select-display[data-v-51b18f4e] {\r\n    position :relative;\r\n    background-color : #fff;\r\n    border : 1px solid #cdcdcd;\r\n    min-height : 35px;\n}\r\n\r\n"),w.__scopeId="data-v-51b18f4e",w.__file="presstojam/src/components/ptj-multiple-input.vue";const j={class:"ptj-multiple-select"},E={class:"ptj-multiple-select-display"},V={class:"ptj-multiple-select-values"},N=["onClick"],C=[(e=>(t.pushScopeId("data-v-5b05457d"),e=e(),t.popScopeId(),e))((()=>t.createElementVNode("span",{class:"material-icons"},"close",-1)))],x={class:"material-icons"},S=["data-key"];var D={props:{field:Object,options:{type:Array,required:!0}},setup(e){const l=e;function n(e){for(let t of l.options)if(t.key==e)return t.value}const o=t.reactive({display:!1,symbol:"keyboard_arrow_down"});function r(){o.display?(o.display=!1,o.symbol="keyboard_arrow_down"):(o.display=!0,o.symbol="keyboard_arrow_up")}function a(e){l.field.change1=e.target.getAttribute("data-key"),r()}return(i,s)=>(t.openBlock(),t.createElementBlock("div",j,[t.createElementVNode("div",E,[t.createElementVNode("div",V,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.field.change,(e=>(t.openBlock(),t.createElementBlock("div",{class:"ptj-multiple-select-val",key:e},[t.createTextVNode(t.toDisplayString(n(e))+" ",1),t.createElementVNode("a",{class:"ptj-multiple-select-val-remove",onClick:t=>{return n=e,void(l.field.change=l.field.change.filter((function(e){return e!==n})));var n}},C,8,N)])))),128))]),t.createElementVNode("a",{class:"ptj-multiple-select-arrow",onClick:r},[t.createElementVNode("span",x,t.toDisplayString(t.unref(o).symbol),1)])]),t.withDirectives(t.createElementVNode("ul",{class:"ptj-multiple-select-options",onClick:a},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.options,(e=>(t.openBlock(),t.createElementBlock("li",{key:e.key,"data-key":e.key},t.toDisplayString(e.value),9,S)))),128))],512),[[t.vShow,t.unref(o).display]])]))}};n("\n.ptj-multiple-select-val[data-v-5b05457d] {\r\n    display : inline-block;\r\n    border : 1px solid green;\r\n    margin-left : 2px;\r\n    margin-right : 2px;\r\n    padding : 2px;\r\n    background-color : green;\n}\n.ptj-multiple-select-val-remove[data-v-5b05457d] {\r\n    color : red;\n}\n.ptj-multiple-select-arrow[data-v-5b05457d] {\r\n    position :absolute;\r\n    right : 2px;\r\n    top : 3px;\n}\n.ptj-multiple-select-display[data-v-5b05457d] {\r\n    position :relative;\r\n    background-color : #fff;\r\n    border : 1px solid #cdcdcd;\r\n    min-height : 35px;\n}\n.ptj-multiple-select-options li[data-v-5b05457d] {\r\n    list-style: none;\r\n    cursor: pointer;\r\n    margin-top : 2px;\r\n    border : 1px solid #cdcdcd;\r\n    background-color : #fff;\n}\n.ptj-multiple-select-options li[data-v-5b05457d]:hover {\r\n    background-color : #f9f9fb;\r\n    transition : background-color .2s ease-out,border .2s ease-out;\n}\r\n"),D.__scopeId="data-v-5b05457d",D.__file="presstojam/src/components/ptj-multiple-select.vue";let F={};function T(e,t){let l="";if(!t)return F[e]&&(l=F[e]),l;if(t.model)if(t.field){if(t.field.indexOf("/")>-1){let e=t.field.split("/");t.field=e.pop()}F.models[t.model]&&F.models[t.model].fields[t.field]&&(l=F.models[t.model].fields[t.field][e])}else F.models[t.model]&&(l=F.models[t.model][e]);else l=t.type?F[e][t.type]?F[e][t.type]:F[e].def:F[e];return t.val&&(l=l.replace(/\{\{(.*?)\}\}/g,t.val)),!l&&t.default&&(l=t.default),l}const M=0,L=1,P=2,O=3,z=4,A={key:0,class:"ptj-error"};var U={props:{field:[Object,Function]},setup:e=>(l,n)=>e.field.error?(t.openBlock(),t.createElementBlock("p",A,t.toDisplayString(t.unref(T)("ptj-error-"+e.field.error,{type:e.field.type,val:e.field.meta.getErrorVal(e.field.error)})),1)):t.createCommentVNode("v-if",!0)};n("\n.ptj-error {\r\n  color : red;\n}\r\n"),U.__file="presstojam/src/components/ptj-error.vue";const R={class:"ptj-form-label"};var I={props:{field:[Object,Function]},setup:e=>(l,n)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["ptj-form-row",e.field.name])},[t.createElementVNode("label",R,t.toDisplayString(t.unref(T)("label",{model:e.field.model,field:e.field.name,default:e.field.name})),1),t.renderSlot(l.$slots,"default"),t.withDirectives(t.createVNode(U,{field:e.field},null,8,["field"]),[[t.vShow,e.field.showError]])],2)),__file:"presstojam/src/components/ptj-form-row.vue"};const J=["name"];var $={props:{field:{type:Object,required:!0}},setup(e){const l=t.reactive({validateon:!1,val:""}),n=t.computed({get:()=>l.val,set(e){field.val,l.val=e}});return(o,r)=>t.withDirectives((t.openBlock(),t.createElementBlock("input",{type:"text",name:e.field.name,"onUpdate:modelValue":r[0]||(r[0]=e=>t.isRef(n)?n.value=e:null),onBlur:r[1]||(r[1]=e=>t.unref(l).validateon=!0)},null,40,J)),[[t.vModelText,t.unref(n)]])},__file:"presstojam/src/components/ptj-form-confirm.vue"};const q=["onSubmit"],H=["name"],X=["value"];var Y={props:{field:Object},emits:["close"],setup(e,{emit:l}){const n=t.ref(0);function o(){n.value=1;let e={};return e["--id"]=i.key,e[field.name]=field.change,client.put("/data/"+i.model,e).then((()=>{l("close")})).catch((e=>{n.value=0,"string"==typeof e?globalerror=e:cdata.setErrors(e)}))}return(l,r)=>t.withDirectives((t.openBlock(),t.createElementBlock("form",{onSubmit:t.withModifiers(o,["prevent"]),class:t.normalizeClass(["ptj-form",i.model+" "+i.state])},[t.createVNode(I,{field:e.field},{default:t.withCtx((()=>[t.withDirectives(t.createElementVNode("input",{type:"password",name:e.field.name,"onUpdate:modelValue":r[0]||(r[0]=t=>e.field.change=t),onBlur:r[1]||(r[1]=t=>e.field.validateon=!0)},null,40,H),[[t.vModelText,e.field.change]])])),_:1},8,["field"]),t.createVNode(I,{field:e.field},{default:t.withCtx((()=>[t.createVNode($,{field:e.field},null,8,["field"])])),_:1},8,["field"]),t.createElementVNode("input",{type:"submit",value:t.unref(T)("ptj-reset-form-btn"),class:"ptj-form-submit"},null,8,X)],42,q)),[[t.vShow,0==n.value]])},__file:"presstojam/src/components/ptj-update-encrypted.vue"};const G=["name"],W={key:2},Z=["name"],K={value:"",selected:"",disabled:""},Q=["value"],ee=["name"],te={key:7},le={key:8};var ne={props:{field:{type:Object,required:!0}},setup(e){const n=e;t.computed((()=>"edit"==n.type&&n.field.immutable?"view":n.type));const o=t.ref([]);const r=t.computed((()=>function(e){if(0==e.length)return null;let t=[];const l=new RegExp(/^[a-zA-Z]+[a-zA-Z0-9._]+$/);for(let n of e)if(n){if(!l.test(n))return null;t.push(n)}return t}(n.field.contains)?(n.field.setContainsAsOptions(o),"select"):n.field.encrypted?"input":n.field.html||n.field.max>300?"textarea":"input")),a=t.computed((()=>{let e={};n.field.encrypted&&(e.type="password"),n.field.immutable&&(e.readonly=!0);let t=T("placeholder",{model:n.field.model,field:n.field.name});return t&&(e.placeholder=t),n.field.contains.includes("html")&&(e["data-html"]=1),e}));return(n,i)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[e.field.encrypted&&"edit"==e.field.mode?(t.openBlock(),t.createBlock(l,{key:0},{button:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(t.unref(T)("ptj-repo-post")),1)])),default:t.withCtx((l=>[t.createVNode(Y,{onClose:l.toggleShow,field:e.field},null,8,["onClose","field"])])),_:1})):t.createCommentVNode("v-if",!0),"textarea"!=t.unref(r)||"edit"!=e.field.mode&&"post"!=e.field.mode?"textarea"==t.unref(r)&&"view"==e.field.mode?(t.openBlock(),t.createElementBlock("div",W,t.toDisplayString(e.field.val),1)):"select"==t.unref(r)&&"filter"==e.field.mode?(t.openBlock(),t.createBlock(D,{key:3,field:e.field,options:o.value},null,8,["field","options"])):"select"!=t.unref(r)||"edit"!=e.field.mode&&"post"!=e.field.mode?"edit"==e.field.mode||"post"==e.field.mode?t.withDirectives((t.openBlock(),t.createElementBlock("input",t.mergeProps({key:5},t.unref(a),{name:e.field.name,"onUpdate:modelValue":i[3]||(i[3]=t=>e.field.change=t),onBlur:i[4]||(i[4]=t=>e.field.validateon=!0)}),null,16,ee)),[[t.vModelDynamic,e.field.change]]):"filter"==e.field.mode?(t.openBlock(),t.createBlock(w,{key:6,field:e.field},null,8,["field"])):"view"==e.field.mode&&e.field.reference?(t.openBlock(),t.createElementBlock("span",te,[t.createVNode(k,{route:{model:e.field.reference,key:e.field.val,state:"primary"}},{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(e.field.val),1)])),_:1},8,["route"])])):(t.openBlock(),t.createElementBlock("span",le,t.toDisplayString(e.field.val),1)):t.withDirectives((t.openBlock(),t.createElementBlock("select",t.mergeProps({key:4,"onUpdate:modelValue":i[1]||(i[1]=t=>e.field.change=t),name:e.field.name},t.unref(a),{onBlur:i[2]||(i[2]=t=>e.field.validateon=!0)}),[t.createElementVNode("option",K,t.toDisplayString(t.unref(T)("ptj-string-default")),1),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(o.value,(e=>(t.openBlock(),t.createElementBlock("option",{key:e.key,value:e.key},t.toDisplayString(e.value),9,Q)))),128))],16,Z)),[[t.vModelSelect,e.field.change]]):t.withDirectives((t.openBlock(),t.createElementBlock("textarea",t.mergeProps({key:1},t.unref(a),{name:e.field.name,"onUpdate:modelValue":i[0]||(i[0]=t=>e.field.change=t)}),null,16,G)),[[t.vModelText,e.field.change]])],64))},__file:"presstojam/src/components/ptj-string.vue"};const oe=t.reactive({init:!1,login:!1,user:"public"});function re(){a.post("/core/logout").then((()=>{m()}))}function ae(){a.get("/core/check-user").then((e=>{if(e.is_expired)return a.put("/core/switch-tokens").then((()=>{ae()}))})).then((e=>{"public"!=oe.user&&setTimeout(ae,6e5)})).catch((e=>{oe.login=!0}))}function ie(e=""){return a.get("/core/check-user").then((e=>e.is_expired?a.put("/core/switch-tokens").then((()=>a.get("/core/check-user"))):e)).then((t=>{if(oe.user=t.user,oe.role=t.role,oe.init=!0,oe.role!=e){let t="/core/change-role";return e&&(t+="/"+e),a.post(t).then((t=>{oe.role=e}))}})).then((()=>{ae()})).then((()=>a.get("/dictionary").then((e=>(F=e,!0))))).catch((e=>console.log(e)))}const se={class:"ptj-slug-trail"};var ce={setup:e=>(e,l)=>(t.openBlock(),t.createElementBlock("div",se,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(c).slug,(e=>(t.openBlock(),t.createBlock(k,{key:e.id,route:e.route},{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(e.model),1)])),_:2},1032,["route"])))),128))])),__file:"presstojam/src/components/ptj-slug-trail.vue"};class de{constructor(e){this._name=e,this._store=t.reactive({summary:0}),this._default_val=null,this._immutable=!1,this._encrypted=!1,this._min=null,this._max=null,this._contains=[],this._notcontains=[],this._listeners=[];Object.keys(this).forEach((e=>{"_store"!=e&&"_"==e[0]&&Object.defineProperty(this,e.substring(1),{get:function(){return this[e]},set:function(t){"_type"==e?this._type=t.toLowerCase():this[e]=t}})})),this.summary=t.computed({get:()=>this._store.summary,set:e=>{this._store.summary=e?1:0}})}apply(e){for(let t in e)if("summary"==t)this.summary=e[t]?1:0;else{if("validation"==t)continue;"type"==t?this.type=e[t].toLowerCase():this[t]=e[t]}this._min=e.validation.min,this._max=e.validation.max,e.validation.contains&&(this._contains=e.validation.contains.split("|")),e.validation.notcontains&&(this._notcontains=e.validation.notcontains.split("|"))}clean(e){return e}calcValue(e){return e||""}validateSize(e){return e<this._min?L:e>this._max?P:M}validate(e){if(null===e)return;let t;if(isNaN(e)){const l=e?e.length:0;t=this.validateSize(l)}else t=this.validateSize(e);if(t!=M)return t;for(let t of this._notcontains)if(e.match(t))return z;if(0==this._contains.length)return M;for(let t of this._contains)if(e.match(t))return M;return O}trigger(e){for(let t of this._listeners)t(e)}addParam(e,t){t&&(e[this._name]=t)}addAPIParam(e,t){t&&(e[this._name]=t)}getVal(e){return e.value}setVal(e,t){e.value=this.clean(t),e.error=this.validate(t)}getChange(e){return null==e.change?e.value:e.change}setChange(e,t){e.change=this.clean(t),e.error=this.validate(t),this.trigger(t)}getFilter(e){return e.value}setFilter(e,t){e.value=t}getErrorVal(e){return e==L?this.min:e==P?this._max:e==O?this._contains.join(" | "):e==z?this._notcontains:void 0}}class pe extends de{constructor(e,t){super(e),this._reference=!1,this._include_fields=[],this._recursive=!1,this._reference_to,this._default_val=0,t&&this.apply(t),t.includes&&(this._include_fields=t.includes),t.reference_to&&(this.referenceTo=t.reference_to)}setReferenceOptions(e,t){return a.get(e,t).then((e=>{let t=[];for(let l in e){let n=e[l]["--id"],o=[];for(let t in e[l])"--id"!=t&&o.push(e[l][t]);t.push({key:n,value:o.join(" ",o)})}return t})).catch((e=>{console.log(e)}))}getChange1(e){return null==e.change&&(e.change=e.value),null==e.change?[]:e.change}setChange1(e,t){null==e.change&&(e.change=[]),e.change.includes(t)||(e.change.push(this.clean(t)),e.error=this.validate(t))}get reference(){return this._reference}set reference(e){this._reference=e}get include_fields(){return this._include_fields}set include_fields(e){this._include_fields=e}get recursive(){return this._recursive}set recursive(e){this._recursive=e}get referenceTo(){return this._reference_to}set referenceTo(e){this._reference_to=e}}class ue extends de{constructor(e,t){super(e),t&&this.apply(t)}clean(e){return e?1:0}getChange1(e){return null==e.change&&(e.change=e.value),null==e.change?0:e.change?e.change:2}setChange1(e,t){0!=t?(2==t&&(t=0),e.change=this.clean(t),e.error=this.validate(t)):e.change=null}}class me extends de{constructor(e,t){super(e),this._size=0,this._blob=null,this._uploaded=!1,this._chunk_size=0,this._url,this._key=0,t&&this.apply(t)}set chunk_size(e){this._chunk_size=e}set blob(e){this._blob=e}set url(e){this._url=e}set key(e){this._key=e}get blob(){return this._blob}get size(){return this._size}get uploaded(){return this._uploaded}get chunk_size(){return this._chunk_size}get url(){return this._url}getChunk(e){const t=0==this._chunk_size?0:e*this._chunk_size;let l=0==this._chunk_size?this._size:(e+1)*this._chunk_size;l>this._size&&(l=this._size);const n=new DataView(this._blob,t,l-t);let o=[];for(let e=0,t=n.byteLength;e<t;++e)o.push(n.getInt8(e));return o.join("")}loadFile(e){let t={};return t.__key=e,a.get(this._url,t).catch((e=>{alert(e)}))}delFile(e){let t={};return t.__key=e,a.delete(this._url,t).catch((e=>{alert(e)}))}saveFile(e){return this._size=e.size,new Promise(((t,l)=>{const n=new FileReader;let o=this;n.onload=function(e){o.blob=e.target.result,t(n.result)},n.onerror=l,n.readAsArrayBuffer(e)})).then((()=>{let e=[],t=0==this.chunk_size?1:Math.ceil(this.size/this.chunk_size);for(let l=0;l<t;++l){const t={};t.__chunk=l,t.__blob=this.getChunk(l),e.push(a.put(this._url,t))}return Promise.all(e)}))}}class fe extends de{constructor(e,t){super(e),t&&this.apply(t)}addAPIParam(e,t){let l={};t&&(t.min&&(l.min=t.min),t.max&&(l.max=t.max),Object.keys(l).length>0&&(e[this._name]=l))}getChange1(e){return null==e.change&&(e.change=e.value),e.change?e.change.min:""}setChange1(e,t){e.change||(e.change={min:null,max:null}),e.change.min=this.clean(t),e.error=this.validate(t)}getChange2(e){return null==e.change2&&(e.change2=e.value),e.change2?e.change2:""}setChange2(e,t){e.change2=this.clean(t),e.error=this.validate(t)}}class he extends de{constructor(e,t){super(e),this._round=0,t&&this.apply(t)}clean(e){return this._round?parseFloat(e):parseInt(e)}getVal(e){return(e.value?e.value:0).toFixed(this._round)}setVal(e,t){e.value=this.clean(t),e.error=this.validate(t)}getChange(e){return null==e.change&&(e.change=e.value),e.change?e.change.toFixed(this._round):""}setChange(e,t){e.change=this.clean(t),e.error=this.validate(t),this.trigger(t)}getFilter(e){return e.value&&e.value,e.value.toFixed(this._round)}setFilter(e,t){e.value=this.clean(t)}getChange1(e){return null==e.change&&(e.change=e.value),e.change?e.change.toFixed(this._round):""}setChange1(e,t){e.change||(e.change=e.value),e.change=this.clean(t),e.error=this.validate(t)}getChange2(e){return null==e.change2&&(e.change2=e.value),e.change2?e.change2.toFixed(this._round):""}setChange2(e,t){e.change2=this.clean(t),e.error=this.validate(t)}get round(){return this._round}set round(e){this._round=e}}class ge extends de{constructor(e,t){super(e),t&&this.apply(t)}setContainsAsOptions(e){let t=[];for(let e of this._contains)if(e.indexOf(":")>-1){const l=e.split(":");t.push({key:l[0],value:l[1]})}else t.push({key:e,value:e});e.value=t}addAPIParam(e,t){if(t){let l=[];for(let e in t)t[e]&&l.push("%"+t[e]+"%");l.length>0&&(e[this._name]=l)}}getChange1(e){return null==e.change&&(e.change=e.value),null==e.change?[]:e.change}setChange1(e,t){null==e.change&&(e.change=[]),e.change.push(this.clean(t)),e.error=this.validate(t)}getFilter(e){return e.value}setFilter(e,t){Array.isArray(t)?e.value=t:t&&(e.value=[t])}}function ke(e,t){return"ID"==t.type?new pe(e,t):"Number"==t.type?new he(e,t):"Asset"==t.type?new me(e,t):"Flag"==t.type?new ue(e,t):"Time"==t.type?new fe(e,t):new ge(e,t)}class ve{constructor(){this._cells={},this._children=[],this._active=0,this._init=!1,this._store=t.reactive({index:null}),this._state_groups={};Object.keys(this).forEach((e=>{"_"==e[0]&&Object.defineProperty(this,e.substring(1),{get:function(){return this[e]},set:function(t){this[e]=t}})}))}addChild(e,t){this._children[e]=t}addState(e,t){this._actions[e]=t}resetSummary(e){for(let e in this._cells)this._cells[e].summary=!1;for(let t in e)this._cells[e[t]]&&(this._cells[e[t]].summary=!0)}setStates(e){for(let t in e){let l={};if(e[t].states)for(const n of e[t].states)l[n.depends_on]||(l[n.depends_on]=[]),l[n.depends_on].push(n);this._state_groups[t]=l}}mapField(e,t){this._cells[e]=ke(e,t),this._cells[e].recursive&&(this._store.index=e)}map(e,t=[]){if(t.length>0)for(let l of t)this.mapField(l,e[l]);else for(let t in e)this.mapField(t,e[t]);this.setStates(e)}getCellByType(e){let t={};for(let l in this._cells)this._cells[l].type==e&&(t[l]=this._cells[l]);return t}showAll(){for(let e in this._cells)this._cells[e].summary=!0}}class _e{constructor(e){this._store=t.reactive({meta:e,value:null,change:null,change2:null,display:null,error:0,is_validate_on:!1,mode:"view"});const l=Object.getOwnPropertyNames(e),n=Object.keys(this),o=this;l.forEach((e=>{"_"==e[0]||n.includes(e)||(this[e]=t.computed({get:function(){return o.store.meta[e]},set:function(t){o.store.meta[e]=t}}))})),this.error=t.computed({get:()=>this._store.error,set:e=>{this._store.error=parseInt(e),this._store.is_validate_on=!0}}),this.display=t.computed({get:()=>Array.isArray(this._store.display)?this._store.display.length>0?this._store.display.join(" "):this._store.value:this._store.display?this._store.display:this._store.value,set:e=>{this._store.display=[];const t=this._store.meta.include_fields;if(t)for(const l of t){const t=this._store.meta.name+"/"+l;this._store.display.push(e[t])}}}),this.showError=t.computed((()=>(!this._store.is_validate_on||this._store.error,!(!this._store.is_validate_on||!this._store.error)))),this._store.meta.default_val?this._store.value=this._store.meta.default_val:"select"==this._store.meta.type&&(this._store.value=0),this.val=t.computed({get:()=>this._store.meta.getVal(this._store),set:e=>{this._store.value=this._store.meta.clean(e),this._store.error=this._store.meta.validate(e)}}),this.change=t.computed({get:()=>this._store.meta.getChange(this._store),set:e=>{this._store.meta.setChange(this._store,e)}}),this.change1=t.computed({get:()=>this._store.meta.getChange1(this._store),set:e=>{this._store.meta.setChange1(this._store,e)}}),this.change2=t.computed({get:()=>{if("function"==typeof this._store.meta.getChange2)return this._store.meta.getChange2(this._store)},set:e=>{this._store.meta.setChange2(this._store,e)}}),this.filter=t.computed({get:()=>this._store.meta.getFilter(this._store),set:e=>{this._store.meta.setFilter(this._store,e)}}),this.mode=t.computed({get:()=>this._store.mode,set:e=>{this._store.meta.immutable&&"view"!=e&&"filter"!=e||(this._store.mode=e)}})}get meta(){return this._store.meta}set validateon(e){"post"!=this._store.mode&&"edit"!=this._store.mode||(this._store.is_validate_on=e)}get store(){return this._store}resetMeta(e){this._store.meta=e}toString(){return this._store.display}isSummary(){return this._store.meta.summary}setContainsAsOptions(e){this._store.meta.setContainsAsOptions(e)}reset(){this._store.change=null,this._store.value=null}getOption(e){return"string"==this._store.meta.type?e:this._store.meta.getOption(e)}addParam(e){this._store.meta.addParam(e,this._store.value)}addAPIParam(e){this._store.meta.addParam(e,this._store.value)}}function ye(e,t,l){let n=[];for(let l in t){let o=ke(e,t[l]);n.push({depends_val:t[l].depends_val,field:o})}return e=>{for(const t of n)if(t.depends_val==e)return l(t.field);for(const e of n)if(!e.depends_val)return l(e.field)}}class Be{constructor(e){this._metarow=e,this._cells=t.reactive({}),this._children={},this._ids=t.reactive({}),e&&this.applyMetaRow(e),this.cells=t.computed((()=>this._cells)),this.primary=t.computed((()=>this._ids["--id"])),this.parent=t.computed((()=>this._ids["--parentid"])),this.recursive=t.computed((()=>this._ids["--recursive-id"]))}set children(e){this._children=e}get children(){return this._children}setMode(e){for(let t in this._cells)"--id"!=t&&"--parentid"!=t&&("date-created"!=t&&"last-updated"!=t||"filter"==e)&&(this._cells[t].mode=e)}getCell(e){return this._cells[e]}clone(){const e=new Be(this._metarow);let t={};for(let e in this._cells)t[e].val=this._cells[e].val;let l={};for(let t in e.children)l[t]=e.children[t].clone();return e.children=l,e}applyMetaRow(e){for(const t in e.cells){const l=e.cells[t];this._cells[l.name]=new _e(l)}for(const t in e.children)this._children[t]=e.children[t];let t=e.state_groups;for(let e in t)for(let l in t[e]){const n=this;let o=ye(e,t[e][l],(t=>{n._cells[e].resetMeta(t)}));this._cells[l].listeners.push(o)}}addChild(e,t){this._children[e]||(this._children[e]=[]),this._children[e].push(t)}set row(e){if(e){e["--id"]&&(this._ids["--id"]=e["--id"]),e["--parentid"]&&(this._ids["--parentid"]=e["--parentid"]),e["--recursive-id"]&&(this._ids["--recursive-id"]=e["--recursive-id"]);for(let t in this._cells)e.hasOwnProperty(t)&&(this._cells[t].val=e[t],this._cells[t].display=e);for(let t in this._children)this._children[t].row=e[t]}}set filter(e){if(e)for(let t in this._cells)e.hasOwnProperty(t)&&(this._cells[t].filter=e[t])}getSummary(){let e=[];for(let t in this._cells){const l=this._cells[t];if(l.isSummary()){const t=l.display;e.push(t)}}return e.join(" ")}toString(){let e=[];for(let t in this._cells)e.push(this._cells[t].display);return e.join(" ")}serialize(e=!1){let t={};for(let l in this._cells)e?this._cells[l].change!=this._cells[l].val&&(t[l]=this._cells[l].change):null!=this._cells[l].change&&(t[l]=this._cells[l].change);return t}getCellByType(e){let t={};for(let l in this._cells)this._cells[l].type==e&&(t[l]=this._cells[l]);return t}clearErrors(){for(let e in this._cells)this._cells[e].error=0}reset(){for(let e in this._cells)this._cells[e].error=0,this._cells[e].change=null}setErrors(e){for(let t in e)0!==t.indexOf("__")&&this._cells[t]&&(this._cells[t].error=e[t])}convertToParams(){let e={};for(let t in this._cells)this._cells[t].addParam(e);return e}convertToAPIParams(){let e={};for(let t in this._cells)"asset"!=this._cells[t].type&&this._cells[t].addAPIParam(e);return e}applyChangeData(){for(let e in this._cells)this._cells[e].val=this._cells[e].change}}const be=t.reactive({meta:new ve,data:[],indexes:{},search:new Be});function we(){be.indexes={};for(const e in be.data){let t=be.data[e].cells[be.meta.store.index].val;be.indexes[t]||(be.indexes[t]=[]),be.indexes[t].push(e)}}function je(e){be.data=[];for(const t in e){let l=new Be(be.meta);l.row=e[t],be.data.push(l)}}function Ee(){be.meta=new ve,be.data=[],be.indexes={},be.search=new Be,be.max_pages=0}const Ve=async()=>{let e=d();Ee();let t=function(e){let t={};return t||(t={}),i.to&&(t.__to=i.to),e.to&&(t.__to=e.to),i.key&&(t["--parentid"]=i.key),e.limit&&(t.__limit=e.limit),e.fields&&(t.__fields=e.fields),e.group&&(t.group=e.group),i.params._page&&(t.__limit=(i.params._page-1)*t.__limit+","+t.__limit),t}(e),l=i.model;return"parent"==i.state&&(l+="/parent"),a.get("/meta/"+l,t).then((t=>{be.meta.map(t.fields,e.fields),"all"==e.show&&be.meta.showAll(),be.search.applyMetaRow(be.meta),be.search.setMode("filter"),be.search.filter=i.params,be.meta.init=!0,e.component?be.component=e.component:be.meta.cells?be.component=be.meta.store.index||be.meta.children.length>0?"tree":"table":be.component=""})).then((()=>(t={...t,...be.search.convertToAPIParams()},e.limit>0?a.get("/count/"+l,t).then((t=>{be.max_pages=Math.ceil(t.count/e.limit)})).then((()=>a.get("/data/"+l,t))).then((e=>(je(e),be.meta.store.index&&we(),e))):a.get("/data/"+l,t).then((e=>(je(e),be.meta.store.index&&we(),e)))))).catch((e=>console.log(e)))};const Ne=e=>(t.pushScopeId("data-v-1dcaa9f5"),e=e(),t.popScopeId(),e),Ce=["id"],xe={class:"ptj-tree-node-row"},Se=[Ne((()=>t.createElementVNode("span",{class:"material-icons"},"subdirectory_arrow_right",-1)))],De=[Ne((()=>t.createElementVNode("span",{class:"material-icons"},"keyboard_arrow_right",-1)))],Fe={key:0},Te=[Ne((()=>t.createElementVNode("span",{class:"material-icons"},"drag_handle",-1)))],Me=Ne((()=>t.createElementVNode("span",{class:"material-icons"},"arrow_forward_ios",-1)));var Le={props:{row:{type:[String,Number],required:!0},draggable:Boolean,ischild:{type:Boolean,default:!1}},setup(e){const l=e,n=t.reactive({toggle_state:{},branch:null});function o(){const e=n.branch.primary;n.toggle_state[e]=!n.toggle_state[e]}const r=t.computed((()=>{if(!n.branch)return[];const e=n.branch.primary;return be.indexes[e]?be.indexes[e]:[]})),a=t.computed((()=>n.branch?n.branch.primary:0)),i=t.computed((()=>n.branch?n.branch.getSummary():""));return t.onMounted((()=>{n.branch=be.data[l.row]})),(l,s)=>{const c=t.resolveComponent("ptj-tree-node",!0);return t.openBlock(),t.createElementBlock("div",{class:"ptj-tree-node ptj-draggable",id:t.unref(a),draggable:"false"},[t.createElementVNode("div",xe,[t.createElementVNode("div",null,[e.ischild?(t.openBlock(),t.createElementBlock("a",{key:0,"data-action":"more",class:"button",onClick:s[0]||(s[0]=t.withModifiers((e=>o()),["prevent","stop"]))},Se)):(t.openBlock(),t.createElementBlock("a",{key:1,"data-action":"more",class:"button",onClick:s[1]||(s[1]=t.withModifiers((e=>o()),["prevent","stop"]))},De))]),t.unref(be).meta.sortable?(t.openBlock(),t.createElementBlock("div",Fe,[t.createElementVNode("a",{"data-action":"more",class:"button",onClick:s[2]||(s[2]=(...e)=>l.prevent.stop&&l.prevent.stop(...e)),onMousedown:s[3]||(s[3]=(...e)=>l.setDraggable&&l.setDraggable(...e)),onMouseup:s[4]||(s[4]=(...e)=>l.endDraggable&&l.endDraggable(...e))},Te,32)])):t.createCommentVNode("v-if",!0),t.createElementVNode("div",null,t.toDisplayString(t.unref(i)),1),t.createVNode(k,{route:{state:"primary",key:t.unref(a)}},{default:t.withCtx((()=>[Me])),_:1},8,["route"])]),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(r),((e,l)=>t.withDirectives((t.openBlock(),t.createBlock(c,{row:e,ischild:!0,key:l},null,8,["row"])),[[t.vShow,t.unref(n).toggle_state[t.unref(a)]]]))),128))],8,Ce)}}};n("\n.model-tree.branch[data-v-1dcaa9f5] {\r\n  padding-left: 8px;\r\n  padding-right: 8px;\r\n  margin: 6px 0;\r\n  background-color:#111111;\n}\n.tree .ide-block[data-v-1dcaa9f5] {\r\n\tdisplay : none;\n}\n.dragArea[data-v-1dcaa9f5] {\r\n  min-height: 50px;\r\n  outline: 1px solid #777777;\n}\r\n\r\n\r\n"),Le.__scopeId="data-v-1dcaa9f5",Le.__file="presstojam/src/components/ptj-tree-node.vue";const Pe={class:"ptj-tree ptj-drop-target'",ref:"treeroot"};var Oe={setup:e=>(e,l)=>(t.openBlock(),t.createElementBlock("div",Pe,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(be).indexes[0],((e,l)=>(t.openBlock(),t.createBlock(Le,{key:l,row:e},null,8,["row"])))),128))],512)),__file:"presstojam/src/components/ptj-tree.vue"};const ze=["name"],Ae={key:1},Ue=["name"],Re=t.createTextVNode(" - "),Ie=["name"],Je={key:2};var $e={props:{field:Object},setup(e){const l=e,n=t.computed((()=>{let e={};if(l.field.meta.round){let t="0.";for(let e=0;e<l.field.meta.round-1;++e)t+="0";t+="1",e.step=t}return e}));return(l,o)=>"edit"==e.field.mode||"post"==e.field.mode?t.withDirectives((t.openBlock(),t.createElementBlock("input",t.mergeProps({key:0,class:"ptj-form-number",name:e.field.name,type:"number","onUpdate:modelValue":o[0]||(o[0]=t=>e.field.change=t)},t.unref(n),{onBlur:o[1]||(o[1]=t=>e.field.validateon=!0)}),null,16,ze)),[[t.vModelText,e.field.change]]):"filter"==e.field.mode?(t.openBlock(),t.createElementBlock("div",Ae,[t.withDirectives(t.createElementVNode("input",t.mergeProps({class:"ptj-form-filter-number ptj-min",name:e.field.name,type:"number","onUpdate:modelValue":o[2]||(o[2]=t=>e.field.change1=t)},t.unref(n),{onBlur:o[3]||(o[3]=t=>e.field.validateon=!0)}),null,16,Ue),[[t.vModelText,e.field.change1]]),Re,t.withDirectives(t.createElementVNode("input",t.mergeProps({class:"ptj-form-filter-number ptj-max",name:e.field.name,type:"number","onUpdate:modelValue":o[4]||(o[4]=t=>e.field.change2=t)},t.unref(n),{onBlur:o[5]||(o[5]=t=>e.field.validateon=!0)}),null,16,Ie),[[t.vModelText,e.field.change2]])])):(t.openBlock(),t.createElementBlock("span",Je,t.toDisplayString(e.field.val),1))},__file:"presstojam/src/components/ptj-number.vue"};const qe=["name"],He=["name"],Xe=[t.createElementVNode("option",{value:0},t.toDisplayString("All"),-1),t.createElementVNode("option",{value:1},t.toDisplayString("Checked"),-1),t.createElementVNode("option",{value:2},t.toDisplayString("Unchecked"),-1)],Ye={class:"material-icons"};var Ge={props:{field:Object,id:Number},setup(e){const l=e;let n=t.computed((()=>1==l.field.val?"check_circle_outline":"highlight_off"));return(o,r)=>"edit"==e.field.mode||"post"==e.field.mode?t.withDirectives((t.openBlock(),t.createElementBlock("input",{key:0,class:"ptj-checkbox",type:"checkbox","true-value":1,"false-value":0,name:e.field.name,"onUpdate:modelValue":r[0]||(r[0]=t=>e.field.change=t)},null,8,qe)),[[t.vModelCheckbox,e.field.change]]):"filter"==e.field.mode?t.withDirectives((t.openBlock(),t.createElementBlock("select",{key:1,name:e.field.name,"onUpdate:modelValue":r[1]||(r[1]=t=>e.field.change1=t),class:"ptj-filter-form-checkbox"},Xe,8,He)),[[t.vModelSelect,e.field.change1]]):(t.openBlock(),t.createElementBlock("a",{key:2,onClick:r[2]||(r[2]=e=>function(){let e={};return e["--id"]=l.id,e[l.field.name]=1==l.field.val?0:1,a.put("/data/"+i.model,e).then((()=>{l.field.val=1==l.field.val?0:1})).catch((e=>{console.log(e)}))}())},[t.createElementVNode("span",Ye,t.toDisplayString(t.unref(n)),1)]))},__file:"presstojam/src/components/ptj-flag.vue"};const We=["name"],Ze={value:"0",selected:""},Ke=["value"],Qe={key:2};var et={props:{field:Object,parent:Number},setup(e){const l=e,n=t.ref([]);return t.computed((()=>"edit"==l.type&&l.field.immutable?"view":l.type)),(l.field.meta.reference||l.field.meta.recursive)&&t.onMounted((()=>{!async function(){let e="/reference/"+i.model+"/";e+=l.field.meta.reference?l.field.name:"id",n.value=await l.field.meta.setReferenceOptions(e,{"--parentid":l.parent})}()})),(l,o)=>"edit"==e.field.mode||"post"==e.field.mode?t.withDirectives((t.openBlock(),t.createElementBlock("select",t.mergeProps({key:0,"onUpdate:modelValue":o[0]||(o[0]=t=>e.field.change=t)},e.field.atts,{name:e.field.name,onBlur:o[1]||(o[1]=t=>e.field.validateon=!0)}),[t.createElementVNode("option",Ze,t.toDisplayString(t.unref(T)("ptj-id-default")),1),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(n.value,(e=>(t.openBlock(),t.createElementBlock("option",{key:e.key,value:e.key},t.toDisplayString(e.value),9,Ke)))),128))],16,We)),[[t.vModelSelect,e.field.change]]):"filter"==e.field.mode?(t.openBlock(),t.createBlock(D,{key:1,field:e.field,options:n.value},null,8,["field","options"])):(t.openBlock(),t.createElementBlock("span",Qe,t.toDisplayString(e.field.display),1))},__file:"presstojam/src/components/ptj-id.vue"};const tt=["name"],lt={key:1},nt=["name"],ot=t.createTextVNode(" - "),rt=["name"],at={key:2};var it={props:{field:Object},setup:e=>(l,n)=>"edit"==e.field.mode||"post"==e.field.mode?t.withDirectives((t.openBlock(),t.createElementBlock("input",t.mergeProps({key:0,name:e.field.name,type:"datetime-local","onUpdate:modelValue":n[0]||(n[0]=t=>e.field.change=t)},e.field.atts,{onBlur:n[1]||(n[1]=t=>e.field.validateon=!0)}),null,16,tt)),[[t.vModelText,e.field.change]]):"filter"==e.field.mode?(t.openBlock(),t.createElementBlock("div",lt,[t.withDirectives(t.createElementVNode("input",t.mergeProps({type:"datetime-local",name:e.field.name+"min"},e.field.atts,{"onUpdate:modelValue":n[2]||(n[2]=t=>e.field.change1=t)}),null,16,nt),[[t.vModelText,e.field.change1]]),ot,t.withDirectives(t.createElementVNode("input",t.mergeProps({type:"datetime-local",name:e.field.name+"max"},e.field.atts,{"onUpdate:modelValue":n[3]||(n[3]=t=>e.field.change2=t)}),null,16,rt),[[t.vModelText,e.field.change2]])])):(t.openBlock(),t.createElementBlock("span",at,t.toDisplayString(e.field.val),1)),__file:"presstojam/src/components/ptj-time.vue"};const st=["name"],ct={key:1},dt=[t.createElementVNode("span",{class:"material-icons"},"download",-1)];var pt={props:{field:Object,id:Number},setup(e){const l=e;return(n,o)=>"edit"==e.field.mode||"post"==e.field.mode?(t.openBlock(),t.createElementBlock("input",{key:0,class:"ptj-form-asset",ref:"input",onChange:o[0]||(o[0]=(...e)=>n.setFile&&n.setFile(...e)),name:e.field.meta.name,type:"file"},null,40,st)):(t.openBlock(),t.createElementBlock("span",ct,[t.createTextVNode(t.toDisplayString(e.field.val)+" ",1),t.createElementVNode("a",{onClick:o[1]||(o[1]=e=>{a.getAsset("/asset/"+l.field.model+"/"+l.field.name+"/"+l.id).then((e=>{const t=document.createElement("a"),n=URL.createObjectURL(e);t.href=n,t.download=l.field.val,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(n)})).catch((e=>{console.log(e)}))})},dt)]))},__file:"presstojam/src/components/ptj-asset.vue"};const ut=["onUpdate:modelValue"],mt={class:"ptj-selectfields-label"};var ft={setup:e=>(e,l)=>(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(be).meta.cells,((e,l)=>(t.openBlock(),t.createElementBlock("div",{key:l},[t.withDirectives(t.createElementVNode("input",{type:"checkbox","onUpdate:modelValue":t=>e.summary=t,"true-value":1,"false-value":0,class:"ptj-selectfields-checkbox"},null,8,ut),[[t.vModelCheckbox,e.summary]]),t.createElementVNode("label",mt,t.toDisplayString(t.unref(T)("label",{field:e.name,model:e.model})),1)])))),128)),__file:"presstojam/src/components/ptj-selectfields.vue"};const ht=e=>(t.pushScopeId("data-v-15ab9672"),e=e(),t.popScopeId(),e),gt={class:"ptj-table-wrapper"},kt=["onClick"],vt={key:0,class:"material-icons"},_t={key:1,class:"material-icons"},yt={class:"ptj-actions"},Bt=ht((()=>t.createElementVNode("span",{class:"material-icons"},"add",-1))),bt={class:"ptj-actions"},wt=ht((()=>t.createElementVNode("span",{class:"material-icons"},"arrow_forward_ios",-1)));var jt={setup(e){let n=d(),o=t.reactive({name:"",dir:""});const r=t.ref(null);return(e,a)=>(t.openBlock(),t.createElementBlock("div",gt,[t.createElementVNode("table",{class:t.normalizeClass(["ptj-table",i.model])},[t.createElementVNode("thead",null,[t.createElementVNode("tr",{class:"ptj-table-header",ref_key:"tableheader",ref:r},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(be).meta.cells,(e=>t.withDirectives((t.openBlock(),t.createElementBlock("th",{key:e.name,class:t.normalizeClass(["ptj-table-header-cell",e.name]),onClick:t=>{!function(e){if(be.meta.pages>0){o.dir=!o.name!=e||"desc"==o.dir?"asc":"desc",o.name=e;let t=[];t[o.name]=o.dir,be.meta.sort=t,load()}else o.name!=e||"desc"==o.dir?(be.data.sort((function(t,l){let n=t.getCell(e).val,o=l.getCell(e).val;return n<o?-1:n>o?1:0})),o.name=e,o.dir="asc"):(be.data.sort((function(t,l){let n=t.getCell(e).val,o=l.getCell(e).val;return n<o?1:n>o?-1:0})),o.name=e,o.dir="desc")}(e.name)}},[t.createTextVNode(t.toDisplayString(t.unref(T)("label",{model:e.model,field:e.name,default:e.name}))+" ",1),t.unref(o).name==e.name&&"asc"==t.unref(o).dir?(t.openBlock(),t.createElementBlock("span",vt,"keyboard_arrow_up")):t.createCommentVNode("v-if",!0),t.unref(o).name==e.name&&"desc"==t.unref(o).dir?(t.openBlock(),t.createElementBlock("span",_t,"keyboard_arrow_down")):t.createCommentVNode("v-if",!0)],10,kt)),[[t.vShow,e.summary]]))),128)),t.createElementVNode("th",yt,[1!=t.unref(n).disable_selectfields?(t.openBlock(),t.createBlock(l,{key:0,location:!1,relative:r.value},{button:t.withCtx((()=>[Bt])),default:t.withCtx((()=>[t.createVNode(ft)])),_:1},8,["relative"])):t.createCommentVNode("v-if",!0)])],512)]),t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(be).data,((e,l)=>(t.openBlock(),t.createElementBlock("tr",{key:l,class:"ptj-table-row"},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.cells,((l,n)=>t.withDirectives((t.openBlock(),t.createElementBlock("td",{key:n,class:t.normalizeClass(["ptj-table-cell",l.name])},["asset"==l.type?(t.openBlock(),t.createBlock(pt,{key:0,field:l,id:e.primary},null,8,["field","id"])):"number"==l.type?(t.openBlock(),t.createBlock($e,{key:1,field:l},null,8,["field"])):"flag"==l.type?(t.openBlock(),t.createBlock(Ge,{key:2,field:l,id:e.primary},null,8,["field","id"])):"id"==l.type?(t.openBlock(),t.createBlock(et,{key:3,field:l},null,8,["field"])):"time"==l.type?(t.openBlock(),t.createBlock(it,{key:4,field:l},null,8,["field"])):"string"==l.type?(t.openBlock(),t.createBlock(ne,{key:5,field:l},null,8,["field"])):t.createCommentVNode("v-if",!0)],2)),[[t.vShow,l.summary]]))),128)),t.createElementVNode("td",bt,[t.createVNode(k,{route:{state:"primary",key:e.primary}},{default:t.withCtx((()=>[wt])),_:2},1032,["route"])])])))),128))])],2)]))}};n("\ntable[data-v-15ab9672], thead[data-v-15ab9672], tbody[data-v-15ab9672], tr[data-v-15ab9672] {\r\n    width : 100%;\n}\n.ptj-table-wrapper[data-v-15ab9672] {\r\n    position : relative;\n}\r\n\r\n"),jt.__scopeId="data-v-15ab9672",jt.__file="presstojam/src/components/ptj-table.vue";var Et={setup(e){t.inject("data"),t.inject("indexes");const l=t.computed((()=>{let e=[];for(let t in indexes)e=this.getCombinations(t,indexes[t],e);return e}));return(e,n)=>(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(l),((l,n)=>(t.openBlock(),t.createElementBlock("div",{key:n},[t.createElementVNode("h3",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(l.tags,((e,l)=>(t.openBlock(),t.createElementBlock("span",{key:l},t.toDisplayString(e)+" ",1)))),128))]),t.createElementVNode("ul",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(l.data,(l=>(t.openBlock(),t.createElementBlock("li",{key:l},[t.createVNode(k,{route:e.route},{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(e.data[l].getSummary()),1)])),_:2},1032,["route"])])))),128))])])))),128))},__file:"presstojam/src/components/ptj-list.vue"};const Vt=["onSubmit"],Nt=["onClick"],Ct=["value"];var xt={setup(e){function l(){be.search.applyChangeData(),i.params=be.search.convertToParams(),h(),Ve()}return(e,n)=>(t.openBlock(),t.createElementBlock("form",{onSubmit:t.withModifiers(l,["prevent"]),class:"ptj-filter-form"},[t.createElementVNode("h3",null,t.toDisplayString(t.unref(T)("ptj-filter-form-title")),1),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(be).search.cells,(e=>t.withDirectives((t.openBlock(),t.createBlock(I,{key:e.name,field:e},{default:t.withCtx((()=>["id"==e.type?(t.openBlock(),t.createBlock(et,{key:0,field:e,parent:i.key},null,8,["field","parent"])):"flag"==e.type?(t.openBlock(),t.createBlock(Ge,{key:1,field:e},null,8,["field"])):"number"==e.type?(t.openBlock(),t.createBlock($e,{key:2,field:e},null,8,["field"])):"time"==e.type?(t.openBlock(),t.createBlock(it,{key:3,field:e},null,8,["field"])):"string"==e.type?(t.openBlock(),t.createBlock(ne,{key:4,field:e},null,8,["field"])):t.createCommentVNode("v-if",!0),t.createElementVNode("a",{class:"ptj-filter-form-reset",onClick:t=>e.reset()},"x",8,Nt)])),_:2},1032,["field"])),[[t.vShow,"id"!=e.type||e.meta.reference||e.meta.recursive]]))),128)),t.createElementVNode("input",{type:"submit",value:t.unref(T)("ptj-filter-form-btn"),class:"ptj-filter-form-submit",onClick:n[0]||(n[0]=t=>{e.$emit("close")})},null,8,Ct)],40,Vt))}};n("\n.error[data-v-71ada21d] {\r\n  color : red;\n}\r\n\r\n"),xt.__scopeId="data-v-71ada21d",xt.__file="presstojam/src/components/ptj-filter-form.vue";const St={class:"ptj-pagination"},Dt=["onClick"];var Ft={setup(e){function l(e){return e==i.params._page??1?"ptj-pagination-active":""}return(e,n)=>(t.openBlock(),t.createElementBlock("div",St,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(be).max_pages,(e=>(t.openBlock(),t.createElementBlock("a",{key:e,onClick:t=>{return l=e,i.params._page=l,h(),void Ve();var l},class:t.normalizeClass(l(e))},t.toDisplayString(e),11,Dt)))),128))]))},__file:"presstojam/src/components/ptj-pagination.vue"};const Tt={class:"ptj-progress-bar-wrapper"},Mt={class:"ptj-progress-holder"};var Lt={props:{total:Number,progress:Number},setup(e){const l=e,n=t.computed((()=>{let e=Math.floor(l.progress/l.total*100);return isNaN(e)?0:e}));return(e,l)=>(t.openBlock(),t.createElementBlock("div",Tt,[t.createElementVNode("div",Mt,[t.createElementVNode("div",{class:"ptj-progress-bar",style:t.normalizeStyle("width:"+t.unref(n)+"px")}," ",4)]),t.createElementVNode("span",null,t.toDisplayString(t.unref(n))+"%",1)]))}};n("\n.ptj-progress-holder[data-v-460b10ff] {\r\n     width : 100%;\r\n     min-height : 10px;\r\n     position : relative;\r\n     display : flex;\r\n     align-items: stretch;\r\n     padding : 2px;\n}\n.ptj-progress-bar[data-v-460b10ff] {\r\n     width : 0;\r\n     height : 100%;\r\n     position : relative;\r\n     line-height : 100%;\n}\r\n\r\n\r\n"),Lt.__scopeId="data-v-460b10ff",Lt.__file="presstojam/src/components/ptj-progress-bar.vue";const Pt=["onSubmit"],Ot=["value"];var zt={emits:["close"],setup(e,{emit:l}){let n=t.ref("");const o=t.reactive(new Be),r=t.reactive({total:0,progress:0});let s=0;function c(){s=r.total>0?1:2,o.clearErrors();let e=o.serialize();return i.key&&(e["--parentid"]=i.key),a.post("/data/"+i.model,e).then((e=>{let t=[],l=o.getCellByType("asset");r.total=0;for(let n in l){if(!l[n].val)continue;++r.total;const o=new Asset;o.url="/asset/"+i.model+"/"+n+"/"+e["--id"];let a=o.saveFile(l[n].val).then((()=>{++r.progress}));t.push(a)}return Promise.all(t)})).then((()=>{o.reset(),Ve(),l("close")})).catch((e=>(s=0,e.json().then((e=>{const t=e.exception[0];"PressToJamCore\\Exceptions\\ValidationException"==t.type&&o.setErrors(JSON.parse(t.message)),console.log("Err response",e)})))))}return t.onMounted((async()=>{await(async()=>a.post("/meta/"+i.model).then((e=>{const t=new ve;t.map(e.fields),o.applyMetaRow(t),o.setMode("post");let l=[];for(let e in t.cells)if("id"==t.cells[e].type&&t.cells[e].reference){let n="/reference/"+i.model+"/"+e;l.push(t.cells[e].setReferenceOptions(n,{"--parentid":i.key}))}return Promise.all(l)})).catch((e=>console.log(e))))()})),(e,l)=>t.withDirectives((t.openBlock(),t.createElementBlock("form",{onSubmit:t.withModifiers(c,["prevent"]),class:t.normalizeClass(["ptj-form",i.model+" "+i.state])},[t.withDirectives(t.createElementVNode("div",{class:"ptj-form-error"},t.toDisplayString(t.unref(n)),513),[[t.vShow,t.unref(n)]]),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(o).cells,(e=>(t.openBlock(),t.createBlock(I,{key:e.name,field:e},{default:t.withCtx((()=>["asset"==e.type?(t.openBlock(),t.createBlock(pt,{key:0,field:e},null,8,["field"])):"number"==e.type?(t.openBlock(),t.createBlock($e,{key:1,field:e},null,8,["field"])):"flag"==e.type?(t.openBlock(),t.createBlock(Ge,{key:2,field:e},null,8,["field"])):"id"==e.type?(t.openBlock(),t.createBlock(et,{key:3,field:e,parent:i.key},null,8,["field","parent"])):"time"==e.type?(t.openBlock(),t.createBlock(it,{key:4,field:e},null,8,["field"])):"string"==e.type?(t.openBlock(),t.createBlock(ne,{key:5,field:e},null,8,["field"])):t.createCommentVNode("v-if",!0),e.encrypted?(t.openBlock(),t.createBlock(I,{key:6,field:e},{default:t.withCtx((()=>[t.createVNode($,{field:e},null,8,["field"])])),_:2},1032,["field"])):t.createCommentVNode("v-if",!0)])),_:2},1032,["field"])))),128)),t.createElementVNode("input",{type:"submit",value:t.unref(T)("ptj-create-form-btn"),class:"ptj-form-submit"},null,8,Ot),t.withDirectives(t.createVNode(Lt,{total:t.unref(r).total,progress:t.unref(r).progress},null,8,["total","progress"]),[[t.vShow,1==t.unref(s)]])],42,Pt)),[[t.vShow,0==t.unref(s)]])},__file:"presstojam/src/components/ptj-create-form.vue"};const At=["id"];var Ut={emits:["reorder"],setup(e,{emit:l}){let n,o=0,r=0;function s(e){const t=e.target;n=t,e.dataTransfer.dropEffect="move",n.style.opacity="0.4",o=e.clientX,r=e.clientY}function c(){n.style.opacity="1.0"}function d(e){e.preventDefault(),e.dataTransfer.dropEffect="move";const t=(l=e.clientX,a=e.clientY,{x:l==o?0:l>o?1:-1,y:a==r?0:a>r?1:-1});var l,a,i;1==t.y?(i=e.target.closest(".ptj-drag-target")).nextElementSibling?i.parentNode.insertBefore(n,i.nextElementSibling):i.parentNode.append(n):-1==t.y&&function(e){e.parentNode.insertBefore(n,e)}(e.target.closest(".ptj-drag-target")),o=e.clientX,r=e.clientY}function p(e){e.preventDefault()}function u(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function m(e){e.preventDefault(),e.dataTransfer.dropEffect="move";let t=function(){let e=[];const t=n.closest(".ptj-drop-target").querySelectorAll(".ptj-drag-target");for(let l=0;l<t.length;++l)e.push({"--id":t[l].getAttribute("id"),"--sort":l+1});return e}(),o="/data/"+i.model+"/resort";a.put(o,{_rows:t}).catch((e=>console.log(e)));const r={};for(let e of t)r[e["--id"]]=e["--sort"];l("reorder",r)}return(e,l)=>(t.openBlock(),t.createElementBlock("div",{class:"ptj-drop-target",onDragover:u,onDragenter:d,onDragleave:p,onDrop:m},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(be).data,((e,l)=>(t.openBlock(),t.createElementBlock("div",{key:l,id:e.primary,class:"ptj-drag-target",draggable:"true",onDragstart:s,onDragend:c},[t.createElementVNode("span",null,t.toDisplayString(e.getSummary()),1)],40,At)))),128))],32))},__file:"presstojam/src/components/ptj-sort.vue"};const Rt=e=>(t.pushScopeId("data-v-1c7fb47e"),e=e(),t.popScopeId(),e),It=Rt((()=>t.createElementVNode("span",{class:"material-icons"},"search",-1))),Jt=Rt((()=>t.createElementVNode("span",{class:"material-icons"},"sort",-1)));var $t={setup(e){let n=d();function o(e){!function(e){const t=[];t.length=be.data.length;for(let l in be.data)t[e[be.data[l].primary]-1]=be.data[l];be.data=t}(e)}return t.onMounted((async()=>{await Ve()})),t.onBeforeUnmount((()=>{Ee()})),(e,r)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass([Map.model,Map.state])},[t.unref(c).route.perms.includes("post")?(t.openBlock(),t.createBlock(l,{key:0},{button:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(t.unref(T)("ptj-repo-post")),1)])),default:t.withCtx((e=>[t.createVNode(zt,{onClose:e.toggleShow},null,8,["onClose"])])),_:1})):t.createCommentVNode("v-if",!0),1!=t.unref(n).disable_filter?(t.openBlock(),t.createBlock(l,{key:1},{button:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(t.unref(T)("ptj-repo-search"))+" ",1),It])),default:t.withCtx((e=>[t.createVNode(xt,{onClose:e.toggleShow},null,8,["onClose"])])),_:1})):t.createCommentVNode("v-if",!0),1!=t.unref(n).disable_sort&&t.unref(c).sort&&t.unref(c).route.perms.includes("put")?(t.openBlock(),t.createBlock(l,{key:2},{button:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(t.unref(T)("ptj-repo-sort"))+" ",1),Jt])),default:t.withCtx((e=>[t.createVNode(Ut,{onClose:e.toggleShow,onReorder:o},null,8,["onClose"])])),_:1})):t.createCommentVNode("v-if",!0),"tree"==t.unref(be).component?(t.openBlock(),t.createBlock(Oe,{key:3})):"list"==t.unref(be).component?(t.openBlock(),t.createBlock(Et,{key:4})):"table"==t.unref(be).component?(t.openBlock(),t.createBlock(jt,{key:5})):t.createCommentVNode("v-if",!0),t.unref(be).max_pages>0?(t.openBlock(),t.createBlock(Ft,{key:6})):t.createCommentVNode("v-if",!0)],2))}};n("\n.table[data-v-1c7fb47e], .thead[data-v-1c7fb47e], .tbody[data-v-1c7fb47e], .tr[data-v-1c7fb47e] {\r\n    width : 100%;\n}\r\n\r\n"),$t.__scopeId="data-v-1c7fb47e",$t.__file="presstojam/src/components/ptj-repo.vue";const qt=["placeholder"],Ht=["disabled"];var Xt={props:{check_str:{type:String,default:"delete"},parentid:{default:0}},emits:["close"],setup(e,{emit:l}){const n=e;let o=t.ref(""),r=t.ref(!0),s=t.computed((()=>T("ptj-delete-title",{val:n.check_str}))),c=t.computed((()=>T("ptj-delete-btn")));function d(){r.value=o.value!=n.check_str}function p(){a.delete("/data/"+i.model,{"--id":i.key}).then((e=>{i.state="parent",i.key=n.parentid.val,f()})).catch((e=>console.log(e)))}return(l,n)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.createElementVNode("p",null,t.toDisplayString(t.unref(s)),1),t.withDirectives(t.createElementVNode("input",{type:"text",placeholder:e.check_str,onKeyup:d,"onUpdate:modelValue":n[0]||(n[0]=e=>t.isRef(o)?o.value=e:o=e)},null,40,qt),[[t.vModelText,t.unref(o)]]),t.createElementVNode("button",{disabled:t.unref(r),onClick:p},t.toDisplayString(t.unref(c)),9,Ht)],64))},__file:"presstojam/src/components/ptj-delete.vue"};const Yt=["value"],Gt={class:"ptj-children"};var Wt={setup(e){const n=t.reactive({data:new Be,fstate:-1,type:"view",show_def:!1,progress:{total:0,progress:0}});function o(){n.type="view"==n.type?"edit":"view",n.data.setMode(n.type),n.fstate=0}let r=t.computed((()=>"edit"==n.type?"view":"edit"));const s=async()=>{let e=d(),t=function(e){let t={};return i.to&&(t.__to=i.to),i.key&&("first"==i.key?t.__limit=1:t["--id"]=i.key),e.fields&&(t.__fields=e.fields),t}(e);return a.get("/meta/"+i.model+"/primary",t).then((t=>{const l=new ve;l.map(t.fields,e.fields??[]),n.data.applyMetaRow(l)})).then((()=>a.get("/data/"+i.model+"/primary",t))).then((e=>{n.data.row=e;for(let e in n.data.cells)n.data.cells[e].change=n.data.cells[e].val;n.fstate=0})).catch((e=>console.log(e)))};function p(){n.fstate=n.progress.total>0?1:2,n.data.clearErrors();let e=n.data.serialize(!0);if(0!=Object.keys(e).length)return e["--id"]=i.key,a.put("/data/"+i.model,e).then((e=>{let t=[],l=n.data.getCellByType("asset");n.progress.total=0;for(let o in l){if(!l[o].val)continue;++n.progress.total;const r=new Asset;r.url="/asset/"+i.model+"/"+o+"/"+e["--id"];let a=r.saveFile(l[o].val).then((()=>{++n.progress.progress}));t.push(a)}return Promise.all(t)})).then((()=>{for(let e in n.data.cells)n.data.cells[e].val=n.data.cells[e].change})).then((()=>{o()})).catch((e=>{if(n.fstate=0,"string"!=typeof e)return e.json().then((e=>{const t=e.exception[0];"PressToJamCore\\Exceptions\\ValidationException"==t.type&&n.data.setErrors(JSON.parse(t.message))}));globalerror=e}));o()}return t.onMounted((async()=>{await s()})),t.onBeforeUnmount((()=>{n.data=new Be,n.fstate=0,n.type="view",n.show_def=!1,n.progress={total:0,progress:0}})),(e,a)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.unref(c).route.perms.includes("put")?(t.openBlock(),t.createElementBlock("a",{key:0,onClick:o,class:"ptj-edit-toggle"},t.toDisplayString(t.unref(r)),1)):t.createCommentVNode("v-if",!0),t.unref(c).route.perms.includes("delete")?(t.openBlock(),t.createBlock(l,{key:1,cls:"ptj-del-modal"},{button:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(t.unref(T)("ptj-primary-delete")),1)])),default:t.withCtx((e=>[t.createVNode(Xt,{parentid:t.unref(n).data.parent,onClose:e.toggleShow},null,8,["parentid","onClose"])])),_:1})):t.createCommentVNode("v-if",!0),0==t.unref(n).fstate?(t.openBlock(),t.createElementBlock("div",{key:2,class:t.normalizeClass(["ptj-primary",i.model])},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n).data.cells,(e=>(t.openBlock(),t.createBlock(I,{key:e.name,field:e},{default:t.withCtx((()=>["asset"==e.type?(t.openBlock(),t.createBlock(pt,{key:0,field:e,id:t.unref(n).data.primary},null,8,["field","id"])):"number"==e.type?(t.openBlock(),t.createBlock($e,{key:1,field:e},null,8,["field"])):"flag"==e.type?(t.openBlock(),t.createBlock(Ge,{key:2,field:e,id:t.unref(n).data.primary},null,8,["field","id"])):"id"==e.type?(t.openBlock(),t.createBlock(et,{key:3,field:e,parent:t.unref(n).data.parent},null,8,["field","parent"])):"time"==e.type?(t.openBlock(),t.createBlock(it,{key:4,field:e},null,8,["field"])):"string"==e.type?(t.openBlock(),t.createBlock(ne,{key:5,field:e},null,8,["field"])):t.createCommentVNode("v-if",!0)])),_:2},1032,["field"])))),128)),"edit"==t.unref(n).type?(t.openBlock(),t.createElementBlock("input",{key:0,type:"submit",value:t.unref(T)("ptj-primary-put-btn"),class:"ptj-form-submit",onClick:p},null,8,Yt)):t.createCommentVNode("v-if",!0)],2)):t.createCommentVNode("v-if",!0),t.createElementVNode("div",Gt,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(c).route.children,(e=>(t.openBlock(),t.createBlock(k,{key:e,route:{model:e,state:"parent",key:i.key}},{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(e),1)])),_:2},1032,["route"])))),128))])],64))},__file:"presstojam/src/components/ptj-primary.vue"};const Zt={class:"ptj-account-handler"},Kt=["onSubmit"],Qt=["value"],el=["onSubmit"],tl=["value"],ll=["onSubmit"],nl=["value"];var ol={props:{actions:[]},setup(e){const l=t.reactive({state:"login",active:!0,login_data:new Be,register_data:new Be,forgot_password:new Be,globalerror:""});function n(e){l.state=e}function o(){return l.active=!1,l.globalerror="","login"==l.state?a.post("/login/"+i.route,l.login_data.serialize("login")).then((e=>{m()})).catch((e=>{l.globalerror="Incorrect username / password"})):"forgotpassword"==l.state?a.post("/data/"+i.model+"/forgotpassword",l.forgot_password.serialize("login")).then((e=>{m()})).catch((e=>{l.globalerror="Incorrect username / password"})):a.post("/data/user-login",l.register_data.serialize("post")).then((e=>{m()})).catch((e=>{l.register_data.applyErrors(e)}))}return a.post("/meta/"+i.model).then((e=>{let t=new ve;t.map(e.fields),l.register_data.applyMetaRow(t),l.register_data.setMode("edit")})),a.post("/meta/"+i.model+"/login").then((e=>{let t=new ve;t.map(e.fields),l.login_data.applyMetaRow(t),l.login_data.setMode("edit"),l.forgot_password.applyMetaRow(t)})),(e,r)=>(t.openBlock(),t.createElementBlock("div",Zt,[t.withDirectives(t.createElementVNode("form",{onSubmit:t.withModifiers(o,["prevent"]),class:"ptj-login"},[t.withDirectives(t.createElementVNode("div",{class:"ptj-form-error"},t.toDisplayString(t.unref(l).globalerror),513),[[t.vShow,t.unref(l).globalerror]]),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(l).login_data.cells,(e=>(t.openBlock(),t.createBlock(I,{key:e.meta.name,field:e},{default:t.withCtx((()=>[t.createVNode(ne,{type:"post",field:e},null,8,["field"])])),_:2},1032,["field"])))),128)),t.createElementVNode("input",{type:"submit",value:t.unref(T)("ptj-account-handler-btn-login"),class:"ptj-form-submit"},null,8,Qt),t.unref(c).route.perms.includes("post")?(t.openBlock(),t.createElementBlock("a",{key:0,onClick:r[0]||(r[0]=e=>n("create"))},"Register")):t.createCommentVNode("v-if",!0),t.createElementVNode("a",{onClick:r[1]||(r[1]=e=>n("forgotpassword"))},"Forgotten password?")],40,Kt),[[t.vShow,"login"==t.unref(l).state]]),t.withDirectives(t.createElementVNode("form",{onSubmit:t.withModifiers(o,["prevent"]),class:"ptj-register"},[t.withDirectives(t.createElementVNode("div",{class:"ptj-form-error"},t.toDisplayString(t.unref(l).globalerror),513),[[t.vShow,t.unref(l).globalerror]]),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(l).register_data.cells,(e=>(t.openBlock(),t.createBlock(I,{key:e.meta.name,field:e},{default:t.withCtx((()=>["number"==e.meta.type?(t.openBlock(),t.createBlock($e,{key:0,type:"post",field:e},null,8,["field"])):"flag"==e.meta.type?(t.openBlock(),t.createBlock(Ge,{key:1,type:"post",field:e},null,8,["field"])):"time"==e.meta.type?(t.openBlock(),t.createBlock(it,{key:2,type:"post",field:e},null,8,["field"])):"string"==e.meta.type?(t.openBlock(),t.createBlock(ne,{key:3,type:"post",field:e},null,8,["field"])):t.createCommentVNode("v-if",!0),e.encrypted?(t.openBlock(),t.createBlock(I,{key:4,field:e},{default:t.withCtx((()=>[t.createVNode($,{field:e},null,8,["field"])])),_:2},1032,["field"])):t.createCommentVNode("v-if",!0)])),_:2},1032,["field"])))),128)),t.createElementVNode("input",{type:"submit",value:t.unref(T)("ptj-account-handler-btn-create"),class:"ptj-form-submit"},null,8,tl),t.unref(c).route.perms.includes("login")?(t.openBlock(),t.createElementBlock("a",{key:0,onClick:r[2]||(r[2]=e=>n("login"))},"Login")):t.createCommentVNode("v-if",!0)],40,el),[[t.vShow,"create"==t.unref(l).state]]),t.withDirectives(t.createElementVNode("form",{onSubmit:t.withModifiers(o,["prevent"]),class:"ptj-register"},[t.withDirectives(t.createElementVNode("div",{class:"ptj-form-error"},t.toDisplayString(t.unref(l).globalerror),513),[[t.vShow,t.unref(l).globalerror]]),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(l).forgot_password.cells,(e=>(t.openBlock(),t.createBlock(I,{key:e.meta.name,field:e},{default:t.withCtx((()=>[t.createVNode(ne,{type:"post",field:e},null,8,["field"]),t.createVNode(I,{field:e},{default:t.withCtx((()=>[t.createVNode($,{field:e},null,8,["field"])])),_:2},1032,["field"])])),_:2},1032,["field"])))),128)),t.createElementVNode("input",{type:"submit",value:t.unref(T)("ptj-account-handler-btn-forgot-password"),class:"ptj-form-submit"},null,8,nl),t.createElementVNode("a",{onClick:r[3]||(r[3]=e=>n("login"))},"Login")],40,ll),[[t.vShow,"forgotpassword"==t.unref(l).state]])]))},__file:"presstojam/src/components/ptj-account-handler.vue"};const rl=t.createElementVNode("div",null,"Loading ...",-1);var al={setup(e){const l=t.computed((()=>c.component?"ptj-primary"==c.component?Wt:"ptj-repo"==c.component?$t:"ptj-account-handler"==c.component?ol:void 0:null));return t.onMounted((()=>(u(),p()))),(e,n)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.createVNode(ce),(t.openBlock(),t.createBlock(t.Suspense,null,{default:t.withCtx((()=>[t.createElementVNode("div",{class:t.normalizeClass([i.model,i.state])},[t.createElementVNode("h1",null,t.toDisplayString(t.unref(c).title),1),t.unref(l)?(t.openBlock(),t.createBlock(t.resolveDynamicComponent(t.unref(l)),{key:0})):t.createCommentVNode("v-if",!0)],2)])),fallback:t.withCtx((()=>[rl])),_:1}))],64))},__file:"presstojam/src/components/ptj-route.vue"};const il={class:"ptj-nav"},sl={key:0};var cl={setup(e){const l=t.reactive({cats:{},routes:[]});return t.onMounted((()=>a.get("/nav/site-map").then((e=>{for(let t in e)if(e[t])for(let n in e[t]){const o={model:n,state:e[t][n].state};e[t][n].default&&(o.default=!0),o.route=n,l.routes.push(o),l.cats[t]||(l.cats[t]=[]),l.cats[t].push(o)}else{const e={route:t,model:t,state:null};l.cats[t]=[e]}})).catch((e=>{console.log(e)})))),(e,n)=>(t.openBlock(),t.createElementBlock("div",il,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(l).cats,((e,l)=>(t.openBlock(),t.createElementBlock("div",{key:l},[e.length>1?(t.openBlock(),t.createElementBlock("span",sl,t.toDisplayString(l),1)):t.createCommentVNode("v-if",!0),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e,(e=>(t.openBlock(),t.createBlock(k,{route:{route:e.route,model:e.model,state:e.state,key:0},key:e.route},{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(e.route),1)])),_:2},1032,["route"])))),128))])))),128))]))},__file:"presstojam/src/components/ptj-site-map.vue"};const dl={class:"ptj-account-details"};var pl={setup:e=>(e,n)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.createElementVNode("div",dl,["public"!=t.unref(oe).user?(t.openBlock(),t.createElementBlock("a",{key:0,class:"ptj-account-details-logout",onClick:n[0]||(n[0]=(...e)=>t.unref(re)&&t.unref(re)(...e))},t.toDisplayString(t.unref(T)("ptj-user-logout")),1)):t.createCommentVNode("v-if",!0)]),t.createVNode(cl),t.createVNode(al),t.unref(oe).login?(t.openBlock(),t.createBlock(l,{key:0})):t.createCommentVNode("v-if",!0)],64))};function ul(e={}){if(e||(e={}),!e.client)throw"Must set client settings";if(!e.client.url)throw"No URL defined for client";return a.initSettings(e.client),e.map&&i.initSettings(e.map),function(e){e&&(s=e)}(e.models),ie(e.user&&e.user.role?e.user.role:"")}pl.__file="presstojam/src/components/ptj-user.vue",e.getClient=function(e){if(!e.client)throw"Must set client settings";if(!e.client.url)throw"No URL defined for client";return a.initSettings(e.client),a},e.runApp=function(e,l){ul(l).then((()=>loadNav())).then((()=>{const l=t.createApp(pl);return l.mount(e),l})).catch((e=>{console.log(e)}))},e.runRoute=function(e,l){ul(l).then((()=>{const l=t.createApp(al);return l.mount(e),l})).catch((e=>{console.log(e)}))}}));
//# sourceMappingURL=ptj.min.js.map
