!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ptj={},e.Vue)}(this,(function(e,t){"use strict";const l={class:"ptj-modal-backdrop"},n={class:"ptj-modal"};var r={props:{active:{required:!0}},setup:e=>(r,o)=>t.withDirectives((t.openBlock(),t.createElementBlock("div",l,[t.createElementVNode("div",n,[t.createElementVNode("header",null,[t.createElementVNode("button",{type:"button",class:"btn-close",onClick:o[0]||(o[0]=e=>{r.$emit("close")})}," x ")]),t.renderSlot(r.$slots,"default")])],512)),[[t.vShow,e.active]]),__file:"presstojam/src/components/ptj-modal.vue"};let o,a={};var i={initSettings(e){if(o=e.url,e.custom_headers)for(let t in e.custom_headers)a[t]=e.custom_headers[t]},run:(e,t)=>(t.mode="cors",t.cache="no-cache",t.credentials="include",t["Content-Type"]="application/json",t.headers=a,fetch(o+e,t).then((e=>{if(e.ok)return e.json();throw e}))),get(e,t){if(t){const l=new URLSearchParams;for(let e in t)Array.isArray(t[e])||"object"==typeof t[e]&&null!==t[e]?l.append(e,JSON.stringify(t[e])):l.append(e,t[e]);-1==e.indexOf("?")?e+="?":e+="&",e+=l.toString()}let l={method:"GET"};return this.run(e,l)},getprimary(e,t){return this.get(e,t)},post(e,t){let l={method:"POST"};return l.body=JSON.stringify(t),this.run(e,l)},put(e,t){let l={method:"PUT"};return l.body=JSON.stringify(t),this.run(e,l)},patch(e,t){let l={method:"PATCH"};return l.body=JSON.stringify(t),this.run(e,l)},delete(e,t){let l={method:"DELETE"};return l.body=JSON.stringify(t),this.run(e,l)}};const s=new class{constructor(){this._route="",this._model="",this._state="",this._key=0,this._to="",this._params={},this._settings={},this._base="/",this._default=!1,this._changes={};Object.keys(this).forEach((e=>{"_"==e[0]&&Object.defineProperty(this,e.substring(1),{get:function(){return this[e]},set:function(t){t!=this[e]&&(this._changes[e.substring(1)]=this[e],this[e]=t)}})})),this.action_map={post:"-create",put:"-update",delete:"-delete",login:"-login",logout:"-logout",primary:"-primary",parent:"-parent",get:""}}get id(){return this.model+"-"+this.state+"-"+this.to}hasChange(e){return this._changes.hasOwnProperty(e)}reset(){this.route="",this.model="",this.state="",this.key=0,this.to="",this.params={},this.settings={},this._changes={}}resetChanges(){this._changes={}}convertToURL(){let e=this._base+this.route+"/"+this.model+this.action_map[this.state];this.key&&(e+="-"+this.key),this.to&&(e+="-to-"+this.to);let t=[];for(const e in this.params)"Array"==typeof this.params[e]||"Object"==typeof this.params[e]?t.push(e+"="+JSON.stringify(this.params[e])):t.push(e+"="+this.params[e]);return t.length>0&&(e+="?"+t.join("&")),e}initSettings(e){e&&(this._base=e.base),this.convertFromURL()}convertFromURL(){let e=new URL(window.location.href),t=e.pathname.replace(this.base,"");if(t=t.replace(/^\/+|\/+$/g,""),!t)return;let l=t.split("/");l.length>=2&&(this.route=l[0],t=l[1]);const n=this;e.searchParams.forEach((function(e,t){n.params[t]=e.indexOf(",")>-1?e.split(","):e})),l=t.split("-to-"),l.length>1&&(this.to=l[1],t=l[0]),l=t.split("-");let r=l[l.length-1];if("first"==r?(this.key=r,l.pop()):isNaN(r)||(this.key=parseInt(r),l.pop()),0==l.length)throw new Error("Can't convert this url string: "+t);this.state="get";for(let e in this.action_map)if(this.action_map[e]=="-"+l[l.length-1]){this.state=e,l.pop();break}this.model=l.join("-"),this.route||(this.route=this.model)}getAll(){return{route:this.route,model:this.model,state:this.state,key:this.key,to:this.to,params:this.params,base:this.base,default:this.default}}apply(e){for(let t in e)this[t]=e[t]}};let c={};function d(e,t,l){if(!c.fields[e])return l;const n=c.fields[e];return n[t]?n[t]:l}let p={};window.onpopstate=function(){s.convertFromURL(),y()};const u=t.reactive({component:"",title:"",name:"",route:{children:[],parent:null,perms:[]},slug:[]});function m(){return p[s.model]&&p[s.model][s.state]?p[s.model][s.state]:{}}function h(){return u.component="",i.get("/nav/route-points/"+s.route+"/"+s.model).then((e=>{var t;u.route.children=e.children,u.route.perms=e.perms,u.route.parent=e.parent,u.title=e.title,u.name=e.name,t=e.dictionary,c=t,"get"==s.state||"parent"==s.state?u.component="ptj-repo":"primary"==s.state?u.component="ptj-primary":"login"==s.state&&(u.component="ptj-account-handler")})).then((e=>{})).catch((e=>console.log(e)))}function f(){u.slug=[];let e={};if(s.key)return"parent"==s.state?e["--parentid"]=s.key:"primary"==s.state&&(e["--id"]=s.key),i.get("/slug/"+s.route+"/"+s.model,e).then((e=>{u.slug=e;for(let e in u.slug)e=parseInt(e),u.slug[e].route=e>0?{model:u.slug[e].model,state:"parent",key:u.slug[e].id}:{model:u.slug[e].model,state:"get",key:0}}))}function g(){location.href=s.base}function _(){k(),y()}function k(){const e=window.location.protocol+"//"+window.location.host+s.convertToURL(),t=new URL(e);window.history.pushState({name:t.pathname},document.title,t)}function y(){h(),f()}var v={props:{route:Object},setup(e){const l=e;function n(){for(let e in l.route)s[e]=l.route[e];_()}return(l,r)=>(t.openBlock(),t.createElementBlock("a",{class:"ptj-button",key:e.route,onClick:n},[t.renderSlot(l.$slots,"default")]))},__file:"presstojam/src/components/ptj-button.vue"};const B={class:"ptj-multiple-select"},b={class:"ptj-multiple-select-display"},w={class:"ptj-multiple-select-values"},E=["onClick"],j=[(e=>(t.pushScopeId("data-v-51b18f4e"),e=e(),t.popScopeId(),e))((()=>t.createElementVNode("span",{class:"material-icons"},"close",-1)))];var V={props:{field:Object},setup(e){const l=e,n=t.ref("");function r(){l.field.change1=n.value,n.value=""}return(o,a)=>(t.openBlock(),t.createElementBlock("div",B,[t.createElementVNode("div",b,[t.createElementVNode("div",w,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.field.change1,(e=>(t.openBlock(),t.createElementBlock("div",{class:"ptj-multiple-select-val",key:e},[t.createTextVNode(t.toDisplayString(e)+" ",1),t.createElementVNode("a",{class:"ptj-multiple-select-val-remove",onClick:t=>{return n=e,void(l.field.change=l.field.change.filter((function(e){return e!==n})));var n}},j,8,E)])))),128))]),t.withDirectives(t.createElementVNode("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e)},null,512),[[t.vModelText,n.value]]),t.createElementVNode("a",{onClick:r},"add")])]))}};function x(e,t){void 0===t&&(t={});var l=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===l&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}x("\n.ptj-multiple-select-val[data-v-51b18f4e] {\r\n    display : inline-block;\r\n    border : 1px solid green;\r\n    margin-left : 2px;\r\n    margin-right : 2px;\r\n    padding : 2px;\r\n    background-color : green;\n}\n.ptj-multiple-select-val-remove[data-v-51b18f4e] {\r\n    color : red;\n}\n.ptj-multiple-select-display[data-v-51b18f4e] {\r\n    position :relative;\r\n    background-color : #fff;\r\n    border : 1px solid #cdcdcd;\r\n    min-height : 35px;\n}\r\n\r\n"),V.__scopeId="data-v-51b18f4e",V.__file="presstojam/src/components/ptj-multiple-input.vue";const N={class:"ptj-multiple-select"},S={class:"ptj-multiple-select-display"},C={class:"ptj-multiple-select-values"},D=["onClick"],O=[(e=>(t.pushScopeId("data-v-5b05457d"),e=e(),t.popScopeId(),e))((()=>t.createElementVNode("span",{class:"material-icons"},"close",-1)))],M={class:"material-icons"},L=["data-key"];var T={props:{field:Object},setup(e){const l=e;t.onMounted((()=>{if(l.field.reference){let e="/reference/"+s.model+"/"+l.field.name;l.field.setReferenceOptions(e,{"--parentid":s.key})}}));const n=t.reactive({display:!1,symbol:"keyboard_arrow_down"});function r(){n.display?(n.display=!1,n.symbol="keyboard_arrow_down"):(n.display=!0,n.symbol="keyboard_arrow_up")}function o(e){l.field.change1=e.target.getAttribute("data-key"),r()}return(a,i)=>(t.openBlock(),t.createElementBlock("div",N,[t.createElementVNode("div",S,[t.createElementVNode("div",C,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.field.change,(n=>(t.openBlock(),t.createElementBlock("div",{class:"ptj-multiple-select-val",key:n},[t.createTextVNode(t.toDisplayString(e.field.getOption(n))+" ",1),t.createElementVNode("a",{class:"ptj-multiple-select-val-remove",onClick:e=>{return t=n,void(l.field.change=l.field.change.filter((function(e){return e!==t})));var t}},O,8,D)])))),128))]),t.createElementVNode("a",{class:"ptj-multiple-select-arrow",onClick:r},[t.createElementVNode("span",M,t.toDisplayString(t.unref(n).symbol),1)])]),t.withDirectives(t.createElementVNode("ul",{class:"ptj-multiple-select-options",onClick:o},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.field.options,(e=>(t.openBlock(),t.createElementBlock("li",{key:e.key,"data-key":e.key},t.toDisplayString(e.value),9,L)))),128))],512),[[t.vShow,t.unref(n).display]])]))}};x("\n.ptj-multiple-select-val[data-v-5b05457d] {\r\n    display : inline-block;\r\n    border : 1px solid green;\r\n    margin-left : 2px;\r\n    margin-right : 2px;\r\n    padding : 2px;\r\n    background-color : green;\n}\n.ptj-multiple-select-val-remove[data-v-5b05457d] {\r\n    color : red;\n}\n.ptj-multiple-select-arrow[data-v-5b05457d] {\r\n    position :absolute;\r\n    right : 2px;\r\n    top : 3px;\n}\n.ptj-multiple-select-display[data-v-5b05457d] {\r\n    position :relative;\r\n    background-color : #fff;\r\n    border : 1px solid #cdcdcd;\r\n    min-height : 35px;\n}\n.ptj-multiple-select-options li[data-v-5b05457d] {\r\n    list-style: none;\r\n    cursor: pointer;\r\n    margin-top : 2px;\r\n    border : 1px solid #cdcdcd;\r\n    background-color : #fff;\n}\n.ptj-multiple-select-options li[data-v-5b05457d]:hover {\r\n    background-color : #f9f9fb;\r\n    transition : background-color .2s ease-out,border .2s ease-out;\n}\r\n"),T.__scopeId="data-v-5b05457d",T.__file="presstojam/src/components/ptj-multiple-select.vue";const P=["name"],A={key:1},F=["name"],U=t.createElementVNode("option",{value:"",selected:"",disabled:""},"Select Option",-1),R=["value"],I=["name"],z={key:6},J={key:7};var $={props:{field:{type:Object,required:!0},type:{type:String,default:"view"}},setup(e){const l=e;let n=t.computed((()=>"edit"==l.type&&l.field.immutable?"view":l.type));const r=t.computed((()=>function(e){if(0==e.length)return null;let t=[];const l=new RegExp(/^[a-zA-Z]+[a-zA-Z0-9._]+$/);for(let n of e)if(n){if(!l.test(n))return null;t.push(n)}return t}(l.field.contains)?"select":l.field.encrypted?"input":l.field.html||l.field.max>300?"textarea":"input")),o=t.computed((()=>{let e=[];for(let t of l.field.contains)e.push({key:t,value:t});return e})),a=t.computed((()=>{let e={};return l.field.encrypted&&(e.type="password"),l.field.atts.readonly&&(e.readonly=!0),l.field.atts.placeholder&&(e.placeholder=field.meta.placeholder),l.field.atts.html&&(e["data-html"]=1),e}));return(l,i)=>"textarea"==t.unref(r)&&"edit"==t.unref(n)?t.withDirectives((t.openBlock(),t.createElementBlock("textarea",t.mergeProps({key:0},t.unref(a),{name:e.field.name,"onUpdate:modelValue":i[0]||(i[0]=t=>e.field.change=t)}),null,16,P)),[[t.vModelText,e.field.change]]):"textarea"==t.unref(r)&&"view"==t.unref(n)?(t.openBlock(),t.createElementBlock("div",A,t.toDisplayString(e.field.val),1)):"select"==t.unref(r)&&"filter"==t.unref(n)?(t.openBlock(),t.createBlock(T,{key:2,field:e.field},null,8,["field"])):"select"==t.unref(r)&&"edit"==t.unref(n)?t.withDirectives((t.openBlock(),t.createElementBlock("select",t.mergeProps({key:3,"onUpdate:modelValue":i[1]||(i[1]=t=>e.field.change=t),name:e.field.name},t.unref(a),{onBlur:i[2]||(i[2]=t=>e.field.validateon=!0)}),[U,(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(o),(e=>(t.openBlock(),t.createElementBlock("option",{key:e.key,value:e.key},t.toDisplayString(e.value),9,R)))),128))],16,F)),[[t.vModelSelect,e.field.change]]):"edit"==t.unref(n)?t.withDirectives((t.openBlock(),t.createElementBlock("input",t.mergeProps({key:4},t.unref(a),{name:e.field.name,"onUpdate:modelValue":i[3]||(i[3]=t=>e.field.change=t),onBlur:i[4]||(i[4]=t=>e.field.validateon=!0)}),null,16,I)),[[t.vModelDynamic,e.field.change]]):"filter"==t.unref(n)?(t.openBlock(),t.createBlock(V,{key:5,field:e.field},null,8,["field"])):"view"==t.unref(n)&&e.field.reference?(t.openBlock(),t.createElementBlock("span",z,[t.createVNode(v,{route:{model:e.field.reference,key:e.field.val,state:"primary"}},{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(e.field.val),1)])),_:1},8,["route"])])):(t.openBlock(),t.createElementBlock("span",J,t.toDisplayString(e.field.val),1))},__file:"presstojam/src/components/ptj-string.vue"};const q=t.reactive({init:!1,login:!1,user:"public"}),X=t.reactive({cats:{},routes:[]});function Y(){i.post("/core/logout").then((()=>{g()}))}function H(){i.get("/core/check-user").then((e=>{if(e.is_expired)return i.put("/core/switch-tokens").then((()=>{H()}))})).then((e=>{"public"!=q.user&&setTimeout(H,6e5)})).catch((e=>{q.login=!0}))}function K(){return X.cats={},X.routes=[],i.get("/nav/site-map").then((e=>{for(let t in e)for(let l in e[t]){const n={model:l,state:e[t][l].state};e[t][l].default&&(n.default=!0),n.route=l,X.routes.push(n),X.cats[t]||(X.cats[t]=[]),X.cats[t].push(n)}})).then((()=>(s.model||s.apply(function(){for(let e in X.cats)for(let t of X.cats[e])if(t.default)return t}()),!0))).catch((e=>{console.log(e)}))}const W={class:"ptj-slug-trail"};var Z={setup:e=>(e,l)=>(t.openBlock(),t.createElementBlock("div",W,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(u).slug,(e=>(t.openBlock(),t.createBlock(v,{key:e.id,route:e.route},{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(e.model),1)])),_:2},1032,["route"])))),128))])),__file:"presstojam/src/components/ptj-slug-trail.vue"};class G{constructor(e={}){this._handle=e.handle,this._drop_target=e.drop_target,this._drag_target=e.drag_target,this._call_back=e.callback,this._x=0,this._y=0,this._offset_x=0,this._offset_y=0,this._judder=e.judder?e.judder:5,this._drag_node,this._drop_node,this._tree=e.tree}isJudder(e,t){const l=e-this._x,n=t-this._y;return!(l<-5||l>5)&&!(n<-5||n>5)}getDirection(e,t){return{x:e==this._x?0:e>this._x?1:-1,y:t==this._y?0:t>this._y?1:-1}}offset(e){var t=e.getBoundingClientRect(),l=e.ownerDocument.defaultView;return{top:t.top+l.pageYOffset,left:t.left+l.pageXOffset}}insertAfter(){let e=this._drag_node.getAttribute("id"),t=this._drop_node.getAttribute("id"),l=0,n=0;if(this._drop_node.nextElementSibling){for(let e in this._tree){let r=this._tree[e];if(r.id==t){l=r.circular,n=r.sort;break}}for(let t in this._tree){let r=this._tree[t];r.id==e?(r.circular=l,r.sort=n+1):r.circular==l&&r.sort>n&&++r.sort}}else for(let t in this._tree){let n=this._tree[t];n.id==e&&(n.circular=l,n.sort=0)}}insertBefore(){let e=this._drag_node.getAttribute("id"),t=this._drop_node.getAttribute("id"),l=0,n=0;for(let e in this._tree){let r=this._tree[e];if(r.id==t){l=r.circular,n=r.sort,++r.sort;break}}for(let t in this._tree){let r=this._tree[t];r.id==e?(r.circular=l,r.sort=n):r.circular==l&&r.sort>n&&++r.sort}}dragStart(e){const t=e.target.closest("[id]");this._drag_node=t;const{top:l,left:n}=this.offset(t);e.dataTransfer.dropEffect="move",this._x=e.clientX,this._y=e.clientY,this._offset_x=e.clientX-n,this._offset_y=e.clientY-l}isDroppable(e){return!!e.target.closest(this._drop_target)}dragEnter(e){if(!this.isDroppable(e))return!0;if(e.preventDefault(),e.dataTransfer.dropEffect="move",this._drop_node=e.target.closest(this._drag_target),!this._drop_node||this._drop_node.getAttribute("id")==this._drag_node.getAttribute("id"))return;const t=this.getDirection(e.clientX,e.clientY);1==t.y?this.insertAfter():-1==t.y&&this.insertBefore(),this._x=e.clientX,this._y=e.clientY}dragOver(e){if(!this.isDroppable(e))return!0;e.preventDefault(),e.dataTransfer.dropEffect="move"}dragEnd(){this._drag_node&&this._drag_node.setAttribute("draggable",!1),this._drag_node=null}drop(e){if(!this._drop_node)return!0;e.preventDefault(),this._call_back&&this._call_back(this._tree)}}var Q={initDD:function(e){let t=new G(e);if(document.querySelectorAll(e.handle).forEach((e=>e.addAttribute("draggable",!0))),e.handle){document.querySelectorAll(e.handle).forEach((t=>{t.addEventListener("mousedown",(t=>{t.target.closest(e.drag_target).addAttribute("draggable",!0)}))}))}e.main.addEventListener("dragstart",(e=>t.dragStart(e))),e.main.addEventListener("dragenter",(e=>t.dragEnter(e))),e.main.addEventListener("dragover",(e=>t.dragOver(e))),e.main.addEventListener("drop",(e=>t.drop(e))),e.main.addEventListener("dragend",(e=>t.dragEnd(e)))}};const ee=0,te=1,le=2,ne=3,re=4;class oe{constructor(e,l=null){this._name=e,this._type="",this._atts={},this._confirm=!1,this._reference="",this._label="",this._store=t.reactive({summary:0,options:[]}),this._default_val=null,this._immutable=!1,this._encrypted=!1,this._min=null,this._max=null,this._contains=[],this._notcontains=[],this._recursive=!1,this._error={OK:0,MIN_VALUE:1,MAX_VALUE:2,HAS:3,HAS_NOT:4};if(Object.keys(this).forEach((e=>{"_store"!=e&&"_"==e[0]&&Object.defineProperty(this,e.substring(1),{get:function(){return this[e]},set:function(t){"_type"==e?this._type=t.toLowerCase():this[e]=t}})})),this.summary=t.computed({get:()=>this._store.summary,set:e=>{this._store.summary=e?1:0}}),this.options=t.computed({get:()=>this._store.options,set:e=>{this._store.options=e}}),l){for(let e in l)if("summary"==e)this.summary=l[e]?1:0;else{if("validation"==e)continue;"type"==e?this.type=l[e].toLowerCase():this["_"+e]=l[e]}this._min=l.validation.min,this._max=l.validation.max,l.validation.contains&&(this._contains=l.validation.contains.split("|")),l.validation.notcontains&&(this._notcontains=l.validation.notcontains.split("|"))}}getOption(e){for(let t of this._store.options)if(t.key==e)return t.value}setReferenceOptions(e,t){return this._store.options=[],i.get(e,t).then((e=>{for(let t in e){let l=e[t]["--id"],n=[];for(let l in e[t])"--id"!=l&&n.push(e[t][l]);this._store.options.push({key:l,value:n.join(" ",n)})}})).catch((e=>{console.log(e)}))}clean(e){return"checkbox"==this._type?e?1:0:e}calcValue(e){return e||""}validateSize(e){return e<this._min?te:e>this._max?le:ee}validate(e){if(null===e)return;let t;if(isNaN(e)){const l=e?e.length:0;t=this.validateSize(l)}else t=this.validateSize(e);if(t!=ee)return t;for(let t of this._notcontains)if(e.match(t))return re;if(0==this._contains.length)return ee;for(let t of this._contains)if(e.match(t))return ee;return ne}}class ae{constructor(){this._cells={},this._children={},this._states={},this._active=0,this._init=!1,this._store=t.reactive({index:null});Object.keys(this).forEach((e=>{"_"==e[0]&&Object.defineProperty(this,e.substring(1),{get:function(){return this[e]},set:function(t){this[e]=t}})}))}addChild(e,t){this._children[e]=t}addState(e,t){this._actions[e]=t}resetSummary(e){for(let e in this._cells)this._cells[e].summary=!1;for(let t in e)this._cells[e[t]]&&(this._cells[e[t]].summary=!0)}mapField(e,t){this._cells[e]=new oe(e,t),this._cells[e].recursive&&(this._store.index=e)}map(e,t=[]){if(t.length>0)for(let l of t)this.mapField(l,e[l]);else for(let t in e)this.mapField(t,e[t])}getCellByType(e){let t={};for(let l in this._cells)this._cells[l].type==e&&(t[l]=this._cells[l]);return t}}class ie{constructor(e){this._meta=e,this._store=t.reactive({value:null,change:null,display:null,error:0,is_validate_on:!1});const l=Object.getOwnPropertyNames(this._meta),n=Object.keys(this);l.forEach((e=>{"_"==e[0]||n.includes(e)||Object.defineProperty(this,e,{get:function(){return this._meta[e]},set:function(t){this._meta[e]=t}})})),this.error=t.computed({get:()=>{this._store.error},set:e=>{this._store.error=e}}),this.showError=t.computed((()=>!(!this._store.is_validate_on||!this._store.error))),this._meta.default_val?this._store.value=this._meta.default_val:"select"==this._meta.type&&(this._store.value=0),this.val=t.computed({get:()=>this._store.value,set:e=>{this._store.value=this._meta.clean(e),this._store.error=this._meta.validate(e)}}),this.change=t.computed({get:()=>null==this._store.change?this._store.value:this._store.change,set:e=>{this._store.change=this._meta.clean(e),this._store.error=this._meta.validate(e)}}),this.addParam=e=>{null!==this._store.value&&(e[this.name]=this._store.value)},"time"==this.type?(this.change1=t.computed({get:()=>(null==this._store.change&&(this._store.change=this._store.value),this._store.change?this._store.change.min:""),set:e=>{this._store.change||(this._store.change={min:null,max:null}),this._store.change.min=this._meta.clean(e),this._store.error=this._meta.validate(e)}}),this.change2=t.computed({get:()=>(null==this._store.change&&(this._store.change=this._store.value),this._store.change?this._store.change.max:""),set:e=>{this._store.change||(this._store.change={min:null,max:null}),this._store.change.max=this._meta.clean(e),this._store.error=this._meta.validate(e)}}),this.addAPIParam=e=>{null!=this._store.value&&(e[this.name]=this._store.value)}):"flag"==this.type?(this.change1=t.computed({get:()=>(null==this._store.change&&(this._store.change=this._store.value),null==this._store.change?0:this._store.change?this._store.change:2),set:e=>{0!=e?(2==e&&(e=0),this._store.change=this._meta.clean(e),this._store.error=this._meta.validate(e)):this._store.change=null}}),this.addAPIParam=e=>{null!=this._store.value&&(e[this.name]=this._store.value)}):"id"==this.type?(this.change1=t.computed({get:()=>(null==this._store.change&&(this._store.change=this._store.value),null==this._store.change?[]:this._store.change),set:e=>{null==this._store.change&&(this._store.change=[]),this._store.change.includes(e)||(this._store.change.push(this._meta.clean(e)),this._store.error=this._meta.validate(e))}}),this.addAPIParam=e=>{null!=this._store.value&&(e[this.name]=this._store.value)}):"number"==this.type?(this.change1=t.computed({get:()=>(null==this._store.change&&(this._store.change=this._store.value),this._store.change?this._store.change.min:""),set:e=>{this._store.change||(this._store.change={min:null,max:null}),this._store.change.min=this._meta.clean(e),this._store.error=this._meta.validate(e)}}),this.change2=t.computed({get:()=>(null==this._store.change&&(this._store.change=this._store.value),this._store.change?this._store.change.max:""),set:e=>{this._store.change||(this._store.change={min:null,max:null}),this._store.change.max=this._meta.clean(e),this._store.error=this._meta.validate(e)}}),this.addAPIParam=e=>{null!=this._store.value&&(e[this.name]=this._store.value)}):"string"==this.type&&(this.change=t.computed({get:()=>null==this._store.change?"":this._store.change,set:e=>{this._store.change=this._meta.clean(e),this._store.error=this._meta.validate(e)}}),this.change1=t.computed({get:()=>(null==this._store.change&&(this._store.change=this._store.value),null==this._store.change?[]:this._store.change),set:e=>{null==this._store.change&&(this._store.change=[]),this._store.change.push(this._meta.clean(e)),this._store.error=this._meta.validate(e)}}),this.addAPIParam=e=>{if(null!=this._store.value){e[this.name]=[];for(let t in this._store.value)e[this.name].push("%"+this._store.value[t]+"%")}})}get meta(){return this._meta}set validateon(e){this._store.is_validate_on=e}set display(e){this._store.display=e}get display(){return this._store.display?this._store.display:this._store.value}get store(){return this._store}toString(){return this._store.display}isSummary(){return this._meta.summary}setReferenceOptions(e,t){this._meta.setReferenceOptions(e,t)}reset(){this._store.change=null}getOption(e){return"string"==this._meta.type?e:this._meta.getOption(e)}}class se{constructor(e){this._metarow=e,this._cells=t.reactive({}),this._children={},this._ids=t.reactive({}),e&&this.applyMetaRow(e),this.cells=t.computed((()=>this._cells))}set children(e){this._children=e}get children(){return this._children}get primary(){return this._ids["--id"]}get parent(){return this._ids["--parentid"]}clone(){const e=new se(this._metarow);let t={};for(let e in this._cells)t[e].val=this._cells[e].val;let l={};for(let t in e.children)l[t]=e.children[t].clone();return e.children=l,e}applyMetaRow(e){for(const t in e.cells){const l=e.cells[t];this._cells[l.name]=new ie(l)}for(const t in e.children)this._children[t]=e.children[t]}addChild(e,t){this._children[e]||(this._children[e]=[]),this._children[e].push(t)}set row(e){if(e){e["--id"]&&(this._ids["--id"]=e["--id"]),e["--parentid"]&&(this._ids["--parentid"]=e["--parentid"]);for(let t in this._cells)e.hasOwnProperty(t)&&(this._cells[t].val=e[t]);for(let t in this._children)this._children[t].row=e[t]}}getSummary(){let e=[];for(let t in this._cells){const l=this._cells[t];if(l.isSummary()){const t=l.display;e.push(t)}}return e.join(" ")}toString(){let e=[];for(let t in this._cells)e.push(this._cells[t].display);return e.join(" ")}serialize(e=!1){let t={};for(let l in this._cells)e?this._cells[l].change!=this._cells[l].val&&(t[l]=this._cells[l].change):null!=this._cells[l].change&&(t[l]=this._cells[l].change);return t}getCellByType(e){let t={};for(let l in this._cells)this._cells[l].type==e&&(t[l]=this._cells[l]);return t}clearErrors(){for(let e in this._cells)this._cells[e].error=0}reset(){for(let e in this._cells)this._cells[e].error=0,this._cells[e].change=null}setErrors(e){for(let t in e)0!==t.indexOf("__")&&this._cells[t]&&(this._cells[t].error=e[t])}convertToParams(){let e={};for(let t in this._cells)this._cells[t].addParam(e);return e}convertToParams(){let e={};for(let t in this._cells)"asset"!=this._cells[t].type&&this._cells[t].addAPIParam(e);return e}applyChangeData(){for(let e in this._cells)this._cells[e].val=this._cells[e].change}}const ce=t.reactive({meta:new ae,data:[],indexes:{},search:new se});function de(){ce.indexes={};for(const e in ce.data){let t=ce.data[e].cells[ce.meta.store.index].val;ce.indexes[t]||(ce.indexes[t]=[]),ce.indexes[t].push(e)}}function pe(e){ce.data=[];for(const t in e){let l=new se(ce.meta);l.row=e[t],ce.data.push(l)}}const ue=async()=>{let e=m();ce.meta=new ae,ce.data=[],ce.indexes={},ce.search=new se,ce.component="",ce.max_pages=0;let t=function(e){let t={};return t||(t={}),s.to&&(t.__to=s.to),e.to&&(t.__to=e.to),s.key&&(t["--parentid"]=s.key),e.limit&&(t.__limit=e.limit),e.fields&&(t.__fields=e.fields),e.group&&(t.group=e.group),s.params._page&&(t.__limit=s.params._page*t.__limit+","+t.__limit),t}(e),l="/"+s.route+"/"+s.model;return"parent"==s.state&&(l+="/parent"),i.get("/route"+l,t).then((t=>{ce.meta.map(t.fields,e.fields),ce.search.applyMetaRow(ce.meta),ce.search.row=s.params,ce.meta.init=!0,e.component?ce.component=e.component:ce.meta.cells?ce.component=ce.meta.store.index||ce.meta.children.length>0?"tree":"table":ce.component=""})).then((()=>(t={...t,...ce.search.convertToParams()},e.limit>0?i.get("/count/"+s.route+"/"+s.model,t).then((t=>{ce.max_pages=Math.ceil(t.count/e.limit),console.log("Max pages is",ce.max_pages)})).then((()=>i.get("/data"+l,t))).then((e=>(pe(e),ce.meta.store.index&&de(),e))):i.get("/data"+l,t).then((e=>(pe(e),ce.meta.store.index&&de(),e)))))).catch((e=>console.log(e)))},me=e=>(t.pushScopeId("data-v-1dcaa9f5"),e=e(),t.popScopeId(),e),he=["id"],fe={class:"ptj-tree-node-row"},ge=[me((()=>t.createElementVNode("span",{class:"material-icons"},"subdirectory_arrow_right",-1)))],_e=[me((()=>t.createElementVNode("span",{class:"material-icons"},"keyboard_arrow_right",-1)))],ke={key:0},ye=[me((()=>t.createElementVNode("span",{class:"material-icons"},"drag_handle",-1)))],ve=me((()=>t.createElementVNode("span",{class:"material-icons"},"arrow_forward_ios",-1)));var Be={props:{row:{type:[String,Number],required:!0},draggable:Boolean,ischild:{type:Boolean,default:!1}},setup(e){const l=e,n=t.reactive({toggle_state:{},branch:null});function r(){const e=n.branch.primary;n.toggle_state[e]=!n.toggle_state[e]}const o=t.computed((()=>{if(!n.branch)return[];const e=n.branch.primary;return ce.indexes[e]?ce.indexes[e]:[]})),a=t.computed((()=>n.branch?n.branch.primary:0)),i=t.computed((()=>n.branch?n.branch.getSummary():""));return t.onMounted((()=>{n.branch=ce.data[l.row]})),(l,s)=>{const c=t.resolveComponent("ptj-tree-node",!0);return t.openBlock(),t.createElementBlock("div",{class:"ptj-tree-node ptj-draggable",id:t.unref(a),draggable:"false"},[t.createElementVNode("div",fe,[t.createElementVNode("div",null,[e.ischild?(t.openBlock(),t.createElementBlock("a",{key:0,"data-action":"more",class:"button",onClick:s[0]||(s[0]=t.withModifiers((e=>r()),["prevent","stop"]))},ge)):(t.openBlock(),t.createElementBlock("a",{key:1,"data-action":"more",class:"button",onClick:s[1]||(s[1]=t.withModifiers((e=>r()),["prevent","stop"]))},_e))]),t.unref(ce).meta.sortable?(t.openBlock(),t.createElementBlock("div",ke,[t.createElementVNode("a",{"data-action":"more",class:"button",onClick:s[2]||(s[2]=(...e)=>l.prevent.stop&&l.prevent.stop(...e)),onMousedown:s[3]||(s[3]=(...e)=>l.setDraggable&&l.setDraggable(...e)),onMouseup:s[4]||(s[4]=(...e)=>l.endDraggable&&l.endDraggable(...e))},ye,32)])):t.createCommentVNode("v-if",!0),t.createElementVNode("div",null,t.toDisplayString(t.unref(i)),1),t.createVNode(v,{route:{state:"primary",key:t.unref(a)}},{default:t.withCtx((()=>[ve])),_:1},8,["route"])]),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(o),((e,l)=>t.withDirectives((t.openBlock(),t.createBlock(c,{row:e,ischild:!0,key:l},null,8,["row"])),[[t.vShow,t.unref(n).toggle_state[t.unref(a)]]]))),128))],8,he)}}};x("\n.model-tree.branch[data-v-1dcaa9f5] {\r\n  padding-left: 8px;\r\n  padding-right: 8px;\r\n  margin: 6px 0;\r\n  background-color:#111111;\n}\n.tree .ide-block[data-v-1dcaa9f5] {\r\n\tdisplay : none;\n}\n.dragArea[data-v-1dcaa9f5] {\r\n  min-height: 50px;\r\n  outline: 1px solid #777777;\n}\r\n\r\n\r\n"),Be.__scopeId="data-v-1dcaa9f5",Be.__file="presstojam/src/components/ptj-tree-node.vue";const be={class:"ptj-tree ptj-drop-target'",ref:"treeroot"};var we={setup(e){function l(){}return t.onMounted((()=>{ce.meta.sortable&&Q.initDD({handle:".ptj-drag-handle",drag_target:".ptj-draggable",drop_target:".ptj-drop-target",callback:l})})),(e,l)=>(t.openBlock(),t.createElementBlock("div",be,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(ce).indexes[0],((e,l)=>(t.openBlock(),t.createBlock(Be,{key:l,row:e},null,8,["row"])))),128))],512))},__file:"presstojam/src/components/ptj-tree.vue"};const Ee=["name"],je={key:1},Ve=["name"],xe=t.createTextVNode(" - "),Ne=["name"],Se={key:2};var Ce={props:{field:Object,type:{type:String,default:"view"}},setup:e=>(l,n)=>"edit"==e.type?t.withDirectives((t.openBlock(),t.createElementBlock("input",t.mergeProps({key:0,class:"ptj-form-number",name:e.field.name,type:"number","onUpdate:modelValue":n[0]||(n[0]=t=>e.field.change=t)},e.field.atts,{onBlur:n[1]||(n[1]=t=>e.field.validateon=!0)}),null,16,Ee)),[[t.vModelText,e.field.change]]):"filter"==e.type?(t.openBlock(),t.createElementBlock("div",je,[t.withDirectives(t.createElementVNode("input",t.mergeProps({class:"ptj-form-filter-number ptj-min",name:e.field.name,type:"number","onUpdate:modelValue":n[2]||(n[2]=t=>e.field.change1=t)},e.field.atts,{onBlur:n[3]||(n[3]=t=>e.field.validateon=!0)}),null,16,Ve),[[t.vModelText,e.field.change1]]),xe,t.withDirectives(t.createElementVNode("input",t.mergeProps({class:"ptj-form-filter-number ptj-max",name:e.field.name,type:"number","onUpdate:modelValue":n[4]||(n[4]=t=>e.field.change2=t)},e.field.atts,{onBlur:n[5]||(n[5]=t=>e.field.validateon=!0)}),null,16,Ne),[[t.vModelText,e.field.change2]])])):(t.openBlock(),t.createElementBlock("span",Se,t.toDisplayString(e.field.val),1)),__file:"presstojam/src/components/ptj-number.vue"};const De=["name"],Oe=["name"],Me=[t.createElementVNode("option",{value:0},t.toDisplayString("All"),-1),t.createElementVNode("option",{value:1},t.toDisplayString("Checked"),-1),t.createElementVNode("option",{value:2},t.toDisplayString("Unchecked"),-1)],Le={class:"material-icons"};var Te={props:{field:Object,type:{type:String,default:"view"}},setup(e){const l=e;let n=t.computed((()=>"edit"==l.type&&l.field.immutable?"view":l.type));let r=t.computed((()=>1==l.field.val?"check_circle_outline":"highlight_off"));return(o,a)=>"edit"==t.unref(n)?t.withDirectives((t.openBlock(),t.createElementBlock("input",{key:0,class:"ptj-checkbox",type:"checkbox","true-value":1,"false-value":0,name:e.field.name,"onUpdate:modelValue":a[0]||(a[0]=t=>e.field.change=t)},null,8,De)),[[t.vModelCheckbox,e.field.change]]):"filter"==t.unref(n)?t.withDirectives((t.openBlock(),t.createElementBlock("select",{key:1,name:e.field.name,"onUpdate:modelValue":a[1]||(a[1]=t=>e.field.change1=t),class:"ptj-filter-form-checkbox"},Me,8,Oe)),[[t.vModelSelect,e.field.change1]]):(t.openBlock(),t.createElementBlock("a",{key:2,onClick:a[2]||(a[2]=e=>function(){let e={};return e["--id"]=s.key,e[l.field.name]=1==l.field.val?0:1,s.key&&(e["--id"]=s.key),i.put("/data/"+s.route+"/"+s.model,e).then((()=>{l.field.val=1==l.field.val?0:1})).catch((e=>{console.log(e)}))}())},[t.createElementVNode("span",Le,t.toDisplayString(t.unref(r)),1)]))},__file:"presstojam/src/components/ptj-flag.vue"};const Pe=["name"],Ae=t.createElementVNode("option",{value:"0",selected:""},"Select Option",-1),Fe=["value"],Ue={key:2};var Re={props:{field:Object,type:{default:"view",type:String}},setup(e){const l=e;let n=t.computed((()=>"edit"==l.type&&l.field.immutable?"view":l.type));return t.computed((()=>l.field.options)),(l,r)=>"edit"==t.unref(n)?t.withDirectives((t.openBlock(),t.createElementBlock("select",t.mergeProps({key:0,"onUpdate:modelValue":r[0]||(r[0]=t=>e.field.change=t)},e.field.atts,{name:e.field.name,onBlur:r[1]||(r[1]=t=>e.field.validateon=!0)}),[Ae,(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.field.options,(e=>(t.openBlock(),t.createElementBlock("option",{key:e.key,value:e.key},t.toDisplayString(e.value),9,Fe)))),128))],16,Pe)),[[t.vModelSelect,e.field.change]]):"filter"==t.unref(n)?(t.openBlock(),t.createBlock(T,{key:1,field:e.field},null,8,["field"])):(t.openBlock(),t.createElementBlock("span",Ue,t.toDisplayString(e.field.getOption(e.field.val)),1))},__file:"presstojam/src/components/ptj-id.vue"};const Ie=["name"],ze={key:1},Je=["name"],$e=t.createTextVNode(" - "),qe=["name"],Xe={key:2};var Ye={props:{field:Object,type:{default:"view",type:String}},setup(e){const l=e;let n=t.computed((()=>"edit"==l.type&&l.field.immutable?"view":l.type));return(l,r)=>"edit"==t.unref(n)?t.withDirectives((t.openBlock(),t.createElementBlock("input",t.mergeProps({key:0,name:e.field.name,type:"datetime-local","onUpdate:modelValue":r[0]||(r[0]=t=>e.field.change=t)},e.field.atts,{onBlur:r[1]||(r[1]=t=>e.field.validateon=!0)}),null,16,Ie)),[[t.vModelText,e.field.change]]):"filter"==t.unref(n)?(t.openBlock(),t.createElementBlock("div",ze,[t.withDirectives(t.createElementVNode("input",t.mergeProps({type:"datetime-local",name:e.field.name+"min"},e.field.atts,{"onUpdate:modelValue":r[2]||(r[2]=t=>e.field.change1=t)}),null,16,Je),[[t.vModelText,e.field.change1]]),$e,t.withDirectives(t.createElementVNode("input",t.mergeProps({type:"datetime-local",name:e.field.name+"max"},e.field.atts,{"onUpdate:modelValue":r[3]||(r[3]=t=>e.field.change2=t)}),null,16,qe),[[t.vModelText,e.field.change2]])])):(t.openBlock(),t.createElementBlock("span",Xe,t.toDisplayString(e.field.val),1))},__file:"presstojam/src/components/ptj-time.vue"};const He=["name"],Ke={key:1};var We={props:{field:Object,type:{type:String,default:"view"}},setup:e=>(l,n)=>"edit"==e.type?(t.openBlock(),t.createElementBlock("input",{key:0,class:"ptj-form-asset",ref:"input",onChange:n[0]||(n[0]=(...e)=>l.setFile&&l.setFile(...e)),name:e.field.meta.name,type:"file"},null,40,He)):(t.openBlock(),t.createElementBlock("span",Ke,t.toDisplayString(e.field.val),1)),__file:"presstojam/src/components/ptj-asset.vue"};const Ze=e=>(t.pushScopeId("data-v-15ab9672"),e=e(),t.popScopeId(),e),Ge={class:"ptj-table-header"},Qe=["onClick"],et={key:0,class:"material-icons"},tt={key:1,class:"material-icons"},lt=Ze((()=>t.createElementVNode("th",{class:"ptj-actions"}," ",-1))),nt={class:"ptj-actions"},rt=Ze((()=>t.createElementVNode("span",{class:"material-icons"},"arrow_forward_ios",-1)));var ot={setup(e){let l=t.reactive({name:"",dir:""});return(e,n)=>(t.openBlock(),t.createElementBlock("table",{class:t.normalizeClass(["ptj-table",Map.model])},[t.createElementVNode("thead",null,[t.createElementVNode("tr",Ge,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(ce).meta.cells,(e=>t.withDirectives((t.openBlock(),t.createElementBlock("th",{key:e.name,class:t.normalizeClass(["ptj-table-header-cell",e.name]),onClick:t=>{!function(e){if(ce.meta.pages>0){l.dir=!l.name!=e||"desc"==l.dir?"asc":"desc",l.name=e;let t=[];t[l.name]=l.dir,ce.meta.sort=t,load()}else l.name!=e||"desc"==l.dir?(ce.data.sort((function(t,l){let n=t.getCell(e).toVal(),r=l.getCell(e).toVal();return n<r?-1:n>r?1:0})),l.name=e,l.dir="asc"):(ce.data.sort((function(t,l){let n=t.getCell(e).toVal(),r=l.getCell(e).toVal();return n<r?1:n>r?-1:0})),l.name=e,l.dir="desc")}(e.name)}},[t.createTextVNode(t.toDisplayString(e.label)+" ",1),t.unref(l).name==e.name&&"asc"==t.unref(l).dir?(t.openBlock(),t.createElementBlock("span",et,"keyboard_arrow_up")):t.createCommentVNode("v-if",!0),t.unref(l).name==e.name&&"desc"==t.unref(l).dir?(t.openBlock(),t.createElementBlock("span",tt,"keyboard_arrow_down")):t.createCommentVNode("v-if",!0)],10,Qe)),[[t.vShow,e.summary]]))),128)),lt])]),t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(ce).data,((e,l)=>(t.openBlock(),t.createElementBlock("tr",{key:l,class:"ptj-table-row"},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.cells,((e,l)=>t.withDirectives((t.openBlock(),t.createElementBlock("td",{key:l,class:t.normalizeClass(["ptj-table-cell",e.meta.name])},["asset"==e.type?(t.openBlock(),t.createBlock(We,{key:0,field:e},null,8,["field"])):"number"==e.type?(t.openBlock(),t.createBlock(Ce,{key:1,field:e},null,8,["field"])):"flag"==e.type?(t.openBlock(),t.createBlock(Te,{key:2,field:e},null,8,["field"])):"id"==e.type?(t.openBlock(),t.createBlock(Re,{key:3,field:e},null,8,["field"])):"time"==e.type?(t.openBlock(),t.createBlock(Ye,{key:4,field:e},null,8,["field"])):"string"==e.type?(t.openBlock(),t.createBlock($,{key:5,field:e},null,8,["field"])):t.createCommentVNode("v-if",!0)],2)),[[t.vShow,e.summary]]))),128)),t.createElementVNode("td",nt,[t.createVNode(v,{route:{state:"primary",key:e.primary}},{default:t.withCtx((()=>[rt])),_:2},1032,["route"])])])))),128))])],2))}};x("\n.table[data-v-15ab9672], .thead[data-v-15ab9672], .tbody[data-v-15ab9672], .tr[data-v-15ab9672] {\r\n    width : 100%;\n}\r\n\r\n\r\n"),ot.__scopeId="data-v-15ab9672",ot.__file="presstojam/src/components/ptj-table.vue";var at={setup(e){t.inject("data"),t.inject("indexes");const l=t.computed((()=>{let e=[];for(let t in indexes)e=this.getCombinations(t,indexes[t],e);return e}));return(e,n)=>(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(l),((l,n)=>(t.openBlock(),t.createElementBlock("div",{key:n},[t.createElementVNode("h3",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(l.tags,((e,l)=>(t.openBlock(),t.createElementBlock("span",{key:l},t.toDisplayString(e)+" ",1)))),128))]),t.createElementVNode("ul",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(l.data,(l=>(t.openBlock(),t.createElementBlock("li",{key:l},[t.createVNode(v,{route:e.route},{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(e.data[l].getSummary()),1)])),_:2},1032,["route"])])))),128))])])))),128))},__file:"presstojam/src/components/ptj-list.vue"};const it={class:"ptj-error"};var st={props:{error:[Number,String,Object]},setup:e=>(l,n)=>(t.openBlock(),t.createElementBlock("p",it,t.toDisplayString(e.error),1))};x("\n.ptj-error {\r\n  color : red;\n}\r\n"),st.__file="presstojam/src/components/ptj-error.vue";const ct={class:"ptj-form-label"};var dt={props:{field:[Object,Function]},setup:e=>(l,n)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["ptj-form-row",e.field.name])},[t.createElementVNode("label",ct,t.toDisplayString(t.unref(d)(e.field.name,"label",e.field.label)),1),t.renderSlot(l.$slots,"default"),t.withDirectives(t.createVNode(st,{error:e.field.error},null,8,["error"]),[[t.vShow,e.field.showError]])],2)),__file:"presstojam/src/components/ptj-form-row.vue"};const pt={class:"ptj-widget-window"},ut={class:"ptj-widget-window-header"},mt={class:"ptj-widget-window-title"},ht=[t.createElementVNode("span",{class:"material-icons"},"more_horiz",-1)],ft={class:"ptj-widget-window-body"};var gt={props:{title:String,active:{type:Boolean,default:!1}},setup(e){let l=t.ref(!1);function n(){l.value=!l.value}return(r,o)=>(t.openBlock(),t.createElementBlock("div",pt,[t.createElementVNode("div",ut,[t.createElementVNode("h1",mt,[t.createTextVNode(t.toDisplayString(e.title)+" ",1),t.createElementVNode("a",{class:"ptj-widget-window-toggle",onClick:n},ht)])]),t.withDirectives(t.createElementVNode("div",ft,[t.renderSlot(r.$slots,"default",{toggleWidget:n})],512),[[t.vShow,t.unref(l)]])]))},__file:"presstojam/src/components/ptj-widget.vue"};const _t=["onSubmit"],kt=["onClick"],yt=["onClick"];var vt={setup(e){function l(){ce.search.applyChangeData(),s.params=ce.search.convertToParams(),k(),ue()}return(e,n)=>(t.openBlock(),t.createBlock(gt,{title:"search"},{default:t.withCtx((e=>[t.createElementVNode("form",{onSubmit:t.withModifiers(l,["prevent"]),class:"ptj-filter-form"},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(ce).search.cells,(e=>t.withDirectives((t.openBlock(),t.createBlock(dt,{key:e.name,field:e},{default:t.withCtx((()=>["id"==e.type?(t.openBlock(),t.createBlock(Re,{key:0,type:"filter",field:e},null,8,["field"])):"flag"==e.type?(t.openBlock(),t.createBlock(Te,{key:1,type:"filter",field:e},null,8,["field"])):"number"==e.type?(t.openBlock(),t.createBlock(Ce,{key:2,type:"filter",field:e},null,8,["field"])):"time"==e.type?(t.openBlock(),t.createBlock(Ye,{key:3,type:"filter",field:e},null,8,["field"])):"string"==e.type?(t.openBlock(),t.createBlock($,{key:4,type:"filter",field:e},null,8,["field"])):t.createCommentVNode("v-if",!0),t.createElementVNode("a",{onClick:t=>e.reset()},"x",8,kt)])),_:2},1032,["field"])),[[t.vShow,"id"!=e.type||Object.keys(e.options).length>0]]))),128)),t.createElementVNode("input",{type:"submit",value:"Submit",class:"ptj-filter-form-submit",onClick:e.toggleWidget},null,8,yt)],40,_t)])),_:1}))}};x("\n.error[data-v-71ada21d] {\r\n  color : red;\n}\r\n\r\n"),vt.__scopeId="data-v-71ada21d",vt.__file="presstojam/src/components/ptj-filter-form.vue";const Bt=["onUpdate:modelValue"],bt={class:"ptj-selectfields-label"};var wt={setup:e=>(e,l)=>(t.openBlock(),t.createBlock(gt,{title:"select fields",class:"ptj-selectfields"},{default:t.withCtx((()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(ce).meta.cells,((e,l)=>(t.openBlock(),t.createElementBlock("div",{key:l},[t.withDirectives(t.createElementVNode("input",{type:"checkbox","onUpdate:modelValue":t=>e.summary=t,"true-value":1,"false-value":0,class:"ptj-selectfields-checkbox"},null,8,Bt),[[t.vModelCheckbox,e.summary]]),t.createElementVNode("label",bt,t.toDisplayString(t.unref(d)(e.name,"label",e.name)),1)])))),128))])),_:1})),__file:"presstojam/src/components/ptj-selectfields.vue"};const Et={class:"ptj-pagination"},jt=["onClick"];var Vt={setup(e){function l(e){return e-1==s.params._page?"ptj-pagination-active":""}return(e,n)=>(t.openBlock(),t.createElementBlock("div",Et,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(ce).max_pages,(e=>(t.openBlock(),t.createElementBlock("a",{key:e,onClick:t=>{return l=e-1,s.params_page=l,k(),void ue();var l},class:t.normalizeClass(l(e))},t.toDisplayString(e),11,jt)))),128))]))},__file:"presstojam/src/components/ptj-pagination.vue"};const xt={class:"ptj-progress-bar-wrapper"},Nt={class:"ptj-progress-holder"};var St={props:{total:Number,progress:Number},setup(e){const l=e,n=t.computed((()=>{let e=Math.floor(l.progress/l.total*100);return isNaN(e)?0:e}));return(e,l)=>(t.openBlock(),t.createElementBlock("div",xt,[t.createElementVNode("div",Nt,[t.createElementVNode("div",{class:"ptj-progress-bar",style:t.normalizeStyle("width:"+t.unref(n)+"px")}," ",4)]),t.createElementVNode("span",null,t.toDisplayString(t.unref(n))+"%",1)]))}};x("\n.ptj-progress-holder[data-v-460b10ff] {\r\n     width : 100%;\r\n     min-height : 10px;\r\n     position : relative;\r\n     display : flex;\r\n     align-items: stretch;\r\n     padding : 2px;\n}\n.ptj-progress-bar[data-v-460b10ff] {\r\n     width : 0;\r\n     height : 100%;\r\n     position : relative;\r\n     line-height : 100%;\n}\r\n\r\n\r\n"),St.__scopeId="data-v-460b10ff",St.__file="presstojam/src/components/ptj-progress-bar.vue";const Ct=["onSubmit"],Dt=t.createElementVNode("input",{type:"submit",value:"Submit",class:"ptj-form-submit"},null,-1);var Ot={emits:["close"],setup(e,{emit:l}){let n=t.ref("");const r=t.reactive(new se),o=t.reactive({total:0,progress:0});let a=0;function c(){a=o.total>0?1:2,r.clearErrors();let e=r.serialize();return s.key&&(e["--parentid"]=s.key),i.post("/data/"+s.route+"/"+s.model,e).then((e=>{let t=[],l=r.getCellByType("asset");o.total=0;for(let n in l){if(!l[n].val)continue;++o.total;const r=new Asset;r.url="/asset/"+s.model+"/"+n+"/"+e["--id"];let a=r.saveFile(l[n].val).then((()=>{++o.progress}));t.push(a)}return Promise.all(t)})).then((()=>{r.reset(),ue(),l("close")})).catch((e=>{console.log(e),a=0,"string"==typeof e?n=e:r.setErrors(e)}))}return t.onMounted((async()=>{await(async()=>i.post("/route/"+s.route+"/"+s.model).then((e=>{const t=new ae;t.map(e.fields),r.applyMetaRow(t);let l=[];for(let e in t.cells)if("id"==t.cells[e].type&&t.cells[e].reference){let n="/reference/"+s.model+"/"+e;l.push(t.cells[e].setReferenceOptions(n,{"--parentid":s.key}))}return Promise.all(l)})).catch((e=>console.log(e))))()})),(e,l)=>t.withDirectives((t.openBlock(),t.createElementBlock("form",{onSubmit:t.withModifiers(c,["prevent"]),class:t.normalizeClass(["ptj-form",s.model+" "+s.state])},[t.withDirectives(t.createElementVNode("div",{class:"ptj-form-error"},t.toDisplayString(t.unref(n)),513),[[t.vShow,t.unref(n)]]),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(r).cells,(e=>(t.openBlock(),t.createBlock(dt,{key:e.name,field:e},{default:t.withCtx((()=>["asset"==e.type?(t.openBlock(),t.createBlock(We,{key:0,type:"edit",field:e},null,8,["field"])):"number"==e.type?(t.openBlock(),t.createBlock(Ce,{key:1,type:"edit",field:e},null,8,["field"])):"flag"==e.type?(t.openBlock(),t.createBlock(Te,{key:2,type:"edit",field:e},null,8,["field"])):"id"==e.type?(t.openBlock(),t.createBlock(Re,{key:3,type:"edit",field:e},null,8,["field"])):"time"==e.type?(t.openBlock(),t.createBlock(Ye,{key:4,type:"edit",field:e},null,8,["field"])):"string"==e.type?(t.openBlock(),t.createBlock($,{key:5,type:"edit",field:e},null,8,["field"])):t.createCommentVNode("v-if",!0)])),_:2},1032,["field"])))),128)),Dt,t.withDirectives(t.createVNode(St,{total:t.unref(o).total,progress:t.unref(o).progress},null,8,["total","progress"]),[[t.vShow,1==t.unref(a)]])],42,Ct)),[[t.vShow,0==t.unref(a)]])},__file:"presstojam/src/components/ptj-create-form.vue"},Mt={setup(e){const l=t.ref(!1);let n=m();function o(){l.value=!l.value}return t.onMounted((async()=>{await ue()})),(e,a)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass([Map.model,Map.state])},[t.createElementVNode("button",{onClick:a[0]||(a[0]=e=>o())},"Create"),t.createVNode(r,{active:l.value,onClose:a[2]||(a[2]=e=>o())},{default:t.withCtx((()=>[t.createVNode(Ot,{onClose:a[1]||(a[1]=e=>o())})])),_:1},8,["active"]),1!=t.unref(n).disable_filter?(t.openBlock(),t.createBlock(vt,{key:0})):t.createCommentVNode("v-if",!0),1!=t.unref(n).disable_selectfields?(t.openBlock(),t.createBlock(wt,{key:1})):t.createCommentVNode("v-if",!0),"tree"==t.unref(ce).component?(t.openBlock(),t.createBlock(we,{key:2})):"list"==t.unref(ce).component?(t.openBlock(),t.createBlock(at,{key:3})):"table"==t.unref(ce).component?(t.openBlock(),t.createBlock(ot,{key:4})):t.createCommentVNode("v-if",!0),t.unref(ce).max_pages>0?(t.openBlock(),t.createBlock(Vt,{key:5})):t.createCommentVNode("v-if",!0)],2))}};x("\n.table[data-v-1c7fb47e], .thead[data-v-1c7fb47e], .tbody[data-v-1c7fb47e], .tr[data-v-1c7fb47e] {\r\n    width : 100%;\n}\r\n\r\n"),Mt.__scopeId="data-v-1c7fb47e",Mt.__file="presstojam/src/components/ptj-repo.vue";const Lt=["placeholder"],Tt=["disabled"];var Pt={props:{check_str:{type:String,default:"delete"},parentid:{default:0}},emits:["close"],setup(e,{emit:l}){const n=e;let r=t.ref(""),o=t.ref(!0);function a(){o.value=r.value!=n.check_str}function c(){i.delete("/data/"+s.route+"/"+s.model,{"--id":s.key}).then((e=>{s.state="parent",s.key=n.parentid.val,_()})).catch((e=>console.log(e)))}return(l,n)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.createElementVNode("p",null,"Are you sure you want to permanently delete this record? Type "+t.toDisplayString(e.check_str)+" in the box below to continue.",1),t.withDirectives(t.createElementVNode("input",{type:"text",placeholder:e.check_str,onKeyup:a,"onUpdate:modelValue":n[0]||(n[0]=e=>t.isRef(r)?r.value=e:r=e)},null,40,Lt),[[t.vModelText,t.unref(r)]]),t.createElementVNode("button",{disabled:t.unref(o),onClick:c},"Delete",8,Tt)],64))},__file:"presstojam/src/components/ptj-delete.vue"};const At={class:"ptj-children"};var Ft={setup(e){const l=t.reactive({data:new se,fstate:0,type:"view",show_def:!1,progress:{total:0,progress:0}});let n=t.ref(!1);function o(){l.type="view"==l.type?"edit":"view"}let a=t.computed((()=>"edit"==l.type?"view":"edit"));function c(){n.value=!n.value}const d=async()=>{let e=m(),t=function(e){let t={};return s.to&&(t.__to=s.to),s.key&&("first"==s.key?t.__limit=1:t["--id"]=s.key),e.fields&&(t.__fields=e.fields),console.log("Params is ",t),t}(e);return i.get("/route/"+s.route+"/"+s.model+"/primary",t).then((t=>{const n=new ae;n.map(t.fields,e.fields??[]),l.data.applyMetaRow(n)})).then((()=>i.get("/data/"+s.route+"/"+s.model+"/primary",t))).then((e=>{l.data.row=e;for(let e in l.data.cells)l.data.cells[e].change=l.data.cells[e].val})).then((e=>{for(let e in l.data.cells)if("id"==l.data.cells[e].type&&l.data.cells[e].reference){let t="/reference/"+s.model+"/"+e;l.data.cells[e].setReferenceOptions(t,{"--id":s.key})}})).catch((e=>console.log(e)))};function p(){l.fstate=l.progress.total>0?1:2,l.data.clearErrors();let e=l.data.serialize(!0);if(0!=Object.keys(e).length)return e["--id"]=s.key,i.put("/data/"+s.route+"/"+s.model,e).then((e=>{let t=[],n=l.data.getCellByType("asset");l.progress.total=0;for(let r in n){if(!n[r].val)continue;++l.progress.total;const o=new Asset;o.url="/asset/"+s.model+"/"+r+"/"+e["--id"];let a=o.saveFile(n[r].val).then((()=>{++l.progress.progress}));t.push(a)}return Promise.all(t)})).then((()=>{for(let e in l.data.cells)l.data.cells[e].val=l.data.cells[e].change})).then((()=>{o()})).catch((e=>{l.fstate=0,"string"==typeof e?globalerror=e:l.data.setErrors(e)}));o()}return t.onMounted((async()=>{await d()})),(e,i)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.unref(u).route.perms.includes("put")?(t.openBlock(),t.createElementBlock("button",{key:0,onClick:o},t.toDisplayString(t.unref(a)),1)):t.createCommentVNode("v-if",!0),t.unref(u).route.perms.includes("delete")?(t.openBlock(),t.createElementBlock("button",{key:1,onClick:c},"Delete")):t.createCommentVNode("v-if",!0),t.createVNode(r,{active:t.unref(n),onClose:i[1]||(i[1]=e=>c())},{default:t.withCtx((()=>[t.createVNode(Pt,{parentid:t.unref(l).data.parent,onClose:i[0]||(i[0]=e=>c())},null,8,["parentid"])])),_:1},8,["active"]),t.createElementVNode("div",{class:t.normalizeClass(["ptj-primary",s.model])},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(l).data.cells,(e=>(t.openBlock(),t.createBlock(dt,{key:e.name,field:e},{default:t.withCtx((()=>["asset"==e.meta.type?(t.openBlock(),t.createBlock(We,{key:0,type:t.unref(l).type,field:e},null,8,["type","field"])):"number"==e.meta.type?(t.openBlock(),t.createBlock(Ce,{key:1,type:t.unref(l).type,field:e},null,8,["type","field"])):"flag"==e.meta.type?(t.openBlock(),t.createBlock(Te,{key:2,type:t.unref(l).type,field:e},null,8,["type","field"])):"id"==e.meta.type?(t.openBlock(),t.createBlock(Re,{key:3,type:t.unref(l).type,field:e},null,8,["type","field"])):"time"==e.meta.type?(t.openBlock(),t.createBlock(Ye,{key:4,type:t.unref(l).type,field:e},null,8,["type","field"])):"string"==e.meta.type?(t.openBlock(),t.createBlock($,{key:5,type:t.unref(l).type,field:e},null,8,["type","field"])):t.createCommentVNode("v-if",!0)])),_:2},1032,["field"])))),128)),"edit"==t.unref(l).type?(t.openBlock(),t.createElementBlock("input",{key:0,type:"submit",value:"Submit",class:"ptj-form-submit",onClick:p})):t.createCommentVNode("v-if",!0)],2),t.createElementVNode("div",At,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(u).route.children,(e=>(t.openBlock(),t.createBlock(v,{key:e,route:{model:e,state:"parent"}},{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(e),1)])),_:2},1032,["route"])))),128))])],64))},__file:"presstojam/src/components/ptj-primary.vue"};const Ut={class:"ptj-account-handler"},Rt=["onSubmit"],It=t.createElementVNode("input",{type:"submit",value:"Submit",class:"ptj-form-submit"},null,-1),zt=["onSubmit"],Jt=t.createElementVNode("input",{type:"submit",value:"Submit",class:"ptj-form-submit"},null,-1);var $t={props:{actions:[]},setup(e){const l=t.reactive({state:"login",active:!0,login_data:new se,register_data:new se,globalerror:""});function n(){return l.active=!1,l.globalerror="","login"==l.state?i.post("/data/"+s.route+"/"+s.model+"/login",l.login_data.serialize("login")).then((e=>{g()})).catch((e=>{l.globalerror="Incorrect username / password"})):i.post("/data/"+s.route+"/"+s.model,l.register_data.serialize("post")).then((e=>{g()})).catch((e=>{l.register_data.applyErrors(e)}))}return i.post("/route/"+s.route+"/"+s.model).then((e=>{let t=new ae;t.map(e.fields),l.register_data.applyMetaRow(t)})),i.post("/route/"+s.route+"/"+s.model+"/login").then((e=>{let t=new ae;t.map(e.fields),l.login_data.applyMetaRow(t)})),(e,r)=>(t.openBlock(),t.createElementBlock("div",Ut,[t.withDirectives(t.createElementVNode("form",{onSubmit:t.withModifiers(n,["prevent"]),class:"ptj-login"},[t.withDirectives(t.createElementVNode("div",{class:"ptj-form-error"},t.toDisplayString(t.unref(l).globalerror),513),[[t.vShow,t.unref(l).globalerror]]),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(l).login_data.cells,(e=>(t.openBlock(),t.createBlock(dt,{key:e.meta.name,field:e},{default:t.withCtx((()=>[t.createVNode($,{type:"edit",field:e},null,8,["field"])])),_:2},1032,["field"])))),128)),It],40,Rt),[[t.vShow,"login"==t.unref(l).state]]),t.withDirectives(t.createElementVNode("form",{onSubmit:t.withModifiers(n,["prevent"]),class:"ptj-register"},[t.withDirectives(t.createElementVNode("div",{class:"ptj-form-error"},t.toDisplayString(t.unref(l).globalerror),513),[[t.vShow,t.unref(l).globalerror]]),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(l).register_data.cells,(e=>(t.openBlock(),t.createBlock(dt,{key:e.meta.name,field:e},{default:t.withCtx((()=>["number"==e.meta.type?(t.openBlock(),t.createBlock(Ce,{key:0,type:"edit",field:e},null,8,["field"])):"flag"==e.meta.type?(t.openBlock(),t.createBlock(Te,{key:1,type:"edit",field:e},null,8,["field"])):"time"==e.meta.type?(t.openBlock(),t.createBlock(Ye,{key:2,type:"edit",field:e},null,8,["field"])):"string"==e.meta.type?(t.openBlock(),t.createBlock($,{key:3,type:"edit",field:e},null,8,["field"])):t.createCommentVNode("v-if",!0)])),_:2},1032,["field"])))),128)),Jt],40,zt),[[t.vShow,"create"==t.unref(l).state]])]))},__file:"presstojam/src/components/ptj-account-handler.vue"};const qt=t.createElementVNode("div",null,"Loading ...",-1);var Xt={setup(e){const l=t.computed((()=>u.component?"ptj-primary"==u.component?Ft:"ptj-repo"==u.component?Mt:"ptj-account-handler"==u.component?$t:void 0:null));return t.onMounted((()=>(f(),h()))),(e,n)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.createVNode(Z),(t.openBlock(),t.createBlock(t.Suspense,null,{default:t.withCtx((()=>[t.createElementVNode("div",{class:t.normalizeClass([Map.model,Map.state])},[t.createElementVNode("h1",null,t.toDisplayString(t.unref(u).title),1),t.unref(l)?(t.openBlock(),t.createBlock(t.resolveDynamicComponent(t.unref(l)),{key:0})):t.createCommentVNode("v-if",!0)],2)])),fallback:t.withCtx((()=>[qt])),_:1}))],64))},__file:"presstojam/src/components/ptj-router.vue"};const Yt={class:"ptj-account-details"},Ht={class:"ptj-nav"},Kt={key:0};var Wt={setup:e=>(e,l)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.createElementVNode("div",Yt,["public"!=t.unref(q).user?(t.openBlock(),t.createElementBlock("a",{key:0,class:"ptj-account-details-logout",onClick:l[0]||(l[0]=(...e)=>t.unref(Y)&&t.unref(Y)(...e))},"Logout")):t.createCommentVNode("v-if",!0)]),t.createElementVNode("div",Ht,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(X).cats,((e,l)=>(t.openBlock(),t.createElementBlock("div",{key:l},[e.length>1?(t.openBlock(),t.createElementBlock("span",Kt,t.toDisplayString(l),1)):t.createCommentVNode("v-if",!0),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e,(e=>(t.openBlock(),t.createBlock(v,{route:{route:e.route,model:e.model,state:e.state,key:0},key:e.route},{default:t.withCtx((()=>[t.createTextVNode(t.toDisplayString(e.route),1)])),_:2},1032,["route"])))),128))])))),128))]),t.createVNode(Xt),t.createVNode(r,{active:t.unref(q).login},null,8,["active"])],64))};function Zt(e={}){if(e||(e={}),!e.client)throw"Must set client settings";if(!e.client.url)throw"No URL defined for client";return i.initSettings(e.client),e.map&&s.initSettings(e.map),function(e){e&&(p=e)}(e.models),function(e=""){return i.get("/core/check-user").then((e=>e.is_expired?i.put("/core/switch-tokens").then((()=>i.get("/core/check-user"))):e)).then((t=>{if(q.user=t.user,q.role=t.role,q.init=!0,q.role!=e){let t="/core/change-role";return e&&(t+="/"+e),i.post(t).then((t=>{q.role=e}))}})).then((()=>{H()})).catch((e=>console.log(e)))}(e.user&&e.user.role?e.user.role:"")}Wt.__file="presstojam/src/components/ptj-user.vue",e.getClient=function(e){if(!e.client)throw"Must set client settings";if(!e.client.url)throw"No URL defined for client";return i.initSettings(e.client),i},e.runApp=function(e,l){Zt(l).then((()=>K())).then((()=>{const l=t.createApp(Wt);return l.mount(e),l})).catch((e=>{console.log(e)}))},e.runRoute=function(e,l){Zt(l).then((()=>{const l=t.createApp(Xt);return l.mount(e),l})).catch((e=>{console.log(e)}))}}));
//# sourceMappingURL=ptj.min.js.map
