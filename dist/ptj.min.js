!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).ptj=t(e.Vue)}(this,(function(e){"use strict";const t={class:"ptj-modal-backdrop"},n={class:"ptj-modal"};var o={props:{active:{required:!0}},setup:o=>(r,s)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",t,[e.createElementVNode("div",n,[e.createElementVNode("header",null,[e.createElementVNode("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=e=>{r.$emit("close")})}," x ")]),e.renderSlot(r.$slots,"default")])],512)),[[e.vShow,o.active]]),__file:"presstojam/src/components/ptj-modal.vue"};let r={};var s={regSettings:function(e,t=null){t?r[t]=e:r=e},getSettings:function(e){return r[e]},getModelSettings:function(e,t){return r.models&&r.models[e]&&r.models[e][t]?r.models[e][t]:{}}};let i,l={};var a={initSettings(){const e=s.getSettings("client");if(!e.url)throw"No URL defined for client";if(i=e.url,e.custom_headers)for(let t in e.custom_headers)l[t]=e.custom_headers[t]},run(e,t){return i||this.initSettings(),t.mode="cors",t.cache="no-cache",t.credentials="include",t["Content-Type"]="application/json",t.headers=l,fetch(i+e,t).then((e=>{if(e.ok)return e.json();throw e}))},get(e,t){if(t){const n=new URLSearchParams;for(let e in t)Array.isArray(t[e])||"object"==typeof t[e]&&null!==t[e]?n.append(e,JSON.stringify(t[e])):n.append(e,t[e]);-1==e.indexOf("?")?e+="?":e+="&",e+=n.toString()}let n={method:"GET"};return this.run(e,n)},getprimary(e,t){return this.get(e,t)},post(e,t){let n={method:"POST"};return n.body=JSON.stringify(t),this.run(e,n)},put(e,t){let n={method:"PUT"};return n.body=JSON.stringify(t),this.run(e,n)},patch(e,t){let n={method:"PATCH"};return n.body=JSON.stringify(t),this.run(e,n)},delete(e,t){let n={method:"DELETE"};return n.body=JSON.stringify(t),this.run(e,n)}};window.onpopstate=function(){u.convertFromURL(),m()};const c=e.reactive({cats:{},routes:[],component:"",title:"",name:"",route:{children:[],parent:null,perms:[]}}),u=new class{constructor(){this._route="",this._model="",this._state="",this._key=0,this._to="",this._params={},this._settings={},this._base="/",this._default=!1,this._changes={};Object.keys(this).forEach((e=>{"_"==e[0]&&Object.defineProperty(this,e.substring(1),{get:function(){return this[e]},set:function(t){this._changes[e.substring(1)]=this[e],this[e]=t}})})),this.action_map={post:"-create",put:"-update",delete:"-delete",login:"-login",logout:"-logout",primary:"-primary",parent:"-parent",get:""}}get id(){return this.model+"-"+this.state+"-"+this.to}hasChange(e){return this._changes.hasOwnProperty(e)}reset(){this.route="",this.model="",this.state="",this.key=0,this.to="",this.params={},this.settings={},this._changes={}}resetChanges(){this._changes={}}convertToURL(){let e=this._base+this.route+"/"+this.model+this.action_map[this.state];this.key&&(e+="-"+this.key),this.to&&(e+="-to-"+this.to);let t=[];for(const e in this.params)"Array"==typeof this.params[e]||"Object"==typeof this.params[e]?t.push(e+"="+JSON.stringify(this.params[e])):t.push(e+"="+this.params[e]);return t.length>0&&(e+="?"+t.join("&")),e}convertFromURL(e){e||(e=new URL(window.location.href));let t=e.pathname.replace(this.base,"");if(t=t.replace(/^\/+|\/+$/g,""),!t)return;let n=t.split("/");this.route=n[0],t=n[1];const o=this;e.searchParams.forEach((function(e,t){o.params[t]=e.indexOf(",")>-1?e.split(","):e})),n=t.split("-to-"),n.length>1&&(this.to=n[1],t=n[0]),n=t.split("-");let r=n[n.length-1];if("first"==r?(this.key=r,n.pop()):isNaN(r)||(this.key=r,n.pop()),0==n.length)throw new Error("Can't convert this url string: "+t);this.state="get";for(let e in this.action_map)if(this.action_map[e]=="-"+n[n.length-1]){this.state=e,n.pop();break}this.model=n.join("-")}getAll(){return{route:this.route,model:this.model,state:this.state,key:this.key,to:this.to,params:this.params,base:this.base,default:this.default}}apply(e){for(let t in e)this[t]=e[t]}};function p(e){return c.cats={},c.routes=[],c.route={children:[],parent:null,perms:[]},c.model=null,a.get("/nav/site-map").then((e=>{for(let t in e)for(let n in e[t]){const o={model:n,state:e[t][n].state};e[t][n].default&&(o.default=!0),o.route=n,c.routes.push(o),c.cats[t]||(c.cats[t]=[]),c.cats[t].push(o)}}))}function d(){return a.get("/nav/route-points/"+u.route+"/"+u.model).then((e=>{c.route.children=e.children,c.route.perms=e.perms,c.route.parent=e.parent,c.title=e.title,c.name=e.name,e.dictionary})).catch((e=>console.log(e)))}function h(){!function(){const e=window.location.protocol+"//"+window.location.host+u.convertToURL(),t=new URL(e);window.history.pushState({name:t.pathname},document.title,t)}(),m()}function m(){let e=[];return u.model?u.hasChange("route")?(e.push(p()),e.push(d())):u.hasChange("model")&&e.push(d()):e.push(p().then((()=>(u.apply(function(){for(let e in c.cats)for(let t of c.cats[e])if(t.default)return t}()),d())))),Promise.all(e).then((()=>{u.model,"get"==u.state||"parent"==u.state?c.component="ptj-repo":"primary"==u.state?c.component="ptj-primary":"login"==u.state&&(c.component="ptj-account-handler")})).catch((e=>console.log(e)))}var f={props:{route:Object},setup(t){const n=t;function o(){for(let e in n.route)u[e]=n.route[e];h()}return(n,r)=>(e.openBlock(),e.createElementBlock("a",{class:"ptj-button",key:t.route,onClick:o},[e.renderSlot(n.$slots,"default")]))}};function g(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}f.__file="presstojam/src/components/ptj-button.vue";g("\n.ptj-multiple-select-val[data-v-51b18f4e] {\r\n    display : inline-block;\r\n    border : 1px solid green;\r\n    margin-left : 2px;\r\n    margin-right : 2px;\r\n    padding : 2px;\r\n    background-color : green;\n}\n.ptj-multiple-select-val-remove[data-v-51b18f4e] {\r\n    color : red;\n}\n.ptj-multiple-select-display[data-v-51b18f4e] {\r\n    position :relative;\r\n    background-color : #fff;\r\n    border : 1px solid #cdcdcd;\r\n    min-height : 35px;\n}\r\n\r\n");g("\n.ptj-multiple-select-val[data-v-5b05457d] {\r\n    display : inline-block;\r\n    border : 1px solid green;\r\n    margin-left : 2px;\r\n    margin-right : 2px;\r\n    padding : 2px;\r\n    background-color : green;\n}\n.ptj-multiple-select-val-remove[data-v-5b05457d] {\r\n    color : red;\n}\n.ptj-multiple-select-arrow[data-v-5b05457d] {\r\n    position :absolute;\r\n    right : 2px;\r\n    top : 3px;\n}\n.ptj-multiple-select-display[data-v-5b05457d] {\r\n    position :relative;\r\n    background-color : #fff;\r\n    border : 1px solid #cdcdcd;\r\n    min-height : 35px;\n}\n.ptj-multiple-select-options li[data-v-5b05457d] {\r\n    list-style: none;\r\n    cursor: pointer;\r\n    margin-top : 2px;\r\n    border : 1px solid #cdcdcd;\r\n    background-color : #fff;\n}\n.ptj-multiple-select-options li[data-v-5b05457d]:hover {\r\n    background-color : #f9f9fb;\r\n    transition : background-color .2s ease-out,border .2s ease-out;\n}\r\n");const k=e.reactive({init:!1,login:!1,user:"public"});function v(){a.post("/core/logout").then((()=>{location.href=u.base}))}function y(){a.get("/core/check-user").then((e=>{if(e.is_expired)return a.put("/core/switch-tokens").then((()=>{y()}));k.init||(k.user=e.user,k.role=e.role,k.init=!0)})).then((e=>{"public"!=k.user&&setTimeout(y,6e5)})).catch((e=>{k.login=!0}))}const b={class:"ptj-slug-trail"};var j={setup(t){const n=e.ref([]);return onMounted((async()=>{})),(t,o)=>(e.openBlock(),e.createElementBlock("div",b,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(t=>(e.openBlock(),e.createBlock(f,{key:t.id,route:t.route},{default:e.withCtx((()=>[e.createTextVNode(e.toDisplayString(t.value),1)])),_:2},1032,["route"])))),128))]))},__file:"presstojam/src/components/ptj-slug-trail.vue"};const _=require("path"),B={};var x={addModule:function(e,t){B[e]=t},loadModule:function(e){return B[e]?import(B[e]):import(_.resolve(__dirname,"/../components/"+e+".vue"))}};const S={class:"ptj-nav"},w={key:0},E=e.createElementVNode("span",{class:"material-icons"},"back",-1),N=e.createElementVNode("div",null,"Loading ...",-1);var C={setup(t){const n=e.computed((()=>c.component?e.defineAsyncComponent((()=>x.loadModule(c.component))):null));return e.onMounted((()=>{(function(){const e=s.getSettings("mapper");return e&&(u.base="/"+e.base.replace(/^\/+|\/+$/g,""),e.role),u.convertFromURL(),Promise.resolve()})().then((()=>m()))})),(t,o)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",S,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c).cats,((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:n},[t.length>1?(e.openBlock(),e.createElementBlock("span",w,e.toDisplayString(n),1)):e.createCommentVNode("v-if",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t,(t=>(e.openBlock(),e.createBlock(f,{route:{route:t.route,model:t.model,state:t.state,key:0},key:t.route},{default:e.withCtx((()=>[e.createTextVNode(e.toDisplayString(t.route),1)])),_:2},1032,["route"])))),128))])))),128))]),e.createVNode(j),(e.openBlock(),e.createBlock(e.Suspense,null,{default:e.withCtx((()=>[e.createElementVNode("div",{class:e.normalizeClass([Map.model,Map.state])},[e.unref(c).back?(e.openBlock(),e.createBlock(f,{key:0,route:e.unref(c).back},{default:e.withCtx((()=>[E])),_:1},8,["route"])):e.createCommentVNode("v-if",!0),e.createElementVNode("h1",null,e.toDisplayString(e.unref(c).title),1),e.unref(n)?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{key:1})):e.createCommentVNode("v-if",!0)],2)])),fallback:e.withCtx((()=>[N])),_:1}))],64))},__file:"presstojam/src/components/ptj-router.vue"},V={setup:t=>(y(),(t,n)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[(e.openBlock(),e.createBlock(e.Teleport,{to:"#ptj-accountdetails"},["public"!=e.unref(k).user?(e.openBlock(),e.createElementBlock("a",{key:0,class:"ptj-account-details-logout",onClick:n[0]||(n[0]=(...t)=>e.unref(v)&&e.unref(v)(...t))},"Logout")):e.createCommentVNode("v-if",!0)])),e.createVNode(C),e.createVNode(o,{active:e.unref(k).login},null,8,["active"])],64)))};return V.__file="presstojam/src/components/ptj-user.vue",{runApp:function(t,n){s.regSettings(n);const o=e.createApp(V);return o.mount(t),o},getClient:function(e){return s.regSettings(e),a}}}));
//# sourceMappingURL=ptj.min.js.map
