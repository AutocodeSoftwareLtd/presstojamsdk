import{withDirectives as t,openBlock as e,createElementBlock as n,createElementVNode as o,renderSlot as r,vShow as s,reactive as i,ref as a,Fragment as l,renderList as u,createBlock as c,withCtx as p,createTextVNode as d,toDisplayString as h,computed as m,defineAsyncComponent as f,onMounted as g,unref as v,createCommentVNode as b,createVNode as y,Suspense as _,normalizeClass as k,resolveDynamicComponent as j,Teleport as x,createApp as w}from"vue";const S={class:"ptj-modal-backdrop"},C={class:"ptj-modal"};var O={props:{active:{required:!0}},setup:i=>(a,l)=>t((e(),n("div",S,[o("div",C,[o("header",null,[o("button",{type:"button",class:"btn-close",onClick:l[0]||(l[0]=t=>{a.$emit("close")})}," x ")]),r(a.$slots,"default")])],512)),[[s,i.active]]),__file:"presstojam/src/components/ptj-modal.vue"};let L={};var T={regSettings:function(t,e=null){e?L[e]=t:L=t},getSettings:function(t){return L[t]},getModelSettings:function(t,e){return L.models&&L.models[t]&&L.models[t][e]?L.models[t][e]:{}}};let N,U={};var E={initSettings(){const t=T.getSettings("client");if(!t.url)throw"No URL defined for client";if(N=t.url,t.custom_headers)for(let e in t.custom_headers)U[e]=t.custom_headers[e]},run(t,e){return N||this.initSettings(),e.mode="cors",e.cache="no-cache",e.credentials="include",e["Content-Type"]="application/json",e.headers=U,fetch(N+t,e).then((t=>{if(t.ok)return t.json();throw t}))},get(t,e){if(e){const n=new URLSearchParams;for(let t in e)Array.isArray(e[t])||"object"==typeof e[t]&&null!==e[t]?n.append(t,JSON.stringify(e[t])):n.append(t,e[t]);-1==t.indexOf("?")?t+="?":t+="&",t+=n.toString()}let n={method:"GET"};return this.run(t,n)},getprimary(t,e){return this.get(t,e)},post(t,e){let n={method:"POST"};return n.body=JSON.stringify(e),this.run(t,n)},put(t,e){let n={method:"PUT"};return n.body=JSON.stringify(e),this.run(t,n)},patch(t,e){let n={method:"PATCH"};return n.body=JSON.stringify(e),this.run(t,n)},delete(t,e){let n={method:"DELETE"};return n.body=JSON.stringify(e),this.run(t,n)}};window.onpopstate=function(){R.convertFromURL(),$()};const P=i({cats:{},routes:[],component:"",title:"",name:"",route:{children:[],parent:null,perms:[]}}),R=new class{constructor(){this._route="",this._model="",this._state="",this._key=0,this._to="",this._params={},this._settings={},this._base="/",this._default=!1,this._changes={};Object.keys(this).forEach((t=>{"_"==t[0]&&Object.defineProperty(this,t.substring(1),{get:function(){return this[t]},set:function(e){this._changes[t.substring(1)]=this[t],this[t]=e}})})),this.action_map={post:"-create",put:"-update",delete:"-delete",login:"-login",logout:"-logout",primary:"-primary",parent:"-parent",get:""}}get id(){return this.model+"-"+this.state+"-"+this.to}hasChange(t){return this._changes.hasOwnProperty(t)}reset(){this.route="",this.model="",this.state="",this.key=0,this.to="",this.params={},this.settings={},this._changes={}}resetChanges(){this._changes={}}convertToURL(){let t=this._base+this.route+"/"+this.model+this.action_map[this.state];this.key&&(t+="-"+this.key),this.to&&(t+="-to-"+this.to);let e=[];for(const t in this.params)"Array"==typeof this.params[t]||"Object"==typeof this.params[t]?e.push(t+"="+JSON.stringify(this.params[t])):e.push(t+"="+this.params[t]);return e.length>0&&(t+="?"+e.join("&")),t}convertFromURL(t){t||(t=new URL(window.location.href));let e=t.pathname.replace(this.base,"");if(e=e.replace(/^\/+|\/+$/g,""),!e)return;let n=e.split("/");this.route=n[0],e=n[1];const o=this;t.searchParams.forEach((function(t,e){o.params[e]=t.indexOf(",")>-1?t.split(","):t})),n=e.split("-to-"),n.length>1&&(this.to=n[1],e=n[0]),n=e.split("-");let r=n[n.length-1];if("first"==r?(this.key=r,n.pop()):isNaN(r)||(this.key=r,n.pop()),0==n.length)throw new Error("Can't convert this url string: "+e);this.state="get";for(let t in this.action_map)if(this.action_map[t]=="-"+n[n.length-1]){this.state=t,n.pop();break}this.model=n.join("-")}getAll(){return{route:this.route,model:this.model,state:this.state,key:this.key,to:this.to,params:this.params,base:this.base,default:this.default}}apply(t){for(let e in t)this[e]=t[e]}};function M(t){return P.cats={},P.routes=[],P.route={children:[],parent:null,perms:[]},P.model=null,E.get("/nav/site-map").then((t=>{for(let e in t)for(let n in t[e]){const o={model:n,state:t[e][n].state};t[e][n].default&&(o.default=!0),o.route=n,P.routes.push(o),P.cats[e]||(P.cats[e]=[]),P.cats[e].push(o)}}))}function A(){return E.get("/nav/route-points/"+R.route+"/"+R.model).then((t=>{P.route.children=t.children,P.route.perms=t.perms,P.route.parent=t.parent,P.title=t.title,P.name=t.name,t.dictionary})).catch((t=>console.log(t)))}function J(){!function(){const t=window.location.protocol+"//"+window.location.host+R.convertToURL(),e=new URL(t);window.history.pushState({name:e.pathname},document.title,e)}(),$()}function $(){let t=[];return R.model?R.hasChange("route")?(t.push(M()),t.push(A())):R.hasChange("model")&&t.push(A()):t.push(M().then((()=>(R.apply(function(){for(let t in P.cats)for(let e of P.cats[t])if(e.default)return e}()),A())))),Promise.all(t).then((()=>{R.model,"get"==R.state||"parent"==R.state?P.component="ptj-repo":"primary"==R.state?P.component="ptj-primary":"login"==R.state&&(P.component="ptj-account-handler")})).catch((t=>console.log(t)))}var F={props:{route:Object},setup(t){const o=t;function s(){for(let t in o.route)R[t]=o.route[t];J()}return(o,i)=>(e(),n("a",{class:"ptj-button",key:t.route,onClick:s},[r(o.$slots,"default")]))}};function q(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}F.__file="presstojam/src/components/ptj-button.vue";q("\n.ptj-multiple-select-val[data-v-51b18f4e] {\r\n    display : inline-block;\r\n    border : 1px solid green;\r\n    margin-left : 2px;\r\n    margin-right : 2px;\r\n    padding : 2px;\r\n    background-color : green;\n}\n.ptj-multiple-select-val-remove[data-v-51b18f4e] {\r\n    color : red;\n}\n.ptj-multiple-select-display[data-v-51b18f4e] {\r\n    position :relative;\r\n    background-color : #fff;\r\n    border : 1px solid #cdcdcd;\r\n    min-height : 35px;\n}\r\n\r\n");q("\n.ptj-multiple-select-val[data-v-5b05457d] {\r\n    display : inline-block;\r\n    border : 1px solid green;\r\n    margin-left : 2px;\r\n    margin-right : 2px;\r\n    padding : 2px;\r\n    background-color : green;\n}\n.ptj-multiple-select-val-remove[data-v-5b05457d] {\r\n    color : red;\n}\n.ptj-multiple-select-arrow[data-v-5b05457d] {\r\n    position :absolute;\r\n    right : 2px;\r\n    top : 3px;\n}\n.ptj-multiple-select-display[data-v-5b05457d] {\r\n    position :relative;\r\n    background-color : #fff;\r\n    border : 1px solid #cdcdcd;\r\n    min-height : 35px;\n}\n.ptj-multiple-select-options li[data-v-5b05457d] {\r\n    list-style: none;\r\n    cursor: pointer;\r\n    margin-top : 2px;\r\n    border : 1px solid #cdcdcd;\r\n    background-color : #fff;\n}\n.ptj-multiple-select-options li[data-v-5b05457d]:hover {\r\n    background-color : #f9f9fb;\r\n    transition : background-color .2s ease-out,border .2s ease-out;\n}\r\n");const B=i({init:!1,login:!1,user:"public"});function D(){E.post("/core/logout").then((()=>{location.href=R.base}))}function G(){E.get("/core/check-user").then((t=>{if(t.is_expired)return E.put("/core/switch-tokens").then((()=>{G()}));B.init||(B.user=t.user,B.role=t.role,B.init=!0)})).then((t=>{"public"!=B.user&&setTimeout(G,6e5)})).catch((t=>{B.login=!0}))}const H={class:"ptj-slug-trail"};var z={setup(t){const o=a([]);return onMounted((async()=>{})),(t,r)=>(e(),n("div",H,[(e(!0),n(l,null,u(o.value,(t=>(e(),c(F,{key:t.id,route:t.route},{default:p((()=>[d(h(t.value),1)])),_:2},1032,["route"])))),128))]))},__file:"presstojam/src/components/ptj-slug-trail.vue"};const I=require("path"),K={};var Q={addModule:function(t,e){K[t]=e},loadModule:function(t){return K[t]?import(K[t]):import(I.resolve(__dirname,"/../components/"+t+".vue"))}};const V={class:"ptj-nav"},W={key:0},X=o("span",{class:"material-icons"},"back",-1),Y=o("div",null,"Loading ...",-1);var Z={setup(t){const r=m((()=>P.component?f((()=>Q.loadModule(P.component))):null));return g((()=>{(function(){const t=T.getSettings("mapper");return t&&(R.base="/"+t.base.replace(/^\/+|\/+$/g,""),t.role),R.convertFromURL(),Promise.resolve()})().then((()=>$()))})),(t,s)=>(e(),n(l,null,[o("div",V,[(e(!0),n(l,null,u(v(P).cats,((t,o)=>(e(),n("div",{key:o},[t.length>1?(e(),n("span",W,h(o),1)):b("v-if",!0),(e(!0),n(l,null,u(t,(t=>(e(),c(F,{route:{route:t.route,model:t.model,state:t.state,key:0},key:t.route},{default:p((()=>[d(h(t.route),1)])),_:2},1032,["route"])))),128))])))),128))]),y(z),(e(),c(_,null,{default:p((()=>[o("div",{class:k([Map.model,Map.state])},[v(P).back?(e(),c(F,{key:0,route:v(P).back},{default:p((()=>[X])),_:1},8,["route"])):b("v-if",!0),o("h1",null,h(v(P).title),1),v(r)?(e(),c(j(v(r)),{key:1})):b("v-if",!0)],2)])),fallback:p((()=>[Y])),_:1}))],64))},__file:"presstojam/src/components/ptj-router.vue"},tt={setup:t=>(G(),(t,o)=>(e(),n(l,null,[(e(),c(x,{to:"#ptj-accountdetails"},["public"!=v(B).user?(e(),n("a",{key:0,class:"ptj-account-details-logout",onClick:o[0]||(o[0]=(...t)=>v(D)&&v(D)(...t))},"Logout")):b("v-if",!0)])),y(Z),y(O,{active:v(B).login},null,8,["active"])],64)))};tt.__file="presstojam/src/components/ptj-user.vue";var et={runApp:function(t,e){T.regSettings(e);const n=w(tt);return n.mount(t),n},getClient:function(t){return T.regSettings(t),E}};export{et as default};
//# sourceMappingURL=ptj.esm.js.map
