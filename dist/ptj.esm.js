import{withDirectives as t,openBlock as e,createElementBlock as n,createElementVNode as o,renderSlot as r,vShow as s,reactive as i,ref as a,Fragment as l,renderList as u,createBlock as c,withCtx as p,createTextVNode as d,toDisplayString as h,computed as m,defineAsyncComponent as f,onMounted as g,unref as v,createCommentVNode as b,createVNode as y,Suspense as k,normalizeClass as j,resolveDynamicComponent as _,Teleport as x,createApp as w}from"vue";const S={class:"ptj-modal-backdrop"},C={class:"ptj-modal"};var O={props:{active:{required:!0}},setup:i=>(a,l)=>t((e(),n("div",S,[o("div",C,[o("header",null,[o("button",{type:"button",class:"btn-close",onClick:l[0]||(l[0]=t=>{a.$emit("close")})}," x ")]),r(a.$slots,"default")])],512)),[[s,i.active]]),__file:"presstojam/src/components/ptj-modal.vue"};let L={};var T={regSettings:function(t,e=null){e?L[e]=t:L=t},getSettings:function(t){return L[t]},getModelSettings:function(t,e){return L.models&&L.models[t]&&L.models[t][e]?L.models[t][e]:{}}};let N,U={};var E={initSettings(){const t=T.getSettings("client");if(!t.url)throw"No URL defined for client";if(N=t.url,t.custom_headers)for(let e in t.custom_headers)U[e]=t.custom_headers[e]},run(t,e){return N||this.initSettings(),e.mode="cors",e.cache="no-cache",e.credentials="include",e["Content-Type"]="application/json",e.headers=U,fetch(N+t,e).then((t=>{if(t.ok)return t.json();throw t}))},get(t,e){if(e){const n=new URLSearchParams;for(let t in e)Array.isArray(e[t])||"object"==typeof e[t]&&null!==e[t]?n.append(t,JSON.stringify(e[t])):n.append(t,e[t]);-1==t.indexOf("?")?t+="?":t+="&",t+=n.toString()}let n={method:"GET"};return this.run(t,n)},getprimary(t,e){return this.get(t,e)},post(t,e){let n={method:"POST"};return n.body=JSON.stringify(e),this.run(t,n)},put(t,e){let n={method:"PUT"};return n.body=JSON.stringify(e),this.run(t,n)},patch(t,e){let n={method:"PATCH"};return n.body=JSON.stringify(e),this.run(t,n)},delete(t,e){let n={method:"DELETE"};return n.body=JSON.stringify(e),this.run(t,n)}};const P={};var R={addModule:function(t,e){P[t]=e},loadModule:function(t){return P[t]?import(P[t]):import("./../components/"+t+".vue")}};window.onpopstate=function(){A.convertFromURL(),B()};const M=i({cats:{},routes:[],component:"",title:"",name:"",route:{children:[],parent:null,perms:[]}}),A=new class{constructor(){this._route="",this._model="",this._state="",this._key=0,this._to="",this._params={},this._settings={},this._base="/",this._default=!1,this._changes={};Object.keys(this).forEach((t=>{"_"==t[0]&&Object.defineProperty(this,t.substring(1),{get:function(){return this[t]},set:function(e){this._changes[t.substring(1)]=this[t],this[t]=e}})})),this.action_map={post:"-create",put:"-update",delete:"-delete",login:"-login",logout:"-logout",primary:"-primary",parent:"-parent",get:""}}get id(){return this.model+"-"+this.state+"-"+this.to}hasChange(t){return this._changes.hasOwnProperty(t)}reset(){this.route="",this.model="",this.state="",this.key=0,this.to="",this.params={},this.settings={},this._changes={}}resetChanges(){this._changes={}}convertToURL(){let t=this._base+this.route+"/"+this.model+this.action_map[this.state];this.key&&(t+="-"+this.key),this.to&&(t+="-to-"+this.to);let e=[];for(const t in this.params)"Array"==typeof this.params[t]||"Object"==typeof this.params[t]?e.push(t+"="+JSON.stringify(this.params[t])):e.push(t+"="+this.params[t]);return e.length>0&&(t+="?"+e.join("&")),t}convertFromURL(t){t||(t=new URL(window.location.href));let e=t.pathname.replace(this.base,"");if(e=e.replace(/^\/+|\/+$/g,""),!e)return;let n=e.split("/");this.route=n[0],e=n[1];const o=this;t.searchParams.forEach((function(t,e){o.params[e]=t.indexOf(",")>-1?t.split(","):t})),n=e.split("-to-"),n.length>1&&(this.to=n[1],e=n[0]),n=e.split("-");let r=n[n.length-1];if("first"==r?(this.key=r,n.pop()):isNaN(r)||(this.key=r,n.pop()),0==n.length)throw new Error("Can't convert this url string: "+e);this.state="get";for(let t in this.action_map)if(this.action_map[t]=="-"+n[n.length-1]){this.state=t,n.pop();break}this.model=n.join("-")}getAll(){return{route:this.route,model:this.model,state:this.state,key:this.key,to:this.to,params:this.params,base:this.base,default:this.default}}apply(t){for(let e in t)this[e]=t[e]}};function J(t){return M.cats={},M.routes=[],M.route={children:[],parent:null,perms:[]},M.model=null,E.get("/nav/site-map").then((t=>{for(let e in t)for(let n in t[e]){const o={model:n,state:t[e][n].state};t[e][n].default&&(o.default=!0),o.route=n,M.routes.push(o),M.cats[e]||(M.cats[e]=[]),M.cats[e].push(o)}}))}function $(){return E.get("/nav/route-points/"+A.route+"/"+A.model).then((t=>{M.route.children=t.children,M.route.perms=t.perms,M.route.parent=t.parent,M.title=t.title,M.name=t.name,t.dictionary})).catch((t=>console.log(t)))}function F(){!function(){const t=window.location.protocol+"//"+window.location.host+A.convertToURL(),e=new URL(t);window.history.pushState({name:e.pathname},document.title,e)}(),B()}function B(){let t=[];return A.model?A.hasChange("route")?(t.push(J()),t.push($())):A.hasChange("model")&&t.push($()):t.push(J().then((()=>(A.apply(function(){for(let t in M.cats)for(let e of M.cats[t])if(e.default)return e}()),$())))),Promise.all(t).then((()=>{A.model,"get"==A.state||"parent"==A.state?M.component="ptj-repo":"primary"==A.state?M.component="ptj-primary":"login"==A.state&&(M.component="ptj-account-handler")})).catch((t=>console.log(t)))}var q={props:{route:Object},setup(t){const o=t;function s(){for(let t in o.route)A[t]=o.route[t];F()}return(o,i)=>(e(),n("a",{class:"ptj-button",key:t.route,onClick:s},[r(o.$slots,"default")]))}};function D(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}q.__file="presstojam/src/components/ptj-button.vue";D("\n.ptj-multiple-select-val[data-v-51b18f4e] {\r\n    display : inline-block;\r\n    border : 1px solid green;\r\n    margin-left : 2px;\r\n    margin-right : 2px;\r\n    padding : 2px;\r\n    background-color : green;\n}\n.ptj-multiple-select-val-remove[data-v-51b18f4e] {\r\n    color : red;\n}\n.ptj-multiple-select-display[data-v-51b18f4e] {\r\n    position :relative;\r\n    background-color : #fff;\r\n    border : 1px solid #cdcdcd;\r\n    min-height : 35px;\n}\r\n\r\n");D("\n.ptj-multiple-select-val[data-v-5b05457d] {\r\n    display : inline-block;\r\n    border : 1px solid green;\r\n    margin-left : 2px;\r\n    margin-right : 2px;\r\n    padding : 2px;\r\n    background-color : green;\n}\n.ptj-multiple-select-val-remove[data-v-5b05457d] {\r\n    color : red;\n}\n.ptj-multiple-select-arrow[data-v-5b05457d] {\r\n    position :absolute;\r\n    right : 2px;\r\n    top : 3px;\n}\n.ptj-multiple-select-display[data-v-5b05457d] {\r\n    position :relative;\r\n    background-color : #fff;\r\n    border : 1px solid #cdcdcd;\r\n    min-height : 35px;\n}\n.ptj-multiple-select-options li[data-v-5b05457d] {\r\n    list-style: none;\r\n    cursor: pointer;\r\n    margin-top : 2px;\r\n    border : 1px solid #cdcdcd;\r\n    background-color : #fff;\n}\n.ptj-multiple-select-options li[data-v-5b05457d]:hover {\r\n    background-color : #f9f9fb;\r\n    transition : background-color .2s ease-out,border .2s ease-out;\n}\r\n");const G=i({init:!1,login:!1,user:"public"});function H(){E.post("/core/logout").then((()=>{location.href=A.base}))}function z(){E.get("/core/check-user").then((t=>{if(t.is_expired)return E.put("/core/switch-tokens").then((()=>{z()}));G.init||(G.user=t.user,G.role=t.role,G.init=!0)})).then((t=>{"public"!=G.user&&setTimeout(z,6e5)})).catch((t=>{G.login=!0}))}const I={class:"ptj-slug-trail"};var K={setup(t){const o=a([]);return onMounted((async()=>{})),(t,r)=>(e(),n("div",I,[(e(!0),n(l,null,u(o.value,(t=>(e(),c(q,{key:t.id,route:t.route},{default:p((()=>[d(h(t.value),1)])),_:2},1032,["route"])))),128))]))},__file:"presstojam/src/components/ptj-slug-trail.vue"};const Q={class:"ptj-nav"},V={key:0},W=o("span",{class:"material-icons"},"back",-1),X=o("div",null,"Loading ...",-1);var Y={setup(t){const r=m((()=>M.component?f((()=>R.loadModule(M.component))):null));return g((()=>{(function(){const t=T.getSettings("mapper");return t&&(A.base="/"+t.base.replace(/^\/+|\/+$/g,""),t.role),A.convertFromURL(),Promise.resolve()})().then((()=>B()))})),(t,s)=>(e(),n(l,null,[o("div",Q,[(e(!0),n(l,null,u(v(M).cats,((t,o)=>(e(),n("div",{key:o},[t.length>1?(e(),n("span",V,h(o),1)):b("v-if",!0),(e(!0),n(l,null,u(t,(t=>(e(),c(q,{route:{route:t.route,model:t.model,state:t.state,key:0},key:t.route},{default:p((()=>[d(h(t.route),1)])),_:2},1032,["route"])))),128))])))),128))]),y(K),(e(),c(k,null,{default:p((()=>[o("div",{class:j([Map.model,Map.state])},[v(M).back?(e(),c(q,{key:0,route:v(M).back},{default:p((()=>[W])),_:1},8,["route"])):b("v-if",!0),o("h1",null,h(v(M).title),1),v(r)?(e(),c(_(v(r)),{key:1})):b("v-if",!0)],2)])),fallback:p((()=>[X])),_:1}))],64))},__file:"presstojam/src/components/ptj-router.vue"},Z={setup:t=>(z(),(t,o)=>(e(),n(l,null,[(e(),c(x,{to:"#ptj-accountdetails"},["public"!=v(G).user?(e(),n("a",{key:0,class:"ptj-account-details-logout",onClick:o[0]||(o[0]=(...t)=>v(H)&&v(H)(...t))},"Logout")):b("v-if",!0)])),y(Y),y(O,{active:v(G).login},null,8,["active"])],64)))};Z.__file="presstojam/src/components/ptj-user.vue";var tt={runApp:function(t,e){T.regSettings(e);const n=w(Z);return n.mount(t),n},getClient:function(t){return T.regSettings(t),E}};export{tt as default};
//# sourceMappingURL=ptj.esm.js.map
