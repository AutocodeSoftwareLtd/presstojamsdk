import{defineComponent as t,openBlock as e,createBlock as s,toDisplayString as r,resolveComponent as i,Fragment as o,createCommentVNode as n,withDirectives as a,createVNode as l,vModelDynamic as c,vShow as h,pushScopeId as d,popScopeId as u,renderList as _,vModelSelect as p,withScopeId as g,vModelRadio as m,vModelCheckbox as f,vModelText as v,withModifiers as y,inject as b,createTextVNode as k,renderSlot as w,withCtx as x,ref as C,onMounted as S,resolveDynamicComponent as T,reactive as O,computed as A}from"vue";var E=t({name:"gc-error",props:{error:String}});const V={class:"error"};function j(t,e){void 0===e&&(e={});var s=e.insertAt;if(t&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===s&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}j("\n.error {\r\n  color : red;\n}\r\n"),E.render=function(t,i,o,n,a,l){return e(),s("p",V,r(t.error),1)},E.__file="vite-sdk/src/components/gc-error.vue";var R=t({name:"gc-input",props:{field:Object,stores:Object},setup:t=>t.stores.exportToViewField(t.field),components:{"gc-error":E}});const D={key:0};R.render=function(t,d,u,_,p,g){const m=i("gc-error");return e(),s(o,null,["hidden"!=t.field.atts.type?(e(),s("label",D,r(t.field.label),1)):n("v-if",!0),a(l("input",{name:t.field.name,type:t.field.atts.type,"onUpdate:modelValue":d[1]||(d[1]=e=>t.val=e),onBlur:d[2]||(d[2]=e=>t.setValidateOn()),readonly:t.field.readonly},null,40,["name","type","readonly"]),[[c,t.val]]),a(l(m,{error:t.field.error},null,8,["error"]),[[h,t.showError]])],64)},R.__file="vite-sdk/src/components/gc-form-input.vue";var L=t({name:"gc-confirm",props:{field:Object,stores:Object},setup:t=>t.stores.exportToViewField(t.field),data:()=>({cval:""}),computed:{name(){return this.field.name+"_confirm"},error(){if(this.isvalidateon)return this.val==this.cval?"":"Doesn't match "+this.field.name}},watch:{cval(t){this.error?this.$emit("confirmerror",1):this.$emit("confirmerror",-1)}},components:{"gc-error":E}});L.render=function(t,n,d,u,_,p){const g=i("gc-error");return e(),s(o,null,[l("label",null,r(t.field.label),1),a(l("input",{name:t.name,type:t.field.atts.type,"onUpdate:modelValue":n[1]||(n[1]=e=>t.cval=e),onBlur:n[2]||(n[2]=e=>t.setValidateOn())},null,40,["name","type"]),[[c,t.cval]]),a(l(g,{error:t.error},null,8,["error"]),[[h,t.error]])],64)},L.__file="vite-sdk/src/components/gc-form-confirm.vue";let F,U={},B={},P=!0;var z={regCustomHeader(t,e){U[t]=e},regStatusHandler(t,e){B[t]=e},setURL(t){F=t},regDebug(t){P=t},run:(t,e)=>(e.mode="cors",e.cache="no-cache",e.credentials="include",e["Content-Type"]="application/json",e.headers=U,fetch(F+t,e).then((t=>{if(!B[t.status]){if(401==t.status)return t.status;if(t.ok)return t.json();throw Error(t.statusText)}B[t.status](t)})).then((s=>{if(401==s){let s=e.method;return e.method="PUT",fetch(F+"/core-switch-tokens",e).then((r=>{if(r.ok)return e.method=s,fetch(F+t,e).then((t=>{if(401==t.status)throw new Error("Issue with refresh token");if(t.ok)return t.json()}))}))}return s})).catch((t=>{throw P&&console.log(t),t}))),setDebug:t=>(t?t.__debug=!0:t={__debug:!0},t),get(t,e){if(P&&(e=this.setDebug(e)),e){const s=new URLSearchParams;let r={};for(let t in e)Array.isArray(e[t])||"object"==typeof e[t]&&null!==e[t]?r[t]=e[t]:s.append(t,e[t]);r&&s.append("graph",JSON.stringify(r)),-1==t.indexOf("?")?t+="?":t+="&",t+=s.toString()}let s={method:"GET"};return this.run(t,s)},getprimary(t,e){return this.get(t,e)},post(t,e){P&&(e=this.setDebug(e));let s={method:"POST"};return s.body=JSON.stringify(e),this.run(t,s)},put(t,e){P&&(e=this.setDebug(e));let s={method:"PUT"};return s.body=JSON.stringify(e),this.run(t,s)},patch(t,e){P&&(e=this.setDebug(e));let s={method:"PATCH"};return s.body=JSON.stringify(e),this.run(t,s)},delete(t,e){P&&(e=this.setDebug(e));let s={method:"DELETE"};return s.body=JSON.stringify(e),this.run(t,s)}},N={props:{field:Object,stores:Object,multiple:Boolean},setup:t=>t.stores.exportToViewField(t.field),components:{"gc-error":E}};const M=g("data-v-2db2f132");d("data-v-2db2f132");const q=l("option",{value:"0"},"Select Option",-1);u();const I=M(((t,n,c,d,u,g)=>{const m=i("gc-error");return e(),s(o,null,[l("label",null,r(c.field.label),1),a(l("select",{"onUpdate:modelValue":n[1]||(n[1]=e=>t.val=e),readonly:c.field.readonly,name:c.field.name,multiple:c.multiple},[q,(e(!0),s(o,null,_(t.options,(t=>(e(),s("option",{key:t.key,value:t.key},r(t.value),9,["value"])))),128))],8,["readonly","name","multiple"]),[[p,t.val]]),a(l(m,{error:c.field.error},null,8,["error"]),[[h,c.field.error]])],64)}));j("\r\n"),N.render=I,N.__scopeId="data-v-2db2f132",N.__file="vite-sdk/src/components/gc-form-select.vue";var G=t({name:"gc-radio",props:{field:Object,stores:Object},data:()=>({isvalidateon:!1}),methods:{setValidateOn(){this.isvalidateon=!0},validate(){let t=this.stores.getData(this.field.name);const e=this.field.validate(t);this.stores.updateField(this.field.name,"error",e)}},computed:{val:{get:function(){return this.stores.getData(this.field.name)},set:function(t){this.stores.setData(this.field.name,t),this.isvalidateon&&this.validate()}}},components:{"gc-error":E}});G.render=function(t,n,c,d,u,p){const g=i("gc-error");return e(),s(o,null,[l("label",null,r(t.field.label),1),(e(!0),s(o,null,_(t.options,(i=>(e(),s("div",{key:i},[l("label",null,r(i.option),1),a(l("input",{name:t.cfield.name,type:"radio",value:i.value,"onUpdate:modelValue":n[1]||(n[1]=e=>t.val=e)},null,8,["name","value"]),[[m,t.val]])])))),128)),a(l(g,{error:t.field.error},null,8,["error"]),[[h,t.field.error]])],64)},G.__file="vite-sdk/src/components/gc-form-radio.vue";var H=t({name:"gc-checkbox",props:{field:Object,stores:Object},setup:t=>t.stores.exportToViewField(t.field),components:{"gc-error":E}});H.render=function(t,n,c,d,u,_){const p=i("gc-error");return e(),s(o,null,[l("label",null,r(t.field.label),1),a(l("input",{type:"checkbox",name:t.field.name,"onUpdate:modelValue":n[1]||(n[1]=e=>t.val=e)},null,8,["name"]),[[f,t.val]]),a(l(p,{error:t.field.error},null,8,["error"]),[[h,t.field.error]])],64)},H.__file="vite-sdk/src/components/gc-form-checkbox.vue";var J=t({name:"gc-textarea",props:{field:Object,stores:{type:Object,required:!0}},setup:()=>props.stores.exportToViewField(props.field),methods:{validate(){let t=this.stores.getData(this.field.name);const e=this.field.validate(t);this.stores.updateField(this.field.name,"error",e)}},components:{"gc-error":E}});J.render=function(t,n,c,d,u,_){const p=i("gc-error");return e(),s(o,null,[l("label",null,r(t.field.label),1),a(l("textarea",{name:t.field.name,"onUpdate:modelValue":n[1]||(n[1]=e=>t.val=e),readonly:t.field.readonly},null,8,["name","readonly"]),[[v,t.val]]),a(l(p,{error:t.field.error},null,8,["error"]),[[h,t.field.error]])],64)},J.__file="vite-sdk/src/components/gc-form-textarea.vue";var X=t({name:"gc-asset-field",props:{field:{type:Object,required:!0},stores:{type:Object,required:!0}},setup:t=>t.stores.exportToViewField(t.field),methods:{validate(){let t=this.stores.data[this.field.name];this.stores.fields[this.field_name].error=this.field.validate(t)},setFile(t){t.target.files.length>0?this.val=t.target.files[0]:this.val=null}},components:{"gc-error":E}});X.render=function(t,n,c,d,u,_){const p=i("gc-error");return e(),s(o,null,[l("label",null,r(t.field.label),1),l("input",{ref:"input",onChange:n[1]||(n[1]=(...e)=>t.setFile&&t.setFile(...e)),name:t.field.name,type:"file"},null,40,["name"]),a(l(p,{error:t.field.error},null,8,["error"]),[[h,t.field.error]])],64)},X.__file="vite-sdk/src/components/gc-form-asset.vue";var Y={name:"gc-progress-bar",props:{total:Number,progress:Number},computed:{num(){let t=Math.floor(this.progress/this.total*100);return isNaN(t)?0:t},style(){return"width:"+this.num+"%;"}}};const $=g("data-v-76910936");d("data-v-76910936");const K={class:"gc-holder"};u();const W=$(((t,i,o,n,a,c)=>(e(),s("div",null,[l("div",K,[l("div",{class:"gc-bar",style:c.style}," ",4)]),l("span",null,r(c.num)+"%",1)]))));j("\n.gc-holder[data-v-76910936] {\r\n     width : 100%;\r\n     min-height : 10px;\r\n     position : relative;\r\n     display : flex;\r\n     align-items: stretch;\r\n     padding : 2px;\n}\n.gc-bar[data-v-76910936] {\r\n     width : 0;\r\n     height : 100%;\r\n     position : relative;\r\n     line-height : 100%;\n}\r\n\r\n\r\n"),Y.render=W,Y.__scopeId="data-v-76910936",Y.__file="vite-sdk/src/components/gc-progress-bar.vue";const Q={1:"too small",2:"too large",3:"contains incorrect characters",4:"doesn't contain required characters",5:"not unique"};var Z={getError:function(t){return Q[t]}};const tt={},et={};function st(t,e={}){let s={label:"",options:{},error:""};for(let e in et)key.regex.test(t)&&(s={...s,...et[e].entry});s={...s,...e},tt[t]=s}function rt(t){return tt[t]}var it={setDictionary:function(t){tt=t},setDictionaryTemplate:function(t,e){et[key]={regex:new RegExp(t),entry:e}},createEntry:st,getEntry:rt,exportToView:function(t){return{dict:function(t,e){return rt(t)},setEntry:function(t,e){let s=st(t);s={...s,...e}}}},get:function(t,e,s){return tt[t]&&tt[t][e]?tt[t][e]:s}},ot=t({name:"gc-form",props:{store:{type:Object,required:!0}},data:()=>({fstate:0,progress:0,globalerror:""}),setup:t=>({...t.store.exportToViewBlock(),...it.exportToView(t.store.model+"-"+t.store.action)}),methods:{clearErrors(){this.globalerror="";for(let t in this.store.fields)this.store.fields[t].error=0},submit(t){this.fstate=this.total>0?1:2,this.clearErrors(),this.store.submit().then((()=>{let t=[];for(let e in this.fields)if("asset"==this.fields[e].type){let s=this.store.saveAsset(this.fields[e]).then((()=>{++this.progress})).catch((t=>{this.fstate=0,this.progress=0,this.store.fields[e].error=t}));t.push(s)}return Promise.all(t)})).then((()=>{this.store.runNext()})).catch((t=>{if(this.fstate=0,t.message)this.globalerror=t.message;else for(let e in t)0!==e.indexOf("__")&&this.store.fields[e]&&(this.store.fields[e].error=Z.getError(t[e]))}))}},computed:{total(){let t=0;for(let e in this.fields)"asset"==this.fields[e].type&&++t;return t}},components:{"gc-input":R,"gc-confirm":L,"gc-select":N,"gc-radio":G,"gc-checkbox":H,"gc-textarea":J,"gc-asset-field":X,"gc-progress-bar":Y}});const nt={key:6};ot.render=function(t,c,d,u,p,g){const m=i("gc-select"),f=i("gc-radio"),v=i("gc-checkbox"),b=i("gc-textarea"),k=i("gc-asset-field"),w=i("gc-input"),x=i("gc-confirm"),C=i("gc-progress-bar");return e(),s("div",null,[a(l("form",{onSubmit:c[1]||(c[1]=y(((...e)=>t.submit&&t.submit(...e)),["prevent"])),class:t.store.classes},[l("h1",null,r(t.dict("title",t.store.title)),1),a(l("div",{class:"error"},r(t.dict("globalerror",t.store.globalerror)),513),[[h,t.globalerror]]),(e(!0),s(o,null,_(t.fields,(r=>(e(),s("div",{key:r.name,class:"gc-form-row"},["select"==r.type?(e(),s(m,{key:0,field:r,stores:t.store},null,8,["field","stores"])):"radio"==r.type?(e(),s(f,{key:1,field:r,stores:t.store},null,8,["field","stores"])):"checkbox"==r.type?(e(),s(v,{key:2,field:r,stores:t.store},null,8,["field","stores"])):"textarea"==r.type?(e(),s(b,{key:3,field:r,stores:t.store},null,8,["field","stores"])):"asset"==r.type?(e(),s(k,{key:4,field:r,stores:t.store},null,8,["field","stores"])):(e(),s(w,{key:5,field:r,stores:t.store},null,8,["field","stores"])),r.confirm?(e(),s("div",nt,[l(x,{field:r,stores:t.store},null,8,["field","stores"])])):n("v-if",!0),n(" REMOVED: ")])))),128)),l("input",{type:"submit",value:t.dict("submit","Submit")},null,8,["value"])],34),[[h,0==t.fstate]]),a(l(C,{total:t.total,progress:t.progress},null,8,["total","progress"]),[[h,1==t.fstate]])])},ot.__file="vite-sdk/src/components/gc-form.vue";var at=t({name:"gc-nav",props:{actions:Array},setup:t=>({ctrl:b("ctrl")}),methods:{setRoute(t){t(),this.ctrl.runLink()}}});const lt=g("data-v-0ddb4230");d("data-v-0ddb4230");const ct={class:"gc-nav"};u();const ht=lt(((t,i,n,a,l,c)=>(e(),s("span",ct,[(e(!0),s(o,null,_(t.actions,(i=>(e(),s("a",{key:i,onClick:e=>{t.setRoute(i.r)}},r(i.n),9,["onClick"])))),128))]))));j("\r\n"),at.render=ht,at.__scopeId="data-v-0ddb4230",at.__file="vite-sdk/src/components/gc-nav.vue";var dt={name:"gc-time-range",props:{field:Object,stores:Object},setup:t=>t.stores.exportToViewField(t.field),components:{"gc-error":E}};const ut=g("data-v-79505a64")(((t,n,c,d,u,_)=>{const p=i("gc-error");return e(),s(o,null,[l("label",null,r(t.dict("label",c.field.label)),1),a(l("input",{type:"date","onUpdate:modelValue":n[1]||(n[1]=e=>t.val1=e)},null,512),[[v,t.val1]]),a(l("input",{type:"date","onUpdate:modelValue":n[2]||(n[2]=e=>t.val2=e)},null,512),[[v,t.val2]]),a(l(p,{error:c.field.error},null,8,["error"]),[[h,c.field.error]])],64)}));j("\r\n"),dt.render=ut,dt.__scopeId="data-v-79505a64",dt.__file="vite-sdk/src/components/gc-filter-form-time.vue";var _t=t({name:"gc-checkbox",props:{field:Object,stores:Object},setup:t=>t.stores.exportToViewField(t.field)});const pt={value:""},gt={value:"1"},mt={value:"0"};_t.render=function(t,i,n,c,h,d){return e(),s(o,null,[l("label",null,r(t.field.label),1),a(l("select",{name:t.field.name,"onUpdate:modelValue":i[1]||(i[1]=e=>t.val=e)},[l("option",pt,r(t.dict("all","All")),1),l("option",gt,r(t.dict("checked","Checked")),1),l("option",mt,r(t.dict("unchecked","Unchecked")),1)],8,["name"]),[[p,t.val]])],64)},_t.__file="vite-sdk/src/components/gc-filter-form-checkbox.vue";var ft=t({props:{title:String,active:{type:Boolean,default:!1}},data(){return{show:this.active}},methods:{toggleWidget(){this.show=!this.show}}});const vt={class:"gc-widget-window-header"},yt=l("span",{class:"material-icons"},"more_horiz",-1),bt={class:"gc-widget-window-body"};ft.render=function(t,i,o,n,c,d){return e(),s("div",null,[l("div",vt,[k(r(t.title)+" ",1),l("a",{class:"gc-widget-window-toggle-view",onClick:i[1]||(i[1]=(...e)=>t.toggleWidget&&t.toggleWidget(...e))},[yt])]),a(l("div",bt,[w(t.$slots,"default")],512),[[h,t.show]])])},ft.__file="vite-sdk/src/components/gc-widget-window.vue";var kt=t({name:"gc-filter-form",props:{store:{type:Object,required:!0}},setup:t=>t.store.exportToViewBlock(),methods:{submit(){this.store.submit()}},components:{"gc-input":R,"gc-select":N,"gc-checkbox":H,"gc-time-range":dt,"gc-filter-checkbox":_t,"gc-widget":ft}});const wt=g("data-v-6afc4706");d("data-v-6afc4706");const xt=l("input",{type:"submit",value:"Submit"},null,-1);u();const Ct=wt(((t,a,c,h,d,u)=>{const p=i("gc-select"),g=i("gc-filter-checkbox"),m=i("gc-time-range"),f=i("gc-input"),v=i("gc-widget");return e(),s(v,{title:"search"},{default:wt((()=>[l("form",{onSubmit:a[1]||(a[1]=y(((...e)=>t.submit&&t.submit(...e)),["prevent"])),class:"gc-filter-form"},[l("h1",null,"Search "+r(t.store.title),1),(e(!0),s(o,null,_(t.store.fields,(r=>(e(),s("div",{key:r.name},["select"==r.type?(e(),s(p,{key:0,field:r,multiple:!0,stores:t.store},null,8,["field","stores"])):"checkbox"==r.type?(e(),s(g,{key:1,field:r,stores:t.store},null,8,["field","stores"])):n("v-if",!0),"time"==r.type?(e(),s(m,{key:2,field:r,stores:t.store},null,8,["field","stores"])):(e(),s(f,{key:3,field:r,stores:t.store},null,8,["field","stores"])),n(" REMOVED: ")])))),128)),xt],32)])),_:1})}));j("\n.error[data-v-6afc4706] {\r\n  color : red;\n}\r\n\r\n"),kt.render=Ct,kt.__scopeId="data-v-6afc4706",kt.__file="vite-sdk/src/components/gc-filter-form.vue";var St=t({props:{max_page_limit:Number},setup:t=>({groups:Math.ceil(t.pages/t.max_page_limit),current_group:0}),computed:{firstindex(){return this.current_group*this.max_options},maxoptions:()=>[]},methods:{showPages(t){let e=Controller.current_route.value,s=e+"#";e.query&&(s+=e.query+"&"),s+="__page="+(this.firstindex+t),Router.setRoute(s)}}});const Tt={class:"gc-pagination"};St.render=function(t,i,n,c,d,u){return e(),s("div",Tt,[a(l("a",{onClick:i[1]||(i[1]=e=>{t.showPages(-1)})},"<<",512),[[h,t.optiongroup>0]]),(e(!0),s(o,null,_(t.maxoptions,(i=>(e(),s("a",{key:i,onClick:e=>t.page(i)},r(t.firstindex+i),9,["onClick"])))),128)),a(l("a",{onClick:i[2]||(i[2]=e=>t.showPages(1))},">>",512),[[h,t.current_group<t.groups-1]])])},St.__file="vite-sdk/src/components/gc-pagination.vue";var Ot=t({props:{store:{type:Object,required:!0}},setup(t){it.createEntry("gc-selectfields",{button:"Select Fields",update:"Update"})},methods:{dict:(t,e)=>it.get("gc-selectfields",t,e),update(){this.store.load()},toggle(t){let e=this.store.selectedfields.indexOf(t);e>-1?this.store.selectedfields.splice(e,1):this.store.selectedfields.push(t)}},components:{"gc-widget":ft}});Ot.render=function(t,n,a,c,h,d){const u=i("gc-widget");return e(),s(u,{title:t.dict("button","select fields")},{default:x((()=>[(e(!0),s(o,null,_(t.store.selectfields,(i=>(e(),s("div",{key:i},[l("input",{type:"checkbox",onClick:e=>t.toggle(i),value:i,checked:t.store.selectedfields.includes(i)},null,8,["onClick","value","checked"]),k(" "+r(i),1)])))),128)),l("button",{onClick:n[1]||(n[1]=y(((...e)=>t.update&&t.update(...e)),["stop"]))},r(t.dict("update","select")),1)])),_:1},8,["title"])},Ot.__file="vite-sdk/src/components/gc-selectfields.vue";var At={name:"gc-header",props:{store:{type:Object,required:!0}},setup:t=>t.store.exportToViewBlock(),methods:{updateFields(t){this.store.load()}},components:{"gc-nav":at,"gc-filter-form":kt,"gc-pagination":St,"gc-selectfields":Ot}};const Et={key:0,class:"gc-nav"};At.render=function(t,a,c,h,d,u){const _=i("gc-filter-form"),p=i("gc-selectfields");return e(),s(o,null,[l("h1",null,r(c.store.title),1),c.store.actions.post?(e(),s("span",Et,[l("a",{onClick:a[1]||(a[1]=e=>{t.setRoute(c.store.actions.post.r)})},r(c.store.actions.post.n),1)])):n("v-if",!0),l(_,{store:c.store},null,8,["store"]),l(p,{store:c.store},null,8,["store"])],64)},At.__file="vite-sdk/src/components/gc-repo-header.vue";var Vt={name:"gc-tree-node",props:{branch:{type:Object,required:!0},draggable:Boolean,store:{type:Object,required:!0},ischild:{type:Boolean,default:!1}},data:()=>({toggle_state:{}}),setup:t=>t.store.exportToViewBlock(),methods:{toggle(t){this.toggle_state[t]=!this.toggle_state[t]},setDraggable(t){t.target.closest(".gc-draggable").setAttribute("draggable",!0)},endDraggable(t){t.target.closest(".gc-draggable").setAttribute("draggable",!1)},selectRow(t){this.store.next(t)}},computed:{sortable:()=>!0,children(){let t=[];this.store.circular&&this.branch[this.store.model]&&(t=this.branch[this.store.model]);for(let e in this.store.activechildren)this.branch[this.store.activechildren[e]]&&(t=t.concat(this.branch[this.store.activechildren[e]]));return t}},components:{}};const jt=g("data-v-cdc115c4");d("data-v-cdc115c4");const Rt=l("span",{class:"material-icons"},"subdirectory_arrow_right",-1),Dt=l("span",{class:"material-icons"},"keyboard_arrow_right",-1),Lt={key:0},Ft=l("span",{class:"material-icons"},"drag_handle",-1);u();const Ut=jt(((t,c,d,u,p,g)=>{const m=i("gc-tree-node",!0);return e(),s("div",{class:"gc-draggable",id:d.branch[d.store.primarykey],draggable:"false"},[l("div",{class:"gc-data-row",onClick:c[6]||(c[6]=t=>{g.selectRow(d.branch[d.store.primarykey])})},[l("div",null,[d.ischild?(e(),s("a",{key:0,"data-action":"more",class:"button",onClick:c[1]||(c[1]=y((t=>g.toggle(d.branch[d.store.primarykey],!1)),["prevent","stop"]))},[Rt])):(e(),s("a",{key:1,"data-action":"more",class:"button",onClick:c[2]||(c[2]=y((t=>g.toggle(d.branch[d.store.primarykey],!0)),["prevent","stop"]))},[Dt]))]),g.sortable?(e(),s("div",Lt,[l("a",{"data-action":"more",class:"button",onClick:c[3]||(c[3]=(...e)=>t.prevent.stop&&t.prevent.stop(...e)),onMousedown:c[4]||(c[4]=(...t)=>g.setDraggable&&g.setDraggable(...t)),onMouseup:c[5]||(c[5]=(...t)=>g.endDraggable&&g.endDraggable(...t))},[Ft],32)])):n("v-if",!0),(e(!0),s(o,null,_(t.fields,((t,i)=>(e(),s("div",{key:i},[l("span",null,r(d.branch[t.name]),1)])))),128))]),(e(!0),s(o,null,_(g.children,((t,r)=>a((e(),s(m,{branch:t,ischild:!0,key:r,store:d.store},null,8,["branch","store"])),[[h,p.toggle_state[d.branch[d.store.primarykey]]]]))),128))],8,["id"])}));j("\n.model-tree.branch[data-v-cdc115c4] {\r\n  padding-left: 8px;\r\n  padding-right: 8px;\r\n  margin: 6px 0;\r\n  background-color:#111111;\n}\n.tree .ide-block[data-v-cdc115c4] {\r\n\tdisplay : none;\n}\n.dragArea[data-v-cdc115c4] {\r\n  min-height: 50px;\r\n  outline: 1px solid #777777;\n}\r\n\r\n\r\n"),Vt.render=Ut,Vt.__scopeId="data-v-cdc115c4",Vt.__file="vite-sdk/src/components/gc-tree-node.vue";class Bt{constructor(t={}){this._handle=t.handle,this._drop_target=t.drop_target,this._drag_target=t.drag_target,this._call_back=t.callback,this._x=0,this._y=0,this._offset_x=0,this._offset_y=0,this._judder=t.judder?t.judder:5,this._drag_node,this._drop_node,this._tree=t.tree}isJudder(t,e){const s=t-this._x,r=e-this._y;return!(s<-5||s>5)&&!(r<-5||r>5)}getDirection(t,e){return{x:t==this._x?0:t>this._x?1:-1,y:e==this._y?0:e>this._y?1:-1}}offset(t){var e=t.getBoundingClientRect(),s=t.ownerDocument.defaultView;return{top:e.top+s.pageYOffset,left:e.left+s.pageXOffset}}insertAfter(){let t=this._drag_node.getAttribute("id"),e=this._drop_node.getAttribute("id"),s=0,r=0;if(this._drop_node.nextElementSibling){for(let t in this._tree){let i=this._tree[t];if(i.id==e){s=i.circular,r=i.sort;break}}for(let e in this._tree){let i=this._tree[e];i.id==t?(i.circular=s,i.sort=r+1):i.circular==s&&i.sort>r&&++i.sort}}else for(let e in this._tree){let r=this._tree[e];r.id==t&&(r.circular=s,r.sort=0)}}insertBefore(){let t=this._drag_node.getAttribute("id"),e=this._drop_node.getAttribute("id"),s=0,r=0;for(let t in this._tree){let i=this._tree[t];if(i.id==e){s=i.circular,r=i.sort,++i.sort;break}}for(let e in this._tree){let i=this._tree[e];i.id==t?(i.circular=s,i.sort=r):i.circular==s&&i.sort>r&&++i.sort}}dragStart(t){const e=t.target.closest("[id]");this._drag_node=e;const{top:s,left:r}=this.offset(e);t.dataTransfer.dropEffect="move",this._x=t.clientX,this._y=t.clientY,this._offset_x=t.clientX-r,this._offset_y=t.clientY-s}isDroppable(t){return!!t.target.closest(this._drop_target)}dragEnter(t){if(!this.isDroppable(t))return!0;if(t.preventDefault(),t.dataTransfer.dropEffect="move",this._drop_node=t.target.closest(this._drag_target),!this._drop_node||this._drop_node.getAttribute("id")==this._drag_node.getAttribute("id"))return;const e=this.getDirection(t.clientX,t.clientY);1==e.y?this.insertAfter():-1==e.y&&this.insertBefore(),this._x=t.clientX,this._y=t.clientY}dragOver(t){if(!this.isDroppable(t))return!0;t.preventDefault(),t.dataTransfer.dropEffect="move"}dragEnd(){this._drag_node&&this._drag_node.setAttribute("draggable",!1),this._drag_node=null}drop(t){if(!this._drop_node)return!0;t.preventDefault(),this._call_back&&this._call_back(this._tree)}}var Pt={initDD:function(t){let e=new Bt(t);if(document.querySelectorAll(t.handle).forEach((t=>t.addAttribute("draggable",!0))),t.handle){document.querySelectorAll(t.handle).forEach((e=>{e.addEventListener("mousedown",(e=>{e.target.closest(t.drag_target).addAttribute("draggable",!0)}))}))}t.main.addEventListener("dragstart",(t=>e.dragStart(t))),t.main.addEventListener("dragenter",(t=>e.dragEnter(t))),t.main.addEventListener("dragover",(t=>e.dragOver(t))),t.main.addEventListener("drop",(t=>e.drop(t))),t.main.addEventListener("dragend",(t=>e.dragEnd(t)))}},zt={name:"gc-tree",props:{store:{type:Object,required:!0}},setup(t){const e=C(null);let s=t.store.exportToViewBlock();return S((()=>{Pt.initDD({handle:".gc-drag-handle",drag_target:".gc-draggable",drop_target:".gc-drop-target",main:e.value,tree:t.store.data,callback:t.store.saveSort})})),{...s,treeroot:e}},components:{"gc-nav":at,"gc-tree-node":Vt,"gc-filter-form":kt,"gc-selectfields":Ot}};const Nt={class:"gc-data-header"},Mt=l("div",null," ",-1),qt={key:0},It={class:"gc-tree gc-drop-target",ref:"treeroot"};zt.render=function(t,a,c,h,d,u){const p=i("gc-tree-node");return e(),s("div",{class:c.store.classes},[l("div",Nt,[Mt,(e(!0),s(o,null,_(t.fields,(t=>(e(),s("div",{key:t.name,class:t.name},r(t.label),3)))),128)),c.store.sort?(e(),s("div",qt," ")):n("v-if",!0)]),l("div",It,[(e(!0),s(o,null,_(c.store.data,((t,r)=>(e(),s(p,{key:r,branch:t,store:c.store},null,8,["branch","store"])))),128))],512)],2)},zt.__file="vite-sdk/src/components/gc-tree.vue";var Gt={name:"gc-table",props:{store:{type:Object,required:!0}},setup:t=>t.store.exportToViewBlock(),methods:{orderBy(t,e){let s={};s[t.name]=e,this.store.orderby=s,this.store.pages>0?this.store.load():e?this.store.data.sort((function(e,s){let r=e[t.name],i=s[t.name];return r<i?-1:r>i?1:0})):this.store.data.sort((function(e,s){let r=e[t.name],i=s[t.name];return r<i?1:r>i?-1:0}))}},computed:{sortable(){return!!this.store.sort},overlimit:()=>!1,primarykey(){return this.store.primarykey}},components:{"gc-pagination":St}};const Ht=g("data-v-772343ca");d("data-v-772343ca");const Jt={class:"gc-data-table"},Xt={class:"gc-data-header"},Yt={key:0},$t={class:"gc-data-tbody"},Kt={key:0},Wt=l("span",{class:"material-icons"},"drag",-1);u();const Qt=Ht(((t,a,c,h,d,u)=>{const p=i("gc-pagination");return e(),s("div",{class:c.store.classes},[l("table",Jt,[l("thead",null,[l("tr",Xt,[(e(!0),s(o,null,_(t.fields,(t=>(e(),s("th",{key:t.name,class:t.name},[k(r(t.label)+" ",1),0==u.sortable?(e(),s("span",{key:0,class:"material-icons",onClick:e=>{u.orderBy(t,!1)}},"keyboard_arrow_up",8,["onClick"])):n("v-if",!0),0==u.sortable?(e(),s("span",{key:1,class:"material-icons",onClick:e=>{u.orderBy(t,!0)}},"keyboard_arrow_down",8,["onClick"])):n("v-if",!0)],2)))),128)),u.sortable?(e(),s("th",Yt," ")):n("v-if",!0)])]),l("tbody",$t,[(e(!0),s(o,null,_(c.store.data,((i,h)=>(e(),s("tr",{class:"gc-data-row",key:h,onClick:t=>{c.store.next(i[u.primarykey])}},[(e(!0),s(o,null,_(t.fields,((t,o)=>(e(),s("td",{key:o,class:t.name},r(i[t.name]),3)))),128)),u.sortable?(e(),s("td",Kt,[l("a",{"data-action":"more",class:"button",onClick:a[1]||(a[1]=y(((...e)=>t.toggle&&t.toggle(...e)),["prevent"])),draggable:"true"},[Wt])])):n("v-if",!0)],8,["onClick"])))),128))])]),u.overlimit?(e(),s(p,{key:0})):n("v-if",!0)],2)}));j("\n.table[data-v-772343ca], .thead[data-v-772343ca], .tbody[data-v-772343ca], .tr[data-v-772343ca] {\r\n    width : 100%;\n}\r\n\r\n\r\n"),Gt.render=Qt,Gt.__scopeId="data-v-772343ca",Gt.__file="vite-sdk/src/components/gc-table.vue";var Zt={name:"gc-repo",props:{store:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(t){let e=t.store.exportToViewBlock();return e.key=t.store.model+"-"+t.store.action,e},components:{"gc-repo-header":At,"gc-tree":zt,"gc-table":Gt}};const te=g("data-v-19e0d3b5")(((t,r,o,a,c,h)=>{const d=i("gc-repo-header");return o.active?(e(),s("div",{key:0,class:o.store.classes},[l(d,{store:o.store},null,8,["store"]),(e(),s(T(o.store.rawcomponent),{key:t.key,store:o.store},null,8,["store"]))],2)):n("v-if",!0)}));let ee;function se(t){t||(t=window.location.pathname),ee&&ee(t)}j("\n.table[data-v-19e0d3b5], .thead[data-v-19e0d3b5], .tbody[data-v-19e0d3b5], .tr[data-v-19e0d3b5] {\r\n    width : 100%;\n}\n.gc-data-row[data-v-19e0d3b5]:nth-child(odd) {background : #CCC}\r\n\r\n"),Zt.render=te,Zt.__scopeId="data-v-19e0d3b5",Zt.__file="vite-sdk/src/components/gc-repo.vue",window.onpopstate=function(t){se(document.location)};var re={setRoute:function(t,e=""){window.history.pushState({name:t},document.title,t),se(t)},hardSetRoute:function(t){window.location=t},runRoute:se,regCallback:function(t){ee=t}},ie=t({name:"gc-nav",props:{state:Object},methods:{setRoute(t){re.switchRoute(t)}},computed:{arr:()=>re.history}});const oe={class:"gc-breadcrumbs"};ie.render=function(t,i,n,a,l,c){return e(),s("span",oe,[(e(!0),s(o,null,_(t.arr,(i=>(e(),s("a",{key:i,onClick:e=>{t.setRoute(i.r)}},r(i.n),9,["onClick"])))),128))])},ie.__file="vite-sdk/src/components/gc-breadcrumbs.vue";var ne=t({name:"gc-single-item",props:{store:Object,active:{type:Boolean,default:!1}},setup:t=>t.store.exportToViewBlock(),computed:{editnav(){return this.store.actions.put},delnav(){return this.store.actions.delete},title(){return this.store.title+" "+this.store.summary()}},methods:{runDel(){this.store.runDelete()}},components:{"gc-nav":at,"gc-breadcrumbs":ie,"gc-widget":ft}});const ae={class:"gc-nav"};ne.render=function(t,a,c,h,d,u){const p=i("gc-breadcrumbs"),g=i("gc-widget");return e(),s(o,null,[l(p,{state:t.store},null,8,["state"]),l(g,{title:t.title,active:t.active},{default:x((()=>[l("div",{class:t.store.classes},[l("h1",null,r(t.store.title),1),l("span",ae,[t.editnav?(e(),s("a",{key:0,onClick:a[1]||(a[1]=e=>{t.setRoute(t.editnav.r,t.editnav.params)})},r(t.editnav.n),1)):n("v-if",!0),t.delnav?(e(),s("a",{key:1,onClick:a[2]||(a[2]=e=>{t.runDel()})},r(t.delnav.n),1)):n("v-if",!0)]),(e(!0),s(o,null,_(t.store.fields,((i,o)=>(e(),s("div",{key:o,class:i.name},[l("span",null,r(i.label)+":",1),l("span",null,r(t.store.data[i.name]),1)],2)))),128))],2)])),_:1},8,["title","active"])],64)},ne.__file="vite-sdk/src/components/gc-single-item.vue";var le=t({name:"gc-login",props:{store:Object},setup:t=>({...t.store.exportToViewBlock(),...it.exportToView(t.store.model+"-"+t.store.action)}),computed:{hasLogin(){return!("post"!=this.store.getModelType()||!this.store.actions.login)},hasPost(){return!("login"!=this.store.getModelType()||!this.store.actions.post)}},components:{"gc-form":ot}});const ce={key:0,class:"gc-nav"},he={key:1,clas:"gc-nav"};le.render=function(t,o,a,c,h,d){const u=i("gc-form");return e(),s("div",null,[l(u,{store:t.store},null,8,["store"]),l("div",null,[t.hasPost?(e(),s("span",ce,[l("a",{onClick:o[1]||(o[1]=e=>{t.setRoute(t.store.actions.post.r)})},r(t.dict("post",t.store.actions.post.n)),1)])):n("v-if",!0),t.hasLogin?(e(),s("span",he,[l("a",{onClick:o[2]||(o[2]=e=>{t.setRoute(t.store.actions.login.r)})},r(t.dict("post",t.store.actions.login.n)),1)])):n("v-if",!0)])])},le.__file="vite-sdk/src/components/gc-accounthandler.vue";var de=t({props:{group:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup:t=>({ctrl:b("ctrl"),group:t.group}),computed:{key(){return this.model?this.model.model+"-"+this.model.action:""},actions(){return this.group.siblings.set},model(){return this.group.model},component(){return this.model?this.model.component:""},actualcomponent(){}},components:{"gc-form":ot,"gc-nav":at,"gc-single-item":ne,"gc-account-handler":le,"gc-repo":Zt}});const ue={class:"gc-tabs"},_e={class:"tab"};de.render=function(t,r,o,n,a,c){const h=i("gc-nav");return e(),s("div",ue,[l(h,{actions:t.actions},null,8,["actions"]),l("div",_e,[(e(),s(T(t.component),{key:t.key,store:this.group.model,active:this.group.active},null,8,["store","active"]))])])},de.__file="vite-sdk/src/components/gc-tabs.vue";var pe={encodeParams:function(t){let e={},s=[];for(let r in t)"object"==typeof t[r]&&t[r]||Array.isArray(t[r])?e[r]=t[r]:s.push(r+"="+encodeURIComponent(t[r]));return Object.keys(e).length>0&&s.push("graph="+encodeURIComponent(JSON.stringify(e))),s.join("&")},decodeParams:function(){const t=new URLSearchParams(window.location.search);let e={};return t.forEach((function(t,s){if("graph"==s){let s=JSON.parse(decodeURIComponent(t));e={...e,...s}}else e[s]=t})),e},mapParams:function(t,e){for(let s in e){const r=new RegExp("${"+s+"}","g");t=t.replace(r,e[s])}return t}};let ge="",me=[],fe={};function ve(t){let e=(t=t.replace(ge,"")).split("/c");for(let t in e){if(me.length<=t)throw"Controller hasn't been registered";me[t].convertFromURL(e[t])}}function ye(){let t=[];for(let e of me)t.push(e.convertToURL());let e=ge+t.join("/c");const s=pe.encodeParams(fe);return s&&(e+="?"+s),e}re.regCallback(ve);var be={regCtrl:function(t){me.push(t)},regParam:function(t,e){fe[t]=e},removeParam:function(t){delete fe[t]},setBase:function(t){t=t.replace(/^\/+|\/+$/g,""),ge="/"+t},convertToURL:ye,runRoute:function(){const t=ye();re.setRoute(t)},reloadFromBase:function(t){t&&(t=t.replace(/^\/+/g,"")),re.hardSetRoute(ge+"/"+t)},convertFromURL:ve},ke=t({setup(){},methods:{logout(){z.post("/core-logout").then((t=>{be.reloadFromBase()}))}}});ke.render=function(t,r,i,o,n,a){return e(),s("a",{onClick:r[1]||(r[1]=(...e)=>t.logout&&t.logout(...e))},"Logout")},ke.__file="vite-sdk/src/components/gc-account-details.vue";var we=t({name:"gc-root",setup:()=>({ctrl:b("ctrl")}),computed:{groups(){return this.ctrl.store.groups},isaccount(){return"public"!=this.ctrl.store.profile}},components:{"gc-tabs":de,"gc-nav":at,"gc-account-details":ke}});we.render=function(t,r,a,c,h,d){const u=i("gc-account-details"),p=i("gc-nav"),g=i("gc-tabs");return e(),s(o,null,[t.isaccount?(e(),s(u,{key:0})):n("v-if",!0),(e(!0),s(o,null,_(t.groups,((t,r)=>(e(),s("div",{class:"gc-root gc-wrapper",key:r},[l(p,{actions:t.actions},null,8,["actions"]),l(g,{group:t},null,8,["group"])])))),128))],64)},we.__file="vite-sdk/src/components/gc-root.vue";class xe{constructor(){this._min,this._max,this._has=[],this._has_not=[],this._errors={OK:0,MIN_VALUE:1,MAX_VALUE:2,HAS:3,HAS_NOT:4}}set min(t){this._min=t}set max(t){this._max=t}set has(t){this._has.push(t)}set nothas(t){this._has_not.push(t)}validateSize(t){return t<this._min?this._errors.MIN_VALUE:t>this._max?this._errors.MAX_VALUE:this._errors.OK}validate(t){let e;if(isNaN(t)){const s=t?t.length:0;e=this.validateSize(s)}else e=this.validateSize(t);if(e!=this._errors.OK)return e;for(let e of this._has_not)if(t.match(e))return this._errors.HAS_NOT;if(0==this._has.length)return this._errors.OK;for(let e of this._has)if(t.match(this._has))return this._errors.OK;return this._errors.HAS}}class Ce{constructor(t,e=null){if(this._name=t,this._type,this._is_primary=!1,this._is_parent=!1,this._valid=1,this._atts={},this._confirm=!1,this._readonly=!1,this._placeholder="",this._conditions,this._link,this._reference,this._error=0,this._label="",this._on=!0,this._summary=!1,this._default=null,this._validator=new xe,e){for(let t in e)"field"!=t&&"validator"!=t&&(this[t]=e[t]);if(e.field)for(let t in e.field)this[t]=e.field[t];if(e.validation)for(let t in e.validation)this._validator[t]=e.validation[t]}}set confirm(t){this._confirm=t}set readonly(t){this._readonly=t}set placeholder(t){this._placeholder=t}set atts(t){this._atts=t}set default(t){this._default=t}set conditions(t){this._conditions=t}set link(t){this._link=t}set name(t){this._name=t}set type(t){this._type=t}set on(t){this._on=t}set is_primary(t){this._is_primary=t}set is_parent(t){this._is_parent=t}set reference(t){this._reference=t}set error(t){this._error=t}set label(t){this._label=t}set summary(t){this._summary=t}get name(){return this._name}get type(){return this._type}get isprimary(){return this._is_primary}get required(){return this._min>0}get summary(){return this._summary}get readonly(){return this._readonly}get placeholder(){return this._placeholder}get default(){return this._default}get on(){return this._on}get atts(){return this._atts}get conditions(){return this._conditions}get link(){return this._link}get isparent(){return this._is_parent}get confirm(){return this._confirm}get reference(){return this._reference}get error(){return this._error?isNaN(this._error)?this._error:Z.getError(this._error):""}get label(){return this._label}validate(t){return this._validator.validate(t)}exp(){return{name:this._name,type:this._type,atts:this._atts}}calcValue(t){return t||""}}class Se{constructor(t,e,s){this._model=t,this._action=null,this._api_urls=s.api_urls,this._primary_key=s.primarykey,this._parent_key=s.parentkey,this._parent_value=e,this._key=0,this._params={},this._fields=O(s.fields),this._data=O({}),this._label=s.label,this._title=s.title,this._component,this._actions=null,this._next=null,this._custom=s.custom?s.custom:{};for(let t in s)"_"!=t.charAt(0)?this["_"+t]=s[t]:this[t]=s[t]}get classes(){return this._model.replace("/","")+" gc-"+this._action+" gc-"+this.getModelType()+" "+this._component}get action(){return this._action}get model(){return this._model}get component(){return this._component}get apiurls(){return this._api_urls}get isinit(){return this._init}get parentkey(){return this._parent_key}get primarykey(){return this._primary_key}get key(){return this._key}get component(){return this._component}get data(){return this._data}get fields(){return this._fields}get states(){return this._states}get params(){return this._params}get title(){return this._title}get label(){return this._label}get data(){return this._data}get actions(){return this._actions}get next(){return this._next}get all_fields(){return this._fields}get parentvalue(){return this._parent_value}set params(t){this._params=t}set action(t){this._action=t}set apiurls(t){this._api_urls=t}set action(t){this._action=t}set component(t){this._component=t}set custom_actions(t){this._custom_actions=t}set actions(t){this._actions=t}set next(t){this._next=t}set parentvalue(t){this._parent_value=t}addParam(t,e){this._params[t]=e}initFields(t,e){this._fields[t]=new Ce(t,e)}exportToViewBlock(){let t=b("ctrl");return{...{setRoute:function(e){e(),t.runLink()},fields:A((()=>{let t={};for(let e in this._fields)this._fields[e].on&&(t[e]=this._fields[e]);return t})),ctrl:t},...it.exportToView(this.model+"-"+this.action)}}exportToViewField(t){let e=C(!1),s={isvalidateon:e,setValidateOn:()=>{e.value=!0},showError:A((()=>!(!e.value||!t.error))),validate:()=>{let e=this._data[t.name];this._fields[t.name].error=t.validate(e)}};if("select"==t.type)if(t.reference){s.options=O([]);let e={};this._parent_key&&(e[this._parent_key]=this.parentvalue),z.get(t.reference,e).then((t=>{for(let e in t.__data)0!==e.indexOf("__")&&s.options.push({key:t.__data[e].id,value:t.__data[e].value})})).catch((t=>{console.log(t)}))}else{s.options=[];for(let e of t.atts.options)s.options.push({key:e,value:e})}return{...s,...it.exportToView(this.model+"-"+this.action+"-"+t.name)}}runNext(){this._next&&this._next(this)}}class Te{constructor(){this._size=0,this._blob=null,this._uploaded=!1,this._chunk_size=0,this._load_url,this._save_url,this._key=0}set chunk_size(t){this._chunk_size=t}set blob(t){this._blob=t}set load_url(t){this._load_url=t}set save_url(t){this._save_url=t}set key(t){this._key=t}get blob(){return this._blob}get size(){return this._size}get uploaded(){return this._uploaded}get chunk_size(){return this._chunk_size}get url(){return this._url}getChunk(t){const e=0==this._chunk_size?0:t*this._chunk_size;let s=0==this._chunk_size?this._size:(t+1)*this._chunk_size;s>this._size&&(s=this._size);const r=new DataView(this._blob,e,s-e);let i=[];for(let t=0,e=r.byteLength;t<e;++t)i.push(r.getInt8(t));return i.join("")}uploadAsset(t,e,s){return z.put(t,e).then((()=>{s&&s()})).catch((t=>{alert(t)}))}loadFile(t){}saveFile(t,e,s){return this._size=t.size,new Promise(((e,s)=>{const r=new FileReader;let i=this;r.onload=function(t){i.blob=t.target.result,e(r.result)},r.onerror=s,r.readAsArrayBuffer(t)})).then((()=>{let t=[],r=0==this.chunk_size?1:Math.ceil(this.size/this.chunk_size);for(let i=0;i<r;++i){const r={};r.__chunk=i,r.__blob=this.getChunk(i),r.id=e,t.push(this.uploadAsset(this.save_url,r,s))}return Promise.all(t)}))}}class Oe extends Se{constructor(t,e,s){super(t,e,s),this._status=O({total:0,progress:0});for(let t in this._fields)this._fields[t].atts&&"password"==this._fields[t].atts.type&&(this._fields[t].confirm=!0);this._component="gc-form"}getModelType(){return"post"}get status(){return this._status}load(){for(let t in this._fields)if("asset"==this._fields[t].type){let e=this._fields[t].name.replace("_","-");this._data[t]=new Te,this._data[t].save_url=this._api_urls.save+"-"+e,this._data[t].chunk_size=this._fields[t].chunk_size}else this._data[t]=this._fields[t].default;if(this._custom.load)return this._custom.load(this)}saveAsset(t){const e=this._data[t.name];if(!e)return Promise.resolve();asset.saveFile(e,this._key,(()=>++this._status.progress)),this._status.total+=asset.num_chunks}submit(){let t=this._data;return this._parent_key&&(t[this._parent_key]=this.parentvalue),z.post(this._api_urls.save,t).then((t=>{if("SUCCESS"!=t.__status)throw t;this._data[this._primary_key]=t[this._primary_key]})).then((()=>{if(this._custom.submit)return this._custom.submit(this)}))}exportToViewField(t){let e=super.exportToViewField(t);return e.val=A({get:()=>"checkbox"==t.type?Boolean(this._data[t.name]):this._data[t.name],set:s=>{this._data[t.name]=s,e.validate()}}),e}}class Ae extends Se{constructor(t,e,s){super(t,e,s),this._has_changes={},this._status=O({total:0,progress:0});for(let t in this._fields)this._fields[t].atts&&"password"==this._fields[t].atts.type&&(this._fields[t].confirm=!0)}getModelType(){return"put"}get component(){return"gc-form"}get status(){return this._status}load(t){let e={};return e[this._primary_key]=t,this._data[this._primary_key]=t,z.get(this._api_urls.load,e).then((t=>{for(let e in this._fields)if("asset"==this._fields[e].type){let t=this._fields[e].name.replace("_","-");this._data[e]=new Te,this._data[e].load_url=this._api_urls.load_url+"-"+t,this._data[e].save_url=this._api_urls.save+"-"+t,this._data[e].chunk_size=this._fields[e].chunk_size,this._data[e].key=this._key}else this._data[e]=t[e]})).then((()=>{if(this._custom.load)return this._custom.load(this)})).catch((t=>{alert(t)}))}saveAsset(t){const e=this._data[t.name];if(!e)return Promise.resolve();asset.saveFile(e,this._key,(()=>++this._status.progress)),this._status.total+=asset.num_chunks}submit(){return z.put(this._api_urls.save,this._data).then((t=>{if("SUCCESS"!=t.__status)throw t})).then((()=>{if(this._custom.submit)return this._custom.submit(this)}))}exportToViewField(t){let e=super.exportToViewField(t);return e.val=A({get:()=>"checkbox"==t.type?Boolean(this._data[t.name]):this._data[t.name],set:s=>{this._has_changes[t.name]=!0,this._data[t.name]=s,e.validate()}}),e}}class Ee extends Se{constructor(t,e,s){super(t,e,s),this._component="gc-single-item"}get hasdelete(){return!!this._api_urls.delete}getModelType(){return"getprimary"}load(t){let e={};return t&&(e[this._primary_key]=t),z.get(this._api_urls.load,e).then((t=>{for(let e in this._fields)"asset"==this._fields[e].type?(this._data[e]=new Te,this._data[e].load_url=this._api_urls.load_url+"-"+kebab_name,this._data[e].chunk_size=this._fields[e].chunk_size,this._data[e].key=this._key):this._data[e]=t[e]})).then((()=>{if(this._custom.load)return this._custom.load(this)})).catch((t=>{alert(t)}))}runDelete(){if(this.hasdelete&&confirm("Are you sure you want to delete this record?")){let t={};t[this._primary_key]=this._data[this._primary_key],z.delete(this._api_urls.delete,t).then((()=>{this._parent_key&&({}[this._parent_key]=this._data.gets(this._parent_key))})).then((()=>{if(this._custom.delete)return this._custom.delete(this)}))}}summary(){let t="";for(let e in this._field)this._fields[e].summary&&(t+=this._fields[e].summary+" ");return t.trim()}}class Ve extends Se{constructor(t,e,s){super(t,e,s),this._pages=0,this._children=s.children?s.children:[],this._circular=s.circular,this._component=s.circular||this._children.length>0?"gc-tree":"gc-table",this._sort=s.sort,this._key,this._data=O([]),this._search_data=O({}),this._active_children=[],this._order_by={},this._limit_fields=[],this._page=0,this._limit=1e3,this._select_fields=[],this._selected_fields=[];let r=0;for(let t in this._fields)t!=this._parent_key&&(r<2||this._fields[t].summary?(this._fields[t].on=!0,this._limit_fields.push(t),++r):(this._fields[t].on=!1,this._select_fields.push(t)),"select"==this._fields[t].type?this._search_data[t]=[]:this._search_data[t]="")}getModelType(){return"repo"}get key(){return this._key}set key(t){this._key=t}set circular(t){this._circular=t}set sort(t){this._sort=t}set orderby(t){this._order_by=t}get pages(){return this._pages}get component(){return"gc-repo"}get rawcomponent(){return this._component}get orderby(){return this._order_by}get circular(){return this._circular}get sort(){return this._sort}get children(){return this._children}get limitedfields(){return[...this._limit_fields,...this._selected_fields]}get selectfields(){return this._select_fields}get selectedfields(){return this._selected_fields}get searchdata(){return this._search_data}get activechildren(){return this._active_children}get parentvalue(){return this._key}set params(t){this._params=t}set selectedfields(t){this._selected_fields=t}get params(){let t=this._params;this._key&&(t[this._parent_key]=this._key);const e=this.limitedfields;if(e>0&&(t.__fields=e),this._active_children.length>0&&(t.__children=this._active_children),this._search_data)for(let e in this._search_data)this._search_data[e]&&(Array.isArray(this._search_data[e])?this._search_data[e].length>0&&(t[e]=this._search_data[e]):t[e]=this._search_data[e]);return this._order_by&&(t.__order=this._order_by),this._pages>0&&(t.__limit=this._page+", "+this._limit),t}rLoadObj(t){let e={};for(const s in this._fields)this._fields[s].on&&(e[s]=t[s]);if(this._circular&&t[this._model]&&t[this._model]){e[this._model]=[];for(const s in t[this._model])e[this._model].push(this.rLoadObj(t[this._model][s]))}for(const s in this._active_children){const r=this._active_children[s];if(t[r]){e[r]=[];for(const s in t[r])e[r].push(this.rLoadObj(t[r][s]))}}return e}load(t){this._key=t,this._data=[];for(const t in this._fields)this._fields[t].on=!1;for(const t in this.limitedfields)this._fields[this.limitedfields[t]].on=!0;return z.get(this._api_urls.load,this.params).then((t=>{for(const e in t.__data){const s=this.rLoadObj(t.__data[e]);this._data.push(s)}})).then((()=>{if(this._custom.load)return this._custom.load(this)})).catch((t=>{alert(t)}))}submit(){return this.load()}sortData(){this._data.sort(((t,e)=>t[this._primary_key]==e[this._primary_key]?0:this._circular&&t[this._circular]!=e[this._circular]?t[this._circular]<=e[this._circular]?-1:1:t[this._sort]<=e[this._sort]?-1:1))}saveSort(){let t=[];for(let e in this._data){let s={};s[this._primary_key]=this._data[e][this._primary_key],this._circular&&(s[this._circular]=this._data[e][this._circular]),s[this._sort]=this._data[e][this._sort],t.push(s)}z.put(this.state.apiurls.put,t).then((()=>{if(this._custom.sort)return this._custom.sort(this)})).catch((t=>{console.log(t)}))}updateFields(t){for(let e of t)this._fields[e.name].on=e.show;this.load()}search(){let t=data.getData();this._params={};for(let e in t)if(""!=t[e]){const s=this._fields[e];if("checkbox"==s.type||"select"==s.type)this._params[e]=t[e];else if("time"==s.type){let s={};t[e][0]&&(s.min=t[e][0]),t[e][1]&&(s.max=t[e][1]),s&&(this._params[e]=s)}else this._params[e]="%"+t[e]+"%"}this.load()}exportToViewField(t){let e=super.exportToViewField(t);return e.val=A({get:()=>"checkbox"==t.type?Boolean(this._data[t.name]):this._data[t.name],set:s=>{this._data[t.name]=s,e.validate()}}),e}}class je extends Se{constructor(t,e,s){super(t,e,s),this._next_profile="public",this._next_id=0,this._component="gc-account-handler",this._globalerror=""}getModelType(){return"login"}get globalerror(){return this._globalerror}get next_profile(){return this._next_profile}load(){if(this._custom.load)return this._custom.load(this)}submit(){return this._globalerror="",z.post(this._api_urls.login,this._data).then((t=>{if("SUCCESS"!=t.__status)throw t;this._next_profile=t.__profile,this._next_id=t.__profile_id})).then((()=>{if(this._custom.submit)return this._custom.submit(this)}))}exportToViewField(t){let e=super.exportToViewField(t);return e.val=A({get:()=>"checkbox"==t.type?Boolean(this._data[t.name]):this._data[t.name],set:s=>{this._data[t.name]=s,e.validate()}}),e}}class Re{constructor(t,e,s,r={}){this._name=t.model,this._label=s.label,this._states={},this._active_state=null,this._options=r,this._primary_key=s.primarykey,this._parent_key=s.parentkey,this._children=s.children,this._parent_value=e,this._key=0,this.buildlink=(e,s=0)=>()=>{t.overwrite(this._name,e,s),t.endChain()};for(let e in s.states){let i=null,o={};if("get"==e||"getprimary"==e)for(let t in s.fields)o[t]=new Ce(t,s.fields[t]);else{let t=s.states[e].fields;for(let e in t)o[t[e]]=new Ce(t[e],s.fields[t[e]])}s.states[e].fields=o,s.states[e].primarykey=this._primary_key,s.states[e].parentkey=this._parent_key,s.circular&&(s.states[e].circular=s.circular),this.setActions(t,s.states),this._options[e]&&(s.states[e].custom=this._options[e]),"get"==e?i=new Ve(this._name,this._parent_value,s.states[e]):"getprimary"==e?i=new Ee(this._name,this._parent_value,s.states[e]):"post"==e?(i=new Oe(this._name,this._parent_value,s.states[e]),s.states.login&&(i.component="gc-account-handler")):"put"==e?i=new Ae(this._name,this._parent_value,s.states[e]):"login"==e&&(i=new je(this._name,this._parent_value,s.states[e])),this._states[e]=i,console.log("Building a state for ",e,i),console.log("Passed through custom options",r),this._options[e]&&this._options[e].init&&this._options[e].init(i)}this._active_state=t.state}get name(){return this._name}get currentstate(){return this._active_state?this._states[this._active_state]:null}get label(){return this._label}get action(){return this._active_state}get activestate(){return this._active_state&&this._states[this._active_state]?this._states[this._active_state]:null}get children(){return this._children}load(t){return t.prev&&(this.currentstate.parentkeyvalue=t.prev.key),this.currentstate.load(t.key)}setActions(t,e){e.get&&this.createGetActions(t,e),e.getprimary&&this.createGetPrimaryActions(t,e),e.post&&this.createPostActions(t,e),e.put&&this.createPutActions(t,e),e.login&&this.createLoginActions(t,e)}createGetActions(t,e){let s={};e.post&&(s.post={r:this.buildlink("post",t.key),n:e.post.label}),e.get.actions=s,e.get.next=s=>{e.getprimary?(t.overwrite(this._name,"getprimary",s),be.runRoute()):e.put&&(t.overwrite(this._name,"put",s),be.runRoute())}}createGetPrimaryActions(t,e){let s={};e.put&&(s.put={r:this.buildlink("put",t.key),n:e.put.label}),e.getprimary&&e.getprimary.api_urls.delete&&(s.delete={r:this.buildlink("delete",t.key),n:"delete"}),e.getprimary.actions=s}createPostActions(t,e){let s=[];e.login&&(s.login={r:this.buildlink("login"),n:e.login.label}),e.post.actions=s,e.post.next=e=>{t.createTempURL(this._name,"get",e)}}createPutActions(t,e){e.put.next=()=>{t.createTempURL(this._name,"get")}}createLoginActions(t,e){let s=[];e.post&&(s.post={r:this.buildlink("post"),n:e.post.label}),e.login.actions=s,e.login.next=t=>{be.reloadFromBase(t.next_profile)}}exportToViewBlock(){return{actions:actions}}getCurrentState(){return this._active_state?this._states[this._active_state]:null}exportToStore(){return this.currentstate}}class De{constructor(t=null){this._parent=t,this._model=null,this._model_set=O({set:[]}),this._options={},this._key=0,this._init=!1,this._is_active=!1}get model(){return this._model}get children(){return this.model?this.model.children:[]}get key(){return this._key}get is_active(){return this._is_active}set key(t){this._key=t}set is_active(t){this._is_active=t}injectCustomSettings(t){this._options=t}buildLink(t,e,s){return()=>{t.overwrite(e,s,this._model.currentstate.parentvalue),t.endChain()}}getDefaultState(t){return t.get?"get":t.getprimary?"getprimary":t.login?"login":t.put?"put":t.post?"post":void 0}init(t){let e=t.prev?t.prev.key:0;this._model=null,this._model_set.set=[],this._init=!0;let s="/route-";return s+=this._parent&&"__default"!=this._parent?this._parent:"default",z.get(s).then((s=>{if("SUCCESS"!=s.__status)throw new Error(s);for(let r in s.routes)(t.model||this._model)&&t.model!=r||(t.model=r,t.state||(t.state=this.getDefaultState(s.routes[r].states)),this._model=new Re(t,e,s.routes[r],this._options[r])),this._model_set.set.push({n:s.routes[r].label,r:this.buildLink(t,r,this.getDefaultState(s.routes[r].states))});return s}))}getCurrentState(){return this._model?this._model.getCurrentState():null}run(t){return this.init(t).then((()=>this._model.load(t)))}exportToStore(){return this._model_set}}class Le{constructor(t={}){this._store=O({groups:[],profile:null}),this._model_settings={},this._route_interrupt=null,this._map=null,this._groups=[],this._settings=t,this._profile}get store(){return this._store}get groups(){return this._groups}set map(t){this._map=t}get map(){return this._map}initProfile(){return z.get("/core-check-user").then((t=>(this._profile=t.__profile,this._store.profile=this._profile,this._profile)))}assumeRole(t){return gc.Client.post("/core-assume-role",{role:t}).then((t=>(this._profile=t.__profile,t.__profile)))}buildGroup(t){console.log("Building model group for",t.group);let e=new De(t.group);return this._settings[this._profile]&&(console.log("Injecting Settings for ",this._profile),e.injectCustomSettings(this._settings[this._profile])),this._groups.push(e),e}run(){let t=this._map.maps;if(!t)throw new Error("Error with controller run, no maps created");this._store.groups=[];let e=[],s=t;for(let t in this._groups){if(!s||!s.notchanged){this._groups.splice(t,this._groups.length-t);break}s=s.next}for(;s;){const t=this.buildGroup(s);e.push(t.run(s)),s=s.next}Promise.all(e).then((()=>{const t=this._map.lastmap;if("getprimary"==t.state){let e=this._groups[this._groups.length-1];if(e.is_active=!0,e.model.children.length>0){const e=this._map.createMap(t.model);e.key=t.key;return this.buildGroup(e).run(e)}}else{for(let t of this._groups)t.is_active=!1;this._groups[this._groups.length-1].is_active=!0}})).then((()=>{for(let t of this._groups)this._store.groups.push({siblings:t.exportToStore(),active:t.is_active,model:t.model.exportToStore()})}))}runLink(){be.runRoute()}}const Fe={post:"-create",put:"-update",delete:"-delete",login:"-login",logout:"-logout",getprimary:"-primary",get:""};class Ue{constructor(t){this._group=t,this._model,this._state,this._key=0,this._not_changed=!1,this._next,this._prev,this._overwrite=null}set model(t){this._model=t}set state(t){this._state=t}set key(t){this._key=t}set group(t){this._group=t}set notchanged(t){this._not_changed=t}set next(t){this._next=t,t.prev=this}set prev(t){this._prev=t}get model(){return this._model}get state(){return this._state}get key(){return this._key}get group(){return this._group}get notchanged(){return this._not_changed}get next(){return this._next}get prev(){return this._prev}swap(t){this._group=t.group,this._model=t.model,this._state=t.state,this._key=t.key,this._next=t.next,this._not_changed=!1}endChain(){this._next=null}overwrite(t,e,s){this._overwrite={},this._overwrite.model=t,this._overwrite.state=e,this._overwrite.key=s}matches(t){let e=["group","model","state","key"];for(let s of e){if(t[s]!=this[s])return!1}return!0}convertToURL(){let t=this._model,e=this._state,s=this._key;this._overwrite&&(t=this._overwrite.model,e=this._overwrite.state,s=this._overwrite.key);let r=t+Fe[e];return s&&(r+="-"+s),r}convertFromURL(t){let e=t.split("-");if(0==e.length)return;let s=parseInt(e[e.length-1]);if(isNaN(s)?this._key=0:(e.pop(),this._key=s),0==e.length)throw new Error("Can't convert this url string: "+t);for(let t in Fe)if(Fe[t]=="-"+e[e.length-1]){this._state=t,e.pop();break}this._model=e.join("-")}}class Be{constructor(t){this._root=null,this._ctrl=t,this._trigger}get ctrl(){return this._ctrl}get maps(){return this._root}get lastmap(){if(!this._root)return null;let t=this._root;for(;t.next;)t=t.next;return t}append(t){const e=this.lastmap;e?e.next=t:this._root=t}trigger(t){this._trigger=t}createMap(t){let e=new Ue(t);return this.append(e),e}convertToURL(){let t=[],e=this._root;for(;e;)t.push(e.convertToURL()),e=e.next;return"/"+t.join("/")}convertFromURL(t){let e=(t=t.replace(/^\/+|\/+$/g,"")).split("/"),s="__default",r=this._root;for(let t in e){let i=new Ue(s);i.convertFromURL(e[t]),r?r.matches(i)?r.notchanged=!0:r.swap(i):this.append(i),s=i.model,r&&(r=r.next)}console.log(this._root),this._trigger()}}var Pe={createController:function(t={}){let e=new Le(t),s=new Be;return e.map=s,s.trigger((()=>{e.run()})),be.regCtrl(s),e},regSettings:function(t){}};var ze={injectSettings:function(t){if(!t.client)throw new Error("You must set client settings");if(z.setURL(t.client.url),t.client.custom_headers)for(let e in t.client.custom_headers)z.regCustomHeader(e,t.client.custom_headers[e]);t.client.debug&&z.regDebug(!0),z.regStatusHandler(403,(function(){alert("Page not found")})),t.mapper&&t.mapper.base&&be.setBase(t.mapper.base),t.models&&Pe.regSettings(t.models)}},Ne={GCRoot:we,Router:re,Controller:Le,Client:z,URLMapper:be,FactoryController:Pe,Settings:ze,GCForm:ot,GCSingleItem:ne,GCTable:Gt,GCTree:zt,GCRepo:Zt};export{Ne as default};
//# sourceMappingURL=gc.es.js.map
