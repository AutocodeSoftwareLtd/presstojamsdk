"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("vue");function t(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}const n={class:"ptj-modal-backdrop"},o={class:"ptj-modal"};var r={props:{active:{required:!0}},setup:t=>(r,s)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",n,[e.createElementVNode("div",o,[e.createElementVNode("header",null,[e.createElementVNode("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=e=>{r.$emit("close")})}," x ")]),e.renderSlot(r.$slots,"default")])],512)),[[e.vShow,t.active]]),__file:"presstojam/src/components/ptj-modal.vue"};let s={};var i={regSettings:function(e,t=null){t?s[t]=e:s=e},getSettings:function(e){return s[e]},getModelSettings:function(e,t){return s.models&&s.models[e]&&s.models[e][t]?s.models[e][t]:{}}};let l,a={};var c={initSettings(){const e=i.getSettings("client");if(!e.url)throw"No URL defined for client";if(l=e.url,e.custom_headers)for(let t in e.custom_headers)a[t]=e.custom_headers[t]},run(e,t){return l||this.initSettings(),t.mode="cors",t.cache="no-cache",t.credentials="include",t["Content-Type"]="application/json",t.headers=a,fetch(l+e,t).then((e=>{if(e.ok)return e.json();throw e}))},get(e,t){if(t){const n=new URLSearchParams;for(let e in t)Array.isArray(t[e])||"object"==typeof t[e]&&null!==t[e]?n.append(e,JSON.stringify(t[e])):n.append(e,t[e]);-1==e.indexOf("?")?e+="?":e+="&",e+=n.toString()}let n={method:"GET"};return this.run(e,n)},getprimary(e,t){return this.get(e,t)},post(e,t){let n={method:"POST"};return n.body=JSON.stringify(t),this.run(e,n)},put(e,t){let n={method:"PUT"};return n.body=JSON.stringify(t),this.run(e,n)},patch(e,t){let n={method:"PATCH"};return n.body=JSON.stringify(t),this.run(e,n)},delete(e,t){let n={method:"DELETE"};return n.body=JSON.stringify(t),this.run(e,n)}};const u={};var p={addModule:function(e,t){u[e]=t},loadModule:function(e){return u[e]?(n=u[e],Promise.resolve().then((function(){return t(require(n))}))):function(e){return Promise.resolve().then((function(){return t(require(e))}))}("./../components/"+e+".vue");var n}};window.onpopstate=function(){h.convertFromURL(),v()};const d=e.reactive({cats:{},routes:[],component:"",title:"",name:"",route:{children:[],parent:null,perms:[]}}),h=new class{constructor(){this._route="",this._model="",this._state="",this._key=0,this._to="",this._params={},this._settings={},this._base="/",this._default=!1,this._changes={};Object.keys(this).forEach((e=>{"_"==e[0]&&Object.defineProperty(this,e.substring(1),{get:function(){return this[e]},set:function(t){this._changes[e.substring(1)]=this[e],this[e]=t}})})),this.action_map={post:"-create",put:"-update",delete:"-delete",login:"-login",logout:"-logout",primary:"-primary",parent:"-parent",get:""}}get id(){return this.model+"-"+this.state+"-"+this.to}hasChange(e){return this._changes.hasOwnProperty(e)}reset(){this.route="",this.model="",this.state="",this.key=0,this.to="",this.params={},this.settings={},this._changes={}}resetChanges(){this._changes={}}convertToURL(){let e=this._base+this.route+"/"+this.model+this.action_map[this.state];this.key&&(e+="-"+this.key),this.to&&(e+="-to-"+this.to);let t=[];for(const e in this.params)"Array"==typeof this.params[e]||"Object"==typeof this.params[e]?t.push(e+"="+JSON.stringify(this.params[e])):t.push(e+"="+this.params[e]);return t.length>0&&(e+="?"+t.join("&")),e}convertFromURL(e){e||(e=new URL(window.location.href));let t=e.pathname.replace(this.base,"");if(t=t.replace(/^\/+|\/+$/g,""),!t)return;let n=t.split("/");this.route=n[0],t=n[1];const o=this;e.searchParams.forEach((function(e,t){o.params[t]=e.indexOf(",")>-1?e.split(","):e})),n=t.split("-to-"),n.length>1&&(this.to=n[1],t=n[0]),n=t.split("-");let r=n[n.length-1];if("first"==r?(this.key=r,n.pop()):isNaN(r)||(this.key=r,n.pop()),0==n.length)throw new Error("Can't convert this url string: "+t);this.state="get";for(let e in this.action_map)if(this.action_map[e]=="-"+n[n.length-1]){this.state=e,n.pop();break}this.model=n.join("-")}getAll(){return{route:this.route,model:this.model,state:this.state,key:this.key,to:this.to,params:this.params,base:this.base,default:this.default}}apply(e){for(let t in e)this[t]=e[t]}};function m(e){return d.cats={},d.routes=[],d.route={children:[],parent:null,perms:[]},d.model=null,c.get("/nav/site-map").then((e=>{for(let t in e)for(let n in e[t]){const o={model:n,state:e[t][n].state};e[t][n].default&&(o.default=!0),o.route=n,d.routes.push(o),d.cats[t]||(d.cats[t]=[]),d.cats[t].push(o)}}))}function f(){return c.get("/nav/route-points/"+h.route+"/"+h.model).then((e=>{d.route.children=e.children,d.route.perms=e.perms,d.route.parent=e.parent,d.title=e.title,d.name=e.name,e.dictionary})).catch((e=>console.log(e)))}function g(){!function(){const e=window.location.protocol+"//"+window.location.host+h.convertToURL(),t=new URL(e);window.history.pushState({name:t.pathname},document.title,t)}(),v()}function v(){let e=[];return h.model?h.hasChange("route")?(e.push(m()),e.push(f())):h.hasChange("model")&&e.push(f()):e.push(m().then((()=>(h.apply(function(){for(let e in d.cats)for(let t of d.cats[e])if(t.default)return t}()),f())))),Promise.all(e).then((()=>{h.model,"get"==h.state||"parent"==h.state?d.component="ptj-repo":"primary"==h.state?d.component="ptj-primary":"login"==h.state&&(d.component="ptj-account-handler")})).catch((e=>console.log(e)))}var k={props:{route:Object},setup(t){const n=t;function o(){for(let e in n.route)h[e]=n.route[e];g()}return(n,r)=>(e.openBlock(),e.createElementBlock("a",{class:"ptj-button",key:t.route,onClick:o},[e.renderSlot(n.$slots,"default")]))}};function y(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}k.__file="presstojam/src/components/ptj-button.vue";y("\n.ptj-multiple-select-val[data-v-51b18f4e] {\r\n    display : inline-block;\r\n    border : 1px solid green;\r\n    margin-left : 2px;\r\n    margin-right : 2px;\r\n    padding : 2px;\r\n    background-color : green;\n}\n.ptj-multiple-select-val-remove[data-v-51b18f4e] {\r\n    color : red;\n}\n.ptj-multiple-select-display[data-v-51b18f4e] {\r\n    position :relative;\r\n    background-color : #fff;\r\n    border : 1px solid #cdcdcd;\r\n    min-height : 35px;\n}\r\n\r\n");y("\n.ptj-multiple-select-val[data-v-5b05457d] {\r\n    display : inline-block;\r\n    border : 1px solid green;\r\n    margin-left : 2px;\r\n    margin-right : 2px;\r\n    padding : 2px;\r\n    background-color : green;\n}\n.ptj-multiple-select-val-remove[data-v-5b05457d] {\r\n    color : red;\n}\n.ptj-multiple-select-arrow[data-v-5b05457d] {\r\n    position :absolute;\r\n    right : 2px;\r\n    top : 3px;\n}\n.ptj-multiple-select-display[data-v-5b05457d] {\r\n    position :relative;\r\n    background-color : #fff;\r\n    border : 1px solid #cdcdcd;\r\n    min-height : 35px;\n}\n.ptj-multiple-select-options li[data-v-5b05457d] {\r\n    list-style: none;\r\n    cursor: pointer;\r\n    margin-top : 2px;\r\n    border : 1px solid #cdcdcd;\r\n    background-color : #fff;\n}\n.ptj-multiple-select-options li[data-v-5b05457d]:hover {\r\n    background-color : #f9f9fb;\r\n    transition : background-color .2s ease-out,border .2s ease-out;\n}\r\n");const b=e.reactive({init:!1,login:!1,user:"public"});function j(){c.post("/core/logout").then((()=>{location.href=h.base}))}function _(){c.get("/core/check-user").then((e=>{if(e.is_expired)return c.put("/core/switch-tokens").then((()=>{_()}));b.init||(b.user=e.user,b.role=e.role,b.init=!0)})).then((e=>{"public"!=b.user&&setTimeout(_,6e5)})).catch((e=>{b.login=!0}))}const B={class:"ptj-slug-trail"};var x={setup(t){const n=e.ref([]);return onMounted((async()=>{})),(t,o)=>(e.openBlock(),e.createElementBlock("div",B,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(t=>(e.openBlock(),e.createBlock(k,{key:t.id,route:t.route},{default:e.withCtx((()=>[e.createTextVNode(e.toDisplayString(t.value),1)])),_:2},1032,["route"])))),128))]))},__file:"presstojam/src/components/ptj-slug-trail.vue"};const w={class:"ptj-nav"},E={key:0},S=e.createElementVNode("span",{class:"material-icons"},"back",-1),N=e.createElementVNode("div",null,"Loading ...",-1);var C={setup(t){const n=e.computed((()=>d.component?e.defineAsyncComponent((()=>p.loadModule(d.component))):null));return e.onMounted((()=>{(function(){const e=i.getSettings("mapper");return e&&(h.base="/"+e.base.replace(/^\/+|\/+$/g,""),e.role),h.convertFromURL(),Promise.resolve()})().then((()=>v()))})),(t,o)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",w,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d).cats,((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:n},[t.length>1?(e.openBlock(),e.createElementBlock("span",E,e.toDisplayString(n),1)):e.createCommentVNode("v-if",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t,(t=>(e.openBlock(),e.createBlock(k,{route:{route:t.route,model:t.model,state:t.state,key:0},key:t.route},{default:e.withCtx((()=>[e.createTextVNode(e.toDisplayString(t.route),1)])),_:2},1032,["route"])))),128))])))),128))]),e.createVNode(x),(e.openBlock(),e.createBlock(e.Suspense,null,{default:e.withCtx((()=>[e.createElementVNode("div",{class:e.normalizeClass([Map.model,Map.state])},[e.unref(d).back?(e.openBlock(),e.createBlock(k,{key:0,route:e.unref(d).back},{default:e.withCtx((()=>[S])),_:1},8,["route"])):e.createCommentVNode("v-if",!0),e.createElementVNode("h1",null,e.toDisplayString(e.unref(d).title),1),e.unref(n)?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{key:1})):e.createCommentVNode("v-if",!0)],2)])),fallback:e.withCtx((()=>[N])),_:1}))],64))},__file:"presstojam/src/components/ptj-router.vue"},O={setup:t=>(_(),(t,n)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[(e.openBlock(),e.createBlock(e.Teleport,{to:"#ptj-accountdetails"},["public"!=e.unref(b).user?(e.openBlock(),e.createElementBlock("a",{key:0,class:"ptj-account-details-logout",onClick:n[0]||(n[0]=(...t)=>e.unref(j)&&e.unref(j)(...t))},"Logout")):e.createCommentVNode("v-if",!0)])),e.createVNode(C),e.createVNode(r,{active:e.unref(b).login},null,8,["active"])],64)))};O.__file="presstojam/src/components/ptj-user.vue";var V={runApp:function(t,n){i.regSettings(n);const o=e.createApp(O);return o.mount(t),o},getClient:function(e){return i.regSettings(e),c}};exports.default=V;
//# sourceMappingURL=ptj.cjs.js.map
